<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Past Tense Pronunciation Adventure</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A4ecca+Pi4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/j4+P/5OTkav///wDi4uL/4ecca/Pi4v/z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/4ecca//i4uL/////AOLi4v/j4+P/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/j4+P/4uLi/////wDi4uL/4+Pj//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/4+Pj/+Li4v////8A4uLi/+Pj4//09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0/+Pj4//i4uL/////AOLi4v/j4+P/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/j4+P/4uLi/////wDi4uL/4+Pj//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/4+Pj/+Li4v////8A4uLi/+Pj4//09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0/+Pj4//i4uL/////AOLi4v/j4+P/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/j4+P/4uLi/////wDi4uL/4+Pj//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/4+Pj/+Li4v////8A4uLi/+Pj4//09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0/+Pj4//i4uL/////AOLi4v/j4+P/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/j4+P/4uLi/////wDi4uL/4+Pj//Pz8//z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/4+Pj/+Li4v////8A4ecca+Pj4//i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Pj4//k5ORq////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
    
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #4ecca3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Container */
        .container {
            display: none;
            min-height: 100vh;
        }
        
        .container.active {
            display: block;
        }
        
        /* Main Menu */
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .main-menu h1 {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 204, 163, 0.4);
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        /* Language Toggle */
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .language-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Game Menu */
        .game-menu {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .game-menu.active {
            display: flex;
        }
        
        .game-menu h1 {
            font-size: 2.2em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            max-width: 600px;
        }
        
        .menu-button {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .menu-button:hover {
            background: rgba(255,255,255,0.2);
            border-color: #4ecca3;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .menu-button h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Game Containers */
        .game-container {
            display: none;
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .game-container.active {
            display: block;
        }
        
        /* Video Controls */
        .story-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }
        
        .story-container.active {
            display: flex;
        }
        
        .video-wrapper {
            width: 100%;
            max-width: 800px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .video-controls {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            text-align: center;
        }
        
        .video-control-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        .video-control-btn.secondary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        /* Message System */
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2ecc71;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: messageSlide 0.3s ease-out;
        }
        
        .message.error {
            background: #e74c3c;
        }
        
        .message.warning {
            background: #f39c12;
        }
        
        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .menu {
                grid-template-columns: 1fr;
            }
            
            .main-menu h1 {
                font-size: 2em;
            }
            
            .game-menu h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <h2>🎮 English Past Tense Adventure</h2>
        <p id="loadingStatus">Initializing game system...</p>
    </div>
    
    <!-- Language Toggle Button -->
    <button id="languageToggle" class="language-toggle" style="display: none;">
        🌐 English
    </button>
    
    <!-- Story/Intro Video Container -->
    <div id="storyContainer" class="story-container">
        <div class="video-wrapper">
            <video id="introVideo" controls preload="metadata">
                <source src="assets/video/intro.mp4" type="video/mp4">
                <p>Your browser does not support video playback.</p>
            </video>
            <div class="video-controls">
                <h3 style="color: white; margin: 0 0 15px 0;">🎬 Game Introduction</h3>
                <p style="color: #ccc; margin: 0 0 20px 0;">Watch the story introduction or start playing</p>
                <button id="skipIntro" class="video-control-btn secondary">⏭️ Skip Intro</button>
                <button id="continueStory" class="video-control-btn">▶️ Start Game</button>
            </div>
        </div>
    </div>
    
    <!-- Main Game Container -->
    <div id="gameContainer" class="container">
        
        <!-- Main Menu -->
        <div id="mainMenu" class="main-menu">
            <h1 id="gameTitle">🎭 English Past Tense Adventure</h1>
            <div class="menu-options">
                <button id="startGame" class="menu-btn">🚀 Start Adventure</button>
                <button id="continueGame" class="menu-btn" style="display: none;">📖 Continue</button>
                <button id="instructionsBtn" class="menu-btn">📚 Instructions</button>
                <button id="creditsBtn" class="menu-btn">🏆 Credits</button>
            </div>
        </div>
        
        <!-- Game Menu -->
        <div id="gameMenu" class="game-menu">
            <h1 id="gameMenuTitle">🎮 Choose Your Challenge</h1>
            
            <div class="menu">
                <button class="menu-button" data-game="wordSearch">
                    <h3>🔍 Word Search</h3>
                    <p>Find past tense words in the grid</p>
                </button>
                <button class="menu-button" data-game="fallingWords">
                    <h3>⚔️ Word Battle</h3>
                    <p>Slice words with correct pronunciation</p>
                </button>
                <button class="menu-button" data-game="multipleChoice">
                    <h3>🧙‍♂️ Quiz Master</h3>
                    <p>Choose the correct pronunciation</p>
                </button>
                <button class="menu-button" data-game="bossFight">
                    <h3>👑 Final Boss</h3>
                    <p>Face the Pronunciation King!</p>
                </button>
            </div>
            
            <button class="back-btn" id="gameMenuBackBtn">🏠 Back to Menu</button>
        </div>
        
        <!-- Game Containers -->
        <div id="wordSearch" class="game-container"></div>
        <div id="fallingWords" class="game-container"></div>
        <div id="multipleChoice" class="game-container"></div>
        <div id="bossFight" class="game-container"></div>
        
    </div>
    
    <!-- Audio Elements -->
    <audio id="bgmAudio" loop>
        <source src="assets/audio/bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="correctSound">
        <source src="assets/audio/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound">
        <source src="assets/audio/wrong.mp3" type="audio/mpeg">
    </audio>
    
    <!-- JavaScript Files -->
    <script>
        console.log('🎮 Starting game initialization...');
        
        // Global game state
        window.gameState = {
            currentLanguage: 'en',
            currentGame: null,
            score: 0,
            level: 1,
            initialized: false
        };
        
        // Language data
        window.translations = {
            en: {
                gameTitle: "🎭 English Past Tense Adventure",
                startGame: "🚀 Start Adventure",
                continueGame: "📖 Continue",
                instructions: "📚 Instructions", 
                credits: "🏆 Credits",
                gameMenuTitle: "🎮 Choose Your Challenge",
                wordSearch: "🔍 Word Search",
                wordSearchDesc: "Find past tense words in the grid",
                fallingWords: "⚔️ Word Battle",
                fallingWordsDesc: "Slice words with correct pronunciation",
                multipleChoice: "🧙‍♂️ Quiz Master",
                multipleChoiceDesc: "Choose the correct pronunciation",
                bossFight: "👑 Final Boss",
                bossFightDesc: "Face the Pronunciation King!",
                backToMenu: "🏠 Back to Menu",
                languageToggle: "🌐 中文"
            },
            zh: {
                gameTitle: "🎭 英語過去式發音冒險",
                startGame: "🚀 開始冒險",
                continueGame: "📖 繼續遊戲",
                instructions: "📚 遊戲說明",
                credits: "🏆 製作團隊",
                gameMenuTitle: "🎮 選擇遊戲",
                wordSearch: "🔍 單詞搜索",
                wordSearchDesc: "在網格中找到過去式單詞",
                fallingWords: "⚔️ 落字遊戲",
                fallingWordsDesc: "用劍斬開正確發音的石塊",
                multipleChoice: "🧙‍♂️ 選擇題",
                multipleChoiceDesc: "聽發音選擇正確類型",
                bossFight: "👑 Boss戰",
                bossFightDesc: "擊敗發音之王！",
                backToMenu: "🏠 返回選單",
                languageToggle: "🌐 English"
            }
        };
        
        // Translation function
        function updateLanguage(lang) {
            window.gameState.currentLanguage = lang;
            const t = window.translations[lang];
            
            // Update UI elements
            const elements = [
                'gameTitle', 'startGame', 'continueGame', 'instructions', 'credits',
                'gameMenuTitle', 'languageToggle'
            ];
            
            elements.forEach(key => {
                const element = document.getElementById(key);
                if (element && t[key]) {
                    element.textContent = t[key];
                }
            });
            
            // Update game buttons
            const gameButtons = document.querySelectorAll('.menu-button');
            gameButtons.forEach(btn => {
                const game = btn.dataset.game;
                if (game && t[game]) {
                    const h3 = btn.querySelector('h3');
                    const p = btn.querySelector('p');
                    if (h3) h3.textContent = t[game];
                    if (p) p.textContent = t[game + 'Desc'];
                }
            });
            
            // Update back buttons
            document.querySelectorAll('.back-btn').forEach(btn => {
                if (t.backToMenu) btn.textContent = t.backToMenu;
            });
        }
        
        // Message system
        function showMessage(text, type = 'success', duration = 3000) {
            // Remove existing message
            const existing = document.querySelector('.message');
            if (existing) {
                existing.remove();
            }
            
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            document.body.appendChild(message);
            
            setTimeout(() => {
                if (message.parentNode) {
                    message.style.opacity = '0';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.parentNode.removeChild(message);
                        }
                    }, 300);
                }
            }, duration);
        }
        
        // Loading manager
        const LoadingManager = {
            scriptsLoaded: 0,
            totalScripts: 3,
            
            updateStatus(message) {
                const statusEl = document.getElementById('loadingStatus');
                if (statusEl) statusEl.textContent = message;
                console.log('Loading:', message);
            },
            
            scriptLoaded() {
                this.scriptsLoaded++;
                const progress = Math.round((this.scriptsLoaded / this.totalScripts) * 100);
                this.updateStatus(`Loading... ${progress}%`);
                
                if (this.scriptsLoaded >= this.totalScripts) {
                    setTimeout(() => this.finishLoading(), 500);
                }
            },
            
            finishLoading() {
                console.log('🎉 All scripts loaded successfully');
                
                // Hide loading screen
                const loading = document.getElementById('loadingScreen');
                const game = document.getElementById('gameContainer');
                const langToggle = document.getElementById('languageToggle');
                
                if (loading) {
                    loading.style.opacity = '0';
                    setTimeout(() => {
                        loading.style.display = 'none';
                        if (game) {
                            game.classList.add('active');
                            document.getElementById('mainMenu').style.display = 'flex';
                        }
                        if (langToggle) langToggle.style.display = 'block';
                    }, 500);
                }
                
                // Initialize game system
                if (window.GameSystem) {
                    window.gameSystem = new window.GameSystem();
                    window.gameState.initialized = true;
                    updateLanguage('en'); // Set default language
                } else {
                    console.error('GameSystem not found!');
                }
            }
        };
        
        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, setting up basic event listeners...');
            
            // Language toggle
            document.getElementById('languageToggle').addEventListener('click', () => {
                const newLang = window.gameState.currentLanguage === 'en' ? 'zh' : 'en';
                updateLanguage(newLang);
            });
            
            // Video controls
            const skipBtn = document.getElementById('skipIntro');
            const continueBtn = document.getElementById('continueStory');
            
            if (skipBtn) {
                skipBtn.addEventListener('click', () => {
                    document.getElementById('storyContainer').classList.remove('active');
                    if (window.gameSystem) {
                        window.gameSystem.showGameMenu();
                    }
                });
            }
            
            if (continueBtn) {
                continueBtn.addEventListener('click', () => {
                    document.getElementById('storyContainer').classList.remove('active');
                    if (window.gameSystem) {
                        window.gameSystem.showGameMenu();
                    }
                });
            }
            
            // Start loading scripts
            LoadingManager.updateStatus('Loading game system...');
        });
    </script>
    
    <script src="js/gamesystem.js" onload="LoadingManager.scriptLoaded()" onerror="console.error('Failed to load gamesystem.js')"></script>
    <script src="js/wordSearch.js" onload="LoadingManager.scriptLoaded()" onerror="console.error('Failed to load wordSearch.js')"></script>
    <script src="js/main.js" onload="LoadingManager.scriptLoaded()" onerror="console.error('Failed to load main.js')"></script>

</body>
</html>
