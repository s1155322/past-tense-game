<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÂÜíÈö™ÈÅäÊà≤</title>
    
    <style>
        /* ÈáçÁΩÆÊ®£Âºè */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        /* ËºâÂÖ•Áï´Èù¢ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        #loadingScreen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #4ecca3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ë™ûË®ÄÂàáÊèõÊåâÈàï */
        #languageToggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        #languageToggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Áï´Èù¢ÁÆ°ÁêÜ */
        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* ‰∏ªÈÅ∏ÂñÆ */
        .main-menu h1 {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            text-align: center;
        }
        
        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 204, 163, 0.4);
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        /* ÊïÖ‰∫ã/ÂΩ±ÁâáÁï´Èù¢ */
        #storyScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            z-index: 999;
        }
        
        .video-wrapper {
            width: 100%;
            max-width: 800px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin: 20px;
        }
        
        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .video-controls {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            text-align: center;
        }
        
        .video-control-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        .video-control-btn.secondary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        /* ÈÅäÊà≤ÈÅ∏ÂñÆ */
        .game-menu h1 {
            font-size: 2.2em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            text-align: center;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            max-width: 600px;
        }
        
        .game-button {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .game-button:hover:not(.locked) {
            background: rgba(255,255,255,0.2);
            border-color: #4ecca3;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .game-button.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .game-button.locked::after {
            content: 'üîí';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        
        .game-button.completed::after {
            content: '‚úÖ';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        
        .game-button h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        
        .game-button p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* ÈÅäÊà≤ÂÆπÂô® */
        .game-container {
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
        
        /* ÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤Ê®£Âºè */
        .bridge-scene {
            background: linear-gradient(180deg, #87ceeb 0%, #6fa8cd 100%);
            margin: 20px auto;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            position: relative;
            height: 300px;
            overflow: hidden;
            border: 3px solid rgba(255,255,255,0.3);
        }
        
        .cliff-left {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100px;
            height: 150px;
            background: linear-gradient(45deg, #8b7355, #a0522d);
            clip-path: polygon(0 100%, 0 0, 80% 0, 100% 100%);
        }
        
        .cliff-right {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 100px;
            height: 150px;
            background: linear-gradient(45deg, #8b7355, #a0522d);
            clip-path: polygon(0 100%, 20% 0, 100% 0, 100% 100%);
        }
        
        .character {
            position: absolute;
            left: 40px;
            bottom: 120px;
            width: 30px;
            height: 50px;
            animation: bounce 2s ease-in-out infinite;
        }
        
        .character-head {
            width: 20px;
            height: 20px;
            background: #fdbcb4;
            border-radius: 50%;
            margin: 0 auto;
            border: 2px solid #333;
        }
        
        .character-body {
            width: 20px;
            height: 25px;
            background: #4ecca3;
            border-radius: 10px;
            margin: 3px auto;
            border: 2px solid #333;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .broken-bridge {
            position: absolute;
            left: 50%;
            top: 60%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .bridge-stone {
            width: 20px;
            height: 15px;
            border-radius: 3px;
        }
        
        .bridge-stone.complete {
            background: #696969;
            border: 1px solid #333;
        }
        
        .bridge-stone.missing {
            background: transparent;
            border: 2px dashed #fff;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* Â≠óÊØçÁ∂≤Ê†º */
        #letterGrid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .letter-cell {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            color: #333;
            border: 2px solid transparent;
            user-select: none;
        }
        
        .letter-cell:hover {
            background: #4ecca3;
            color: white;
            transform: scale(1.1);
            border-color: #2ecc71;
        }
        
        .letter-cell.selected {
            background: #4ecca3 !important;
            color: white;
            border-color: #2ecc71;
            transform: scale(1.05);
        }
        
        .letter-cell.found {
            background: #2ecc71 !important;
            color: white;
            border-color: #27ae60;
            animation: cellFound 0.6s ease-in-out;
        }
        
        @keyframes cellFound {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.05); }
        }
        
        /* ËêΩÂ≠óÈÅäÊà≤Ê®£Âºè */
        #fallingWordsCanvas {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
        }
        
        .sword {
            position: absolute;
            width: 4px;
            height: 100px;
            background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.6);
            pointer-events: none;
            z-index: 100;
        }
        
        .sword::before {
            content: '';
            position: absolute;
            top: -15px;
            left: -8px;
            width: 20px;
            height: 15px;
            background: #8b5cf6;
            border-radius: 5px;
        }
        
        /* ÊåâÈàïÊ®£Âºè */
        .sound-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .sound-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .sound-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px currentColor;
            border: 2px solid rgba(255,255,255,0.7);
        }
        
        .control-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* ÊâæÂà∞ÁöÑÂñÆË©û */
        .word-item {
            background: rgba(255,255,255,0.2);
            padding: 5px 8px;
            margin: 3px 0;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .word-item.found {
            background: rgba(46, 204, 113, 0.8);
            color: white;
            animation: wordFound 0.6s ease-in-out;
        }
        
        @keyframes wordFound {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Ë®äÊÅØÁ≥ªÁµ± */
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2ecc71;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: messageSlide 0.3s ease-out;
            max-width: 90vw;
            text-align: center;
        }
        
        .message.error {
            background: #e74c3c;
        }
        
        .message.warning {
            background: #f39c12;
        }
        
        .message.info {
            background: #3498db;
        }
        
        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
            
            .main-menu h1, .game-menu h1 {
                font-size: 1.8em;
            }
            
            #letterGrid {
                grid-template-columns: repeat(8, 1fr);
                max-width: 320px;
            }
            
            .letter-cell {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
            
            #fallingWordsCanvas {
                width: 350px;
                height: 500px;
            }
        }
    </style>
</head>
<body>
    
    <!-- ËºâÂÖ•Áï´Èù¢ -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <h2>üéÆ Ëã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÂÜíÈö™</h2>
        <p id="loadingStatus">Ê≠£Âú®ÂàùÂßãÂåñÈÅäÊà≤Á≥ªÁµ±...</p>
    </div>
    
    <!-- Ë™ûË®ÄÂàáÊèõÊåâÈàï -->
    <button id="languageToggle">üåê English</button>
    
    <!-- ‰∏ªÈÅ∏ÂñÆÁï´Èù¢ -->
    <div id="mainMenuScreen" class="screen">
        <div class="main-menu">
            <h1 id="gameTitle">üé≠ Ëã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÂÜíÈö™</h1>
            <div class="menu-options">
                <button id="startGameBtn" class="menu-btn">üöÄ ÈñãÂßãÂÜíÈö™</button>
                <button id="instructionsBtn" class="menu-btn">üìö ÈÅäÊà≤Ë™™Êòé</button>
                <button id="creditsBtn" class="menu-btn">üèÜ Ë£Ω‰ΩúÂúòÈöä</button>
            </div>
        </div>
    </div>
    
    <!-- ÊïÖ‰∫ã/ÂΩ±ÁâáÁï´Èù¢ -->
    <div id="storyScreen" class="screen">
        <div class="video-wrapper">
            <!-- ÂØ¶ÈöõÁöÑÂΩ±ÁâáÂÖÉÁ¥†ÔºåÂ∏∂ÊúâÂÆåÊï¥ÊéßÂà∂ -->
            <video id="introVideo" controls preload="metadata" muted>
                <!-- Â¶ÇÊûúÊúâÂØ¶ÈöõÂΩ±ÁâáÊñá‰ª∂ÔºåÂèñÊ∂àË®ªÈáã‰ª•‰∏ãË°å -->
                <!-- <source src="assets/video/intro.mp4" type="video/mp4"> -->
                
                <!-- Ê®°Êì¨ÂΩ±ÁâáÂÖßÂÆπÁöÑÊõø‰ª£È°ØÁ§∫ -->
                <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #2c3e50, #34495e); display: flex; align-items: center; justify-content: center; color: white; text-align: center; padding: 40px;">
                    <div>
                        <h2 style="font-size: 2em; margin-bottom: 20px;">üé¨ ÈÅäÊà≤‰ªãÁ¥πÂΩ±Áâá</h2>
                        <p style="font-size: 18px; line-height: 1.6; margin-bottom: 20px;">
                            Ê≠°Ëøé‰æÜÂà∞Ëã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÂÜíÈö™ÔºÅ<br>
                            Âú®ÈÄôÂÄãÁ•ûÂ•áÁöÑ‰∏ñÁïå‰∏≠Ôºå‰Ω†Â∞áÂ≠∏Áøí‰∏âÁ®ÆÈÅéÂéªÂºèÁôºÈü≥
                        </p>
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                            <h3 style="color: #4ecca3; margin-bottom: 15px;">Â≠∏ÁøíÁõÆÊ®ô</h3>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                                <div>
                                    <div style="color: #3498db; font-size: 24px;">üîµ</div>
                                    <div style="font-weight: bold;">/t/ Èü≥</div>
                                    <div style="font-size: 14px;">watched, kicked</div>
                                </div>
                                <div>
                                    <div style="color: #e74c3c; font-size: 24px;">üî¥</div>
                                    <div style="font-weight: bold;">/d/ Èü≥</div>
                                    <div style="font-size: 14px;">played, lived</div>
                                </div>
                                <div>
                                    <div style="color: #2ecc71; font-size: 24px;">üü¢</div>
                                    <div style="font-weight: bold;">/…™d/ Èü≥</div>
                                    <div style="font-size: 14px;">wanted, needed</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </video>
            <div class="video-controls">
                <h3 style="color: white; margin: 0 0 15px 0;">üé¨ ÈÅäÊà≤‰ªãÁ¥π</h3>
                <p style="color: #ccc; margin: 0 0 20px 0;">ËßÄÁúãÊïÖ‰∫ã‰ªãÁ¥πÊàñÁõ¥Êé•ÈñãÂßãÈÅäÊà≤</p>
                <button id="skipIntroBtn" class="video-control-btn secondary">‚è≠Ô∏è Ë∑≥ÈÅé‰ªãÁ¥π</button>
                <button id="continueStoryBtn" class="video-control-btn">‚ñ∂Ô∏è ÈñãÂßãÈÅäÊà≤</button>
            </div>
        </div>
    </div>
    
    <!-- ÈÅäÊà≤ÈÅ∏ÂñÆÁï´Èù¢ -->
    <div id="gameMenuScreen" class="screen">
        <div class="game-menu">
            <h1 id="gameMenuTitle">üéÆ ÈÅ∏Êìá‰Ω†ÁöÑÊåëÊà∞</h1>
            
            <div class="game-grid">
                <div class="game-button" id="wordSearchBtn" data-game="wordSearch">
                    <h3>üîç ÂñÆË©ûÊêúÁ¥¢</h3>
                    <p>Âú®Á∂≤Ê†º‰∏≠ÊâæÂà∞ÈÅéÂéªÂºèÂñÆË©û</p>
                </div>
                <div class="game-button locked" id="fallingWordsBtn" data-game="fallingWords">
                    <h3>‚öîÔ∏è ËêΩÂ≠óÈÅäÊà≤</h3>
                    <p>Áî®ÂäçÊñ¨ÈñãÊ≠£Á¢∫ÁôºÈü≥ÁöÑÁü≥Â°ä</p>
                </div>
                <div class="game-button locked" id="multipleChoiceBtn" data-game="multipleChoice">
                    <h3>üßô‚Äç‚ôÇÔ∏è ÈÅ∏ÊìáÈ°å</h3>
                    <p>ËÅΩÁôºÈü≥ÈÅ∏ÊìáÊ≠£Á¢∫È°ûÂûã</p>
                </div>
                <div class="game-button locked" id="bossFightBtn" data-game="bossFight">
                    <h3>üëë BossÊà∞</h3>
                    <p>ÊìäÊïóÁôºÈü≥‰πãÁéãÔºÅ</p>
                </div>
            </div>
            
            <button class="back-btn" id="gameMenuBackBtn">üè† ËøîÂõû‰∏ªÈÅ∏ÂñÆ</button>
        </div>
    </div>
    
    <!-- ÈÅäÊà≤ÂÆπÂô® -->
    <div id="gameContainer" class="screen">
        <div id="gameContent" class="game-container">
            <!-- ÈÅäÊà≤ÂÖßÂÆπÂ∞áÂú®ÈÄôË£°ÊèíÂÖ• -->
        </div>
    </div>
    
    <script>
        console.log('üéÆ ÈñãÂßãÈÅäÊà≤ÂàùÂßãÂåñ...');
        
        // ÂÖ®ÂüüÈÅäÊà≤ÁãÄÊÖã
        window.gameState = {
            currentLanguage: 'zh',
            currentGame: null,
            currentScreen: 'loading',
            gameProgress: {
                wordSearch: { completed: false, unlocked: true },
                fallingWords: { completed: false, unlocked: false },
                multipleChoice: { completed: false, unlocked: false },
                bossFight: { completed: false, unlocked: false }
            },
            score: 0,
            initialized: false
        };
        
        // ÁøªË≠ØÁ≥ªÁµ±
        window.translations = {
            zh: {
                gameTitle: "üé≠ Ëã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÂÜíÈö™",
                startGame: "üöÄ ÈñãÂßãÂÜíÈö™",
                instructions: "üìö ÈÅäÊà≤Ë™™Êòé",
                credits: "üèÜ Ë£Ω‰ΩúÂúòÈöä",
                gameMenuTitle: "üéÆ ÈÅ∏Êìá‰Ω†ÁöÑÊåëÊà∞",
                wordSearch: "üîç ÂñÆË©ûÊêúÁ¥¢",
                wordSearchDesc: "Âú®Á∂≤Ê†º‰∏≠ÊâæÂà∞ÈÅéÂéªÂºèÂñÆË©û",
                fallingWords: "‚öîÔ∏è ËêΩÂ≠óÈÅäÊà≤",
                fallingWordsDesc: "Áî®ÂäçÊñ¨ÈñãÊ≠£Á¢∫ÁôºÈü≥ÁöÑÁü≥Â°ä",
                multipleChoice: "üßô‚Äç‚ôÇÔ∏è ÈÅ∏ÊìáÈ°å",
                multipleChoiceDesc: "ËÅΩÁôºÈü≥ÈÅ∏ÊìáÊ≠£Á¢∫È°ûÂûã",
                bossFight: "üëë BossÊà∞",
                bossFightDesc: "ÊìäÊïóÁôºÈü≥‰πãÁéãÔºÅ",
                backToMenu: "üè† ËøîÂõû‰∏ªÈÅ∏ÂñÆ",
                languageToggle: "üåê English"
            },
            en: {
                gameTitle: "üé≠ English Past Tense Adventure",
                startGame: "üöÄ Start Adventure",
                instructions: "üìö Instructions",
                credits: "üèÜ Credits",
                gameMenuTitle: "üéÆ Choose Your Challenge",
                wordSearch: "üîç Word Search",
                wordSearchDesc: "Find past tense words in the grid",
                fallingWords: "‚öîÔ∏è Word Battle",
                fallingWordsDesc: "Slice words with correct pronunciation",
                multipleChoice: "üßô‚Äç‚ôÇÔ∏è Quiz Master",
                multipleChoiceDesc: "Choose the correct pronunciation",
                bossFight: "üëë Final Boss",
                bossFightDesc: "Face the Pronunciation King!",
                backToMenu: "üè† Back to Menu",
                languageToggle: "üåê ‰∏≠Êñá"
            }
        };
        
        // Áï´Èù¢ÁÆ°ÁêÜÂô®
        class ScreenManager {
            constructor() {
                this.screens = ['mainMenuScreen', 'storyScreen', 'gameMenuScreen', 'gameContainer'];
                this.currentScreen = null;
            }
            
            showScreen(screenId) {
                console.log(`üì∫ ÂàáÊèõÂà∞Áï´Èù¢: ${screenId}`);
                
                // Èö±ËóèÊâÄÊúâÁï´Èù¢
                this.screens.forEach(id => {
                    const screen = document.getElementById(id);
                    if (screen) {
                        screen.classList.remove('active');
                    }
                });
                
                // È°ØÁ§∫ÁõÆÊ®ôÁï´Èù¢
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    this.currentScreen = screenId;
                    window.gameState.currentScreen = screenId;
                    console.log(`‚úÖ Áï´Èù¢ ${screenId} ÁèæÂú®ËôïÊñºÊ¥ªÂãïÁãÄÊÖã`);
                } else {
                    console.error(`‚ùå Êâæ‰∏çÂà∞Áï´Èù¢ ${screenId}`);
                }
            }
        }
        
        // ÈÅäÊà≤Á≥ªÁµ±
        class GameSystem {
            constructor() {
                this.screenManager = new ScreenManager();
                this.currentVideo = null;
                this.init();
            }
            
            init() {
                console.log('üéÆ ÈÅäÊà≤Á≥ªÁµ±ÂàùÂßãÂåñ‰∏≠');
                this.setupEventListeners();
                this.updateGameProgress();
            }
            
            setupEventListeners() {
                console.log('üîß Ë®≠ÁΩÆÈÅäÊà≤Á≥ªÁµ±‰∫ã‰ª∂Áõ£ËÅΩÂô®');
                
                // ‰∏ªÈÅ∏ÂñÆÊåâÈàï
                document.getElementById('startGameBtn').onclick = () => this.showStory();
                document.getElementById('instructionsBtn').onclick = () => this.showInstructions();
                document.getElementById('creditsBtn').onclick = () => this.showCredits();
                
                // ÊïÖ‰∫ã/ÂΩ±ÁâáÊéßÂà∂
                document.getElementById('skipIntroBtn').onclick = () => this.skipVideo();
                document.getElementById('continueStoryBtn').onclick = () => this.continueFromVideo();
                
                // ÈÅäÊà≤ÈÅ∏ÂñÆ
                document.getElementById('gameMenuBackBtn').onclick = () => this.showMainMenu();
                
                // ÈÅäÊà≤ÊåâÈàï
                document.getElementById('wordSearchBtn').onclick = () => this.startGame('wordSearch');
                document.getElementById('fallingWordsBtn').onclick = () => this.startGame('fallingWords');
                document.getElementById('multipleChoiceBtn').onclick = () => this.startGame('multipleChoice');
                document.getElementById('bossFightBtn').onclick = () => this.startGame('bossFight');
                
                // Ë™ûË®ÄÂàáÊèõ
                document.getElementById('languageToggle').onclick = () => this.toggleLanguage();
                
                // ÂΩ±Áâá‰∫ã‰ª∂
                this.currentVideo = document.getElementById('introVideo');
                if (this.currentVideo) {
                    this.currentVideo.onended = () => this.continueFromVideo();
                }
            }
            
            showMainMenu() {
                console.log('üìã È°ØÁ§∫‰∏ªÈÅ∏ÂñÆ');
                this.stopAnyVideo();
                this.screenManager.showScreen('mainMenuScreen');
            }
            
            showStory() {
                console.log('üìñ È°ØÁ§∫ÊïÖ‰∫ã');
                this.screenManager.showScreen('storyScreen');
                // ‰∏çËá™ÂãïÊí≠ÊîæÂΩ±ÁâáÔºåËÆìÁî®Êà∂ÊéßÂà∂
            }
            
            stopAnyVideo() {
                if (this.currentVideo) {
                    this.currentVideo.pause();
                    this.currentVideo.currentTime = 0;
                    console.log('üõë ÂΩ±ÁâáÂ∑≤ÂÅúÊ≠¢‰∏¶ÈáçÁΩÆ');
                }
            }
            
            skipVideo() {
                console.log('‚è≠Ô∏è Ë∑≥ÈÅéÂΩ±Áâá');
                this.stopAnyVideo();
                this.showGameMenu();
            }
            
            continueFromVideo() {
                console.log('‚ñ∂Ô∏è ÂæûÂΩ±ÁâáÁπºÁ∫å');
                this.stopAnyVideo();
                this.showGameMenu();
            }
            
            showGameMenu() {
                console.log('üéÆ È°ØÁ§∫ÈÅäÊà≤ÈÅ∏ÂñÆ');
                this.screenManager.showScreen('gameMenuScreen');
                this.updateGameProgress();
            }
            
            updateGameProgress() {
                console.log('üìä Êõ¥Êñ∞ÈÅäÊà≤ÈÄ≤Â∫¶');
                
                const games = ['wordSearch', 'fallingWords', 'multipleChoice', 'bossFight'];
                games.forEach(gameId => {
                    const button = document.getElementById(gameId + 'Btn');
                    if (button) {
                        const progress = window.gameState.gameProgress[gameId];
                        
                        // ÁßªÈô§ÊâÄÊúâÁãÄÊÖãÈ°ûÂà•
                        button.classList.remove('locked', 'completed');
                        
                        if (progress.completed) {
                            button.classList.add('completed');
                        } else if (!progress.unlocked) {
                            button.classList.add('locked');
                        }
                    }
                });
            }
            
            startGame(gameId) {
                const progress = window.gameState.gameProgress[gameId];
                
                if (!progress.unlocked) {
                    this.showMessage('Ë´ãÂÖàÂÆåÊàêÂâçÈù¢ÁöÑÈÅäÊà≤ÊâçËÉΩËß£ÈéñÔºÅ', 'warning');
                    return;
                }
                
                console.log(`üöÄ ÈñãÂßãÈÅäÊà≤: ${gameId}`);
                window.gameState.currentGame = gameId;
                
                // È°ØÁ§∫ÈÅäÊà≤ÂÆπÂô®
                this.screenManager.showScreen('gameContainer');
                
                // ËºâÂÖ•ÈÅäÊà≤ÂÖßÂÆπ
                this.loadGameContent(gameId);
            }
            
            loadGameContent(gameId) {
                const gameContent = document.getElementById('gameContent');
                
                if (gameId === 'wordSearch') {
                    this.loadWordSearchGame(gameContent);
                } else if (gameId === 'fallingWords') {
                    this.loadFallingWordsGame(gameContent);
                } else if (gameId === 'multipleChoice') {
                    this.loadMultipleChoiceGame(gameContent);
                } else if (gameId === 'bossFight') {
                    this.loadBossFightGame(gameContent);
                } else {
                    // ÂÇôÁî®
                    gameContent.innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h2>üöß ${gameId} Âç≥Â∞áÊé®Âá∫ÔºÅ</h2>
                            <p>ÈÄôÂÄãÈÅäÊà≤Ê≠£Âú®ÈñãÁôº‰∏≠„ÄÇ</p>
                            <button onclick="window.gameSystem.showGameMenu()" style="
                                background: linear-gradient(45deg, #4ecca3, #2ecc71); color: white; border: none; 
                                padding: 15px 30px; border-radius: 10px; font-size: 16px; font-weight: bold; 
                                cursor: pointer; margin-top: 20px;">
                                üè† ËøîÂõûÈÅäÊà≤ÈÅ∏ÂñÆ
                            </button>
                        </div>
                    `;
                }
            }
            
            loadWordSearchGame(container) {
                console.log('üîç ËºâÂÖ•ÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤');
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px;">
                        
                        <!-- ÊïÖ‰∫ãÂ†¥ÊôØ -->
                        <div id="wordSearchStory" style="text-align: center; margin-bottom: 30px;">
                            <h1 style="font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                                üåâ Êñ∑Ê©ã‰øÆÂæ©ÊåëÊà∞
                            </h1>
                            
                            <!-- Ê©ãÊ®ëÂ†¥ÊôØ -->
                            <div class="bridge-scene">
                                <div class="cliff-left"></div>
                                <div class="cliff-right"></div>
                                
                                <div class="character">
                                    <div class="character-head"></div>
                                    <div class="character-body"></div>
                                </div>
                                
                                <div class="broken-bridge">
                                    <div class="bridge-stone complete"></div>
                                    <div class="bridge-stone complete"></div>
                                    <div class="bridge-stone missing" style="border-color: #3498db;"></div>
                                    <div class="bridge-stone missing" style="border-color: #e74c3c;"></div>
                                    <div class="bridge-stone missing" style="border-color: #2ecc71;"></div>
                                    <div class="bridge-stone complete"></div>
                                    <div class="bridge-stone complete"></div>
                                </div>
                            </div>
                            
                            <p style="font-size: 18px; margin: 20px auto; max-width: 600px; line-height: 1.6;">
                                Âè§ËÄÅÁöÑÁü≥Ê©ãÂ∑≤Á∂ìÁ†¥ÊêçÔºÅ‰Ω†ÂøÖÈ†àÂú®Â≠óÊØçÁ∂≤Ê†º‰∏≠ÊâæÂà∞ÈÅéÂéªÂºèÂñÆË©ûÔºå‰∏¶Ê†πÊìöÁôºÈü≥Ê≠£Á¢∫ÂàÜÈ°û‰æÜ‰øÆÂæ©Ê©ãÊ®ëÁü≥Â°ä„ÄÇ
                            </p>
                            
                            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 500px;">
                                <h3 style="color: #4ecca3; margin-bottom: 15px;">üéØ ‰ªªÂãôÁõÆÊ®ô</h3>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                                    <div>
                                        <div style="color: #3498db; font-size: 24px;">üîµ</div>
                                        <div style="font-weight: bold;">/t/ Èü≥</div>
                                        <div style="font-size: 14px;">ÈúÄË¶ÅÊâæÂà∞ 3 ÂÄã</div>
                                    </div>
                                    <div>
                                        <div style="color: #e74c3c; font-size: 24px;">üî¥</div>
                                        <div style="font-weight: bold;">/d/ Èü≥</div>
                                        <div style="font-size: 14px;">ÈúÄË¶ÅÊâæÂà∞ 3 ÂÄã</div>
                                    </div>
                                    <div>
                                        <div style="color: #2ecc71; font-size: 24px;">üü¢</div>
                                        <div style="font-weight: bold;">/…™d/ Èü≥</div>
                                        <div style="font-size: 14px;">ÈúÄË¶ÅÊâæÂà∞ 3 ÂÄã</div>
                                    </div>
                                </div>
                            </div>
                            
                            <button id="startWordSearchGame" style="
                                background: linear-gradient(45deg, #4ecca3, #2ecc71); color: white; border: none; 
                                padding: 20px 40px; border-radius: 15px; font-size: 20px; font-weight: bold; 
                                cursor: pointer; margin: 10px; box-shadow: 0 8px 25px rgba(76, 204, 163, 0.4);
                                animation: buttonGlow 2s ease-in-out infinite;">
                                üîç ÈñãÂßãÂñÆË©ûÊêúÁ¥¢
                            </button>
                            
                            <button onclick="window.gameSystem.showGameMenu()" style="
                                background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); 
                                padding: 20px 40px; border-radius: 15px; font-size: 20px; font-weight: bold; 
                                cursor: pointer; margin: 10px;">
                                üè† ËøîÂõûÈÅäÊà≤ÈÅ∏ÂñÆ
                            </button>
                        </div>
                        
                        <!-- ÈÅäÊà≤‰ªãÈù¢ÔºàÂàùÂßãÈö±ËóèÔºâ -->
                        <div id="wordSearchGame" style="display: none;">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <h2>üåâ Ê©ãÊ®ë‰øÆÂæ© - ÂñÆË©ûÊêúÁ¥¢</h2>
                                
                                <!-- ÈÄ≤Â∫¶È°ØÁ§∫ -->
                                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                                    <div style="text-align: center; min-width: 100px;">
                                        <div style="color: #3498db; font-weight: bold; margin-bottom: 5px;">/t/ Èü≥</div>
                                        <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                            <div id="progressT" style="width: 0%; height: 100%; background: #3498db; border-radius: 6px; transition: width 0.5s;"></div>
                                        </div>
                                        <div id="countT" style="font-size: 12px; margin-top: 5px;">0/3</div>
                                    </div>
                                    <div style="text-align: center; min-width: 100px;">
                                        <div style="color: #e74c3c; font-weight: bold; margin-bottom: 5px;">/d/ Èü≥</div>
                                        <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                            <div id="progressD" style="width: 0%; height: 100%; background: #e74c3c; border-radius: 6px; transition: width 0.5s;"></div>
                                        </div>
                                        <div id="countD" style="font-size: 12px; margin-top: 5px;">0/3</div>
                                    </div>
                                    <div style="text-align: center; min-width: 100px;">
                                        <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">/…™d/ Èü≥</div>
                                        <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                            <div id="progressID" style="width: 0%; height: 100%; background: #2ecc71; border-radius: 6px; transition: width 0.5s;"></div>
                                        </div>
                                        <div id="countID" style="font-size: 12px; margin-top: 5px;">0/3</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÁôºÈü≥ÈÅ∏Êìá -->
                            <div style="text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                <div style="margin-bottom: 15px; font-size: 16px; font-weight: bold;">ÈÅ∏ÊìáÁôºÈü≥È°ûÂûãÔºö</div>
                                <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                                    <button class="sound-btn" data-sound="t" style="background: #3498db;">üîµ /t/ Èü≥</button>
                                    <button class="sound-btn" data-sound="d" style="background: #e74c3c;">üî¥ /d/ Èü≥</button>
                                    <button class="sound-btn" data-sound="id" style="background: #2ecc71;">üü¢ /…™d/ Èü≥</button>
                                </div>
                                <div style="margin-top: 10px; font-size: 14px;">
                                    Áï∂ÂâçÈÅ∏Êìá: <span id="selectedSound" style="color: #fbbf24; font-weight: bold;">Ë´ãÈÅ∏Êìá</span>
                                </div>
                            </div>
                            
                            <!-- Â≠óÊØçÁ∂≤Ê†º -->
                            <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                                <div id="letterGrid"></div>
                            </div>
                            
                            <!-- ÊéßÂà∂ÂçÄÂüü -->
                            <div style="text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                <div style="margin-bottom: 15px; font-size: 16px;">
                                    ÈÅ∏‰∏≠ÁöÑÂñÆË©û: <span id="selectedWord" style="color: #fbbf24; font-weight: bold; font-size: 18px;">ÁÑ°</span>
                                </div>
                                <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                                    <button id="confirmBtn" class="control-btn" style="background: #4ecca3;" disabled>‚úÖ Á¢∫Ë™ç</button>
                                    <button id="clearBtn" class="control-btn" style="background: #f39c12;">üîÑ Ê∏ÖÈô§</button>
                                    <button id="pronounceBtn" class="control-btn" style="background: #9b59b6;" disabled>üîä ÁôºÈü≥</button>
                                    <button onclick="window.gameSystem.showGameMenu()" class="control-btn" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);">üè† ËøîÂõû</button>
                                </div>
                            </div>
                            
                            <!-- Â∑≤ÊâæÂà∞ÁöÑÂñÆË©û -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 600px; margin: 0 auto;">
                                <div style="background: rgba(52, 152, 219, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #3498db;">
                                    <h4 style="color: #3498db; margin: 0 0 10px 0; text-align: center;">üîµ /t/ ÂñÆË©û</h4>
                                    <div id="foundWordsT" style="min-height: 60px;"></div>
                                </div>
                                <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #e74c3c;">
                                    <h4 style="color: #e74c3c; margin: 0 0 10px 0; text-align: center;">üî¥ /d/ ÂñÆË©û</h4>
                                    <div id="foundWordsD" style="min-height: 60px;"></div>
                                </div>
                                <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #2ecc71;">
                                    <h4 style="color: #2ecc71; margin: 0 0 10px 0; text-align: center;">üü¢ /…™d/ ÂñÆË©û</h4>
                                    <div id="foundWordsID" style="min-height: 60px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <style>
                    @keyframes buttonGlow {
                        0%, 100% { 
                            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.4);
                            transform: scale(1);
                        }
                        50% { 
                            box-shadow: 0 12px 35px rgba(76, 204, 163, 0.8);
                            transform: scale(1.05);
                        }
                    }
                    </style>
                `;
                
                // Ë®≠ÁΩÆÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤
                this.setupWordSearchGame();
            }
            
            loadFallingWordsGame(container) {
                console.log('‚öîÔ∏è ËºâÂÖ•ËêΩÂ≠óÈÅäÊà≤');
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                            ‚öîÔ∏è ÂñÆË©ûÊà∞Â£´
                        </h1>
                        
                        <p style="font-size: 18px; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            Áî®‰Ω†ÁöÑÂäçÊñ¨ÈñãÂ∏∂ÊúâÊ≠£Á¢∫ÁôºÈü≥ÁöÑÁü≥Â°äÔºÅÈÅ∏ÊìáÁõÆÊ®ôÁôºÈü≥È°ûÂûãÔºåÁÑ∂ÂæåÈªûÊìäÁõ∏ÊáâÁöÑÂñÆË©û‰æÜÂæóÂàÜ„ÄÇ
                        </p>
                        
                        <!-- ÈÅäÊà≤Áµ±Ë®à -->
                        <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="color: #4ecca3; font-size: 24px; font-weight: bold;">ÂæóÂàÜ</div>
                                <div id="fallingScore" style="font-size: 32px;">0</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #f39c12; font-size: 24px; font-weight: bold;">ÊôÇÈñì</div>
                                <div id="fallingTime" style="font-size: 32px;">60</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #e74c3c; font-size: 24px; font-weight: bold;">ÁõÆÊ®ô</div>
                                <div id="fallingTarget" style="font-size: 18px;">/t/ Èü≥</div>
                            </div>
                        </div>
                        
                        <!-- ÁôºÈü≥ÈÅ∏Êìá -->
                        <div style="margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; display: inline-block;">
                            <div style="margin-bottom: 10px; font-weight: bold;">ÈÅ∏ÊìáÁõÆÊ®ôÁôºÈü≥:</div>
                            <div style="display: flex; gap: 10px;">
                                <button class="falling-sound-btn" data-sound="t" style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üîµ /t/</button>
                                <button class="falling-sound-btn" data-sound="d" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üî¥ /d/</button>
                                <button class="falling-sound-btn" data-sound="id" style="background: #2ecc71; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üü¢ /…™d/</button>
                            </div>
                        </div>
                        
                        <!-- ÈÅäÊà≤ÂçÄÂüü -->
                        <div style="position: relative; display: inline-block; margin-bottom: 20px;">
                            <canvas id="fallingWordsCanvas" width="450" height="600" style="border: 3px solid rgba(255,255,255,0.3); border-radius: 10px; background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);"></canvas>
                            <div id="fallingGameOver" style="
                                position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                                background: rgba(0,0,0,0.9); color: white; padding: 30px; border-radius: 15px; 
                                text-align: center; display: none;">
                                <h2>üéâ ÈÅäÊà≤ÁµêÊùüÔºÅ</h2>
                                <div id="finalScore" style="font-size: 24px; margin: 15px 0;"></div>
                                <button id="playAgainBtn" style="background: #4ecca3; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin: 5px;">üîÑ ÂÜçÁé©‰∏ÄÊ¨°</button>
                                <button onclick="window.gameSystem.showGameMenu()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 10px 20px; border-radius: 8px; cursor: pointer; margin: 5px;">üè† ËøîÂõû</button>
                            </div>
                        </div>
                        
                        <!-- ÊéßÂà∂ÊåâÈàï -->
                        <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                            <button id="startFallingBtn" style="background: #4ecca3; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">‚ñ∂Ô∏è ÈñãÂßãÈÅäÊà≤</button>
                            <button id="pauseFallingBtn" style="background: #f39c12; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;" disabled>‚è∏Ô∏è Êö´ÂÅú</button>
                            <button onclick="window.gameSystem.showGameMenu()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">üè† ËøîÂõû</button>
                        </div>
                        
                        <!-- ÈÅäÊà≤Ë™™Êòé -->
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            <h3 style="color: #4ecca3; margin-bottom: 15px;">üéÆ ÈÅäÊà≤Ë™™Êòé</h3>
                            <ul style="text-align: left; padding-left: 20px; line-height: 1.8;">
                                <li>ÈÅ∏Êìá‰∏ÄÂÄãÁõÆÊ®ôÁôºÈü≥È°ûÂûã (/t/, /d/, Êàñ /…™d/)</li>
                                <li>Âæû‰∏äÊñπËêΩ‰∏ãÁöÑÂñÆË©û‰∏≠ÈªûÊìäÊ≠£Á¢∫ÁôºÈü≥ÁöÑÂñÆË©û</li>
                                <li>Ê≠£Á¢∫ÁöÑÂñÆË©ûÁµ¶ 10 ÂàÜÔºåÈåØË™§ÁöÑÊâ£ 5 ÂàÜ</li>
                                <li>Âú® 60 ÁßíÂÖßÂæóÂà∞Áõ°ÂèØËÉΩÈ´òÁöÑÂàÜÊï∏</li>
                                <li>ÈÅîÂà∞ 100 ÂàÜÂÆåÊàêÈÅäÊà≤‰∏¶Ëß£Èéñ‰∏ã‰∏ÄÈóú</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                this.setupFallingWordsGame();
            }
            
            loadMultipleChoiceGame(container) {
                console.log('üßô‚Äç‚ôÇÔ∏è ËºâÂÖ•ÈÅ∏ÊìáÈ°åÈÅäÊà≤');
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                            üßô‚Äç‚ôÇÔ∏è ÁôºÈü≥Â§ßÂ∏´
                        </h1>
                        <p style="font-size: 18px; margin-bottom: 30px;">ËÅΩÁôºÈü≥ÈÅ∏ÊìáÊ≠£Á¢∫ÁöÑÈ°ûÂûãÔºåÊàêÁÇ∫ÁúüÊ≠£ÁöÑÁôºÈü≥Â§ßÂ∏´ÔºÅ</p>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; max-width: 600px; margin: 0 auto;">
                            <div id="mcProgress" style="margin-bottom: 20px; font-size: 18px; font-weight: bold;">ÂïèÈ°å 1 / 10</div>
                            
                            <div id="mcWord" style="font-size: 48px; margin: 30px 0; color: #4ecca3; font-weight: bold;">PLAYED</div>
                            
                            <button id="mcPlayBtn" style="
                                background: #9b59b6; color: white; border: none; padding: 15px 30px; 
                                border-radius: 10px; font-size: 18px; margin-bottom: 30px; cursor: pointer;">
                                üîä Êí≠ÊîæÁôºÈü≥
                            </button>
                            
                            <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                                <button class="mc-option" data-answer="t" style="
                                    background: rgba(52, 152, 219, 0.2); border: 2px solid #3498db; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    üîµ /t/ Èü≥ (Â¶Ç: watched, kicked)
                                </button>
                                <button class="mc-option" data-answer="d" style="
                                    background: rgba(231, 76, 60, 0.2); border: 2px solid #e74c3c; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    üî¥ /d/ Èü≥ (Â¶Ç: played, lived)
                                </button>
                                <button class="mc-option" data-answer="id" style="
                                    background: rgba(46, 204, 113, 0.2); border: 2px solid #2ecc71; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    üü¢ /…™d/ Èü≥ (Â¶Ç: wanted, needed)
                                </button>
                            </div>
                            
                            <div id="mcScore" style="font-size: 20px; font-weight: bold;">ÂæóÂàÜ: <span style="color: #4ecca3;">0</span> / 10</div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button onclick="window.gameSystem.showGameMenu()" style="
                                background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); 
                                padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                                üè† ËøîÂõûÈÅäÊà≤ÈÅ∏ÂñÆ
                            </button>
                        </div>
                    </div>
                `;
                
                this.setupMultipleChoiceGame();
            }
            
            loadBossFightGame(container) {
                console.log('üëë ËºâÂÖ•BossÊà∞ÈÅäÊà≤');
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; text-align: center;">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                            üëë ÁôºÈü≥‰πãÁéãÊåëÊà∞
                        </h1>
                        <p style="font-size: 18px; margin-bottom: 30px;">Èù¢Â∞çÊúÄÁµÇÊåëÊà∞ÔºåÊìäÊïóÁôºÈü≥‰πãÁéãÔºÅ</p>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; max-width: 800px; margin: 0 auto;">
                            <h2 style="color: #fbbf24; margin-bottom: 30px;">üèÜ ÊÅ≠ÂñúÂÆåÊàêÊâÄÊúâÊåëÊà∞ÔºÅ</h2>
                            
                            <div style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 10px; margin: 20px 0;">
                                <h3 style="color: #4ecca3; margin-bottom: 20px;">üéì ‰Ω†Â∑≤Á∂ìÊéåÊè°‰∫ÜËã±Ë™ûÈÅéÂéªÂºèÁôºÈü≥ÔºÅ</h3>
                                
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 48px; margin-bottom: 10px;">üîµ</div>
                                        <div style="font-weight: bold; color: #3498db;">/t/ Èü≥</div>
                                        <div style="font-size: 14px; opacity: 0.8;">watched, kicked, helped</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 48px; margin-bottom: 10px;">üî¥</div>
                                        <div style="font-weight: bold; color: #e74c3c;">/d/ Èü≥</div>
                                        <div style="font-size: 14px; opacity: 0.8;">played, lived, moved</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 48px; margin-bottom: 10px;">üü¢</div>
                                        <div style="font-weight: bold; color: #2ecc71;">/…™d/ Èü≥</div>
                                        <div style="font-size: 14px; opacity: 0.8;">wanted, needed, decided</div>
                                    </div>
                                </div>
                                
                                <p style="font-size: 18px; margin: 20px 0; line-height: 1.6;">
                                    ÁèæÂú®‰Ω†Â∑≤Á∂ìÂèØ‰ª•Ê≠£Á¢∫ÂçÄÂàÜËã±Ë™ûÈÅéÂéªÂºèÁöÑ‰∏âÁ®ÆÁôºÈü≥‰∫ÜÔºÅ<br>
                                    ÁπºÁ∫åÁ∑¥ÁøíÔºåËÆìÈÄô‰∫õÁü•Ë≠òÊàêÁÇ∫‰Ω†ÁöÑÁ¨¨‰∫åÂ§©ÊÄß„ÄÇ
                                </p>
                            </div>
                            
                            <div style="margin-top: 30px;">
                                <button onclick="window.gameSystem.resetAllProgress()" style="
                                    background: linear-gradient(45deg, #4ecca3, #2ecc71); color: white; border: none; 
                                    padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; 
                                    cursor: pointer; margin: 10px;">
                                    üîÑ ÈáçÊñ∞ÈñãÂßãÂÜíÈö™
                                </button>
                                <button onclick="window.gameSystem.showGameMenu()" style="
                                    background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); 
                                    padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; 
                                    cursor: pointer; margin: 10px;">
                                    üè† ËøîÂõûÈÅ∏ÂñÆ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            setupWordSearchGame() {
                console.log('üéØ Ë®≠ÁΩÆÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤ÈÇèËºØ');
                
                const wordSearchGame = new WordSearchGameLogic();
                
                // ÈñãÂßãÊåâÈàï
                document.getElementById('startWordSearchGame').onclick = () => {
                    document.getElementById('wordSearchStory').style.display = 'none';
                    document.getElementById('wordSearchGame').style.display = 'block';
                    wordSearchGame.startGame();
                };
            }
            
            setupFallingWordsGame() {
                console.log('‚öîÔ∏è Ë®≠ÁΩÆËêΩÂ≠óÈÅäÊà≤ÈÇèËºØ');
                const fallingGame = new FallingWordsGameLogic();
                fallingGame.init();
            }
            
            setupMultipleChoiceGame() {
                console.log('üßô‚Äç‚ôÇÔ∏è Ë®≠ÁΩÆÈÅ∏ÊìáÈ°åÈÅäÊà≤ÈÇèËºØ');
                const mcGame = new MultipleChoiceGameLogic();
                mcGame.init();
            }
            
            completeGame(gameId) {
                console.log(`‚úÖ ÈÅäÊà≤ÂÆåÊàê: ${gameId}`);
                window.gameState.gameProgress[gameId].completed = true;
                
                // Ëß£Èéñ‰∏ã‰∏ÄÂÄãÈÅäÊà≤ - ‰øÆÂæ©Ëá™ÂãïËß£ÈéñÂïèÈ°å
                const gameOrder = ['wordSearch', 'fallingWords', 'multipleChoice', 'bossFight'];
                const currentIndex = gameOrder.indexOf(gameId);
                if (currentIndex >= 0 && currentIndex < gameOrder.length - 1) {
                    const nextGame = gameOrder[currentIndex + 1];
                    window.gameState.gameProgress[nextGame].unlocked = true;
                    console.log(`üîì Â∑≤Ëß£Èéñ: ${nextGame}`);
                    
                    this.showMessage(`üéâ ${gameId} ÂÆåÊàêÔºÅ${nextGame} Â∑≤Ëß£ÈéñÔºÅ`, 'success', 4000);
                } else {
                    this.showMessage(`üéâ ${gameId} ÂÆåÊàêÔºÅ`, 'success', 3000);
                }
                
                // Ëá™ÂãïËøîÂõûÈÅ∏ÂñÆ‰∏¶Êõ¥Êñ∞ÈÄ≤Â∫¶
                setTimeout(() => {
                    this.showGameMenu();
                }, 3000);
            }
            
            resetAllProgress() {
                window.gameState.gameProgress = {
                    wordSearch: { completed: false, unlocked: true },
                    fallingWords: { completed: false, unlocked: false },
                    multipleChoice: { completed: false, unlocked: false },
                    bossFight: { completed: false, unlocked: false }
                };
                this.showMessage('üîÑ ÈÄ≤Â∫¶Â∑≤ÈáçÁΩÆÔºÅ', 'info');
                this.showGameMenu();
            }
            
            showInstructions() {
                this.showMessage('ÊâæÂà∞ÈÅéÂéªÂºèÂñÆË©û‰∏¶Ê†πÊìöÁôºÈü≥ÂàÜÈ°ûÔºö/t/„ÄÅ/d/ Êàñ /…™d/ÔºÅ', 'info', 5000);
            }
            
            showCredits() {
                this.showMessage('Áî® ‚ù§Ô∏è ÁÇ∫Ëã±Ë™ûÂ≠∏ÁøíÂÜíÈö™ËÄåË£Ω‰ΩúÔºÅ', 'info', 3000);
            }
            
            toggleLanguage() {
                const newLang = window.gameState.currentLanguage === 'zh' ? 'en' : 'zh';
                this.updateLanguage(newLang);
            }
            
            updateLanguage(lang) {
                window.gameState.currentLanguage = lang;
                const t = window.translations[lang];
                
                // Êõ¥Êñ∞UIÂÖÉÁ¥†
                document.getElementById('gameTitle').textContent = t.gameTitle;
                document.getElementById('startGameBtn').textContent = t.startGame;
                document.getElementById('instructionsBtn').textContent = t.instructions;
                document.getElementById('creditsBtn').textContent = t.credits;
                document.getElementById('gameMenuTitle').textContent = t.gameMenuTitle;
                document.getElementById('languageToggle').textContent = t.languageToggle;
                
                console.log(`üåê Ë™ûË®ÄÂ∑≤ÂàáÊèõÂà∞: ${lang}`);
            }
            
            showMessage(text, type = 'success', duration = 3000) {
                // ÁßªÈô§ÁèæÊúâË®äÊÅØ
                const existing = document.querySelector('.message');
                if (existing) existing.remove();
                
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                document.body.appendChild(message);
                
                setTimeout(() => {
                    if (message.parentNode) {
                        message.style.opacity = '0';
                        setTimeout(() => {
                            if (message.parentNode) message.parentNode.removeChild(message);
                        }, 300);
                    }
                }, duration);
            }
        }
        
        // ÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤ÈÇèËºØ
        class WordSearchGameLogic {
            constructor() {
                this.selectedSound = null;
                this.selectedCells = [];
                this.foundWords = { t: [], d: [], id: [] };
                this.progress = { t: 0, d: 0, id: 0 };
                this.boardSize = 10;
                this.gameBoard = [];
                
                // ÂñÆË©ûË≥áÊñôÂ∫´
                this.wordDatabase = {
                    t: ['WATCHED', 'KICKED', 'HELPED', 'WORKED', 'WASHED', 'PASSED'],
                    d: ['PLAYED', 'LIVED', 'MOVED', 'LOVED', 'OPENED', 'CLOSED'],
                    id: ['WANTED', 'NEEDED', 'DECIDED', 'STARTED', 'ENDED', 'VISITED']
                };
                
                this.targetWords = [];
            }
            
            startGame() {
                console.log('üéÆ ÈñãÂßãÂñÆË©ûÊêúÁ¥¢ÈÅäÊà≤ÈÇèËºØ');
                this.generateBoard();
                this.renderBoard();
                this.setupControls();
            }
            
            generateBoard() {
                console.log('üé≤ ÁîüÊàêÈÅäÊà≤Ê£ãÁõ§');
                
                // ÂâµÂª∫Á©∫Ê£ãÁõ§
                this.gameBoard = Array(this.boardSize).fill().map(() => Array(this.boardSize).fill(''));
                
                // ÈÅ∏ÊìáË¶ÅÊîæÁΩÆÁöÑÂñÆË©û
                Object.keys(this.wordDatabase).forEach(type => {
                    this.wordDatabase[type].slice(0, 4).forEach(word => {
                        this.targetWords.push({ word, type });
                    });
                });
                
                console.log('ÁõÆÊ®ôÂñÆË©û:', this.targetWords);
                
                // ÊîæÁΩÆÂñÆË©û
                let placedCount = 0;
                this.targetWords.forEach(wordObj => {
                    if (this.placeWord(wordObj.word)) {
                        placedCount++;
                        console.log(`‚úÖ Â∑≤ÊîæÁΩÆ: ${wordObj.word}`);
                    }
                });
                
                // Â°´ÂÖÖÁ©∫Ê†ºÂ≠ê
                for (let row = 0; row < this.boardSize; row++) {
                    for (let col = 0; col < this.boardSize; col++) {
                        if (this.gameBoard[row][col] === '') {
                            this.gameBoard[row][col] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                        }
                    }
                }
                
                console.log(`‚úÖ Ê£ãÁõ§ÁîüÊàêÂÆåÊàêÔºåÊàêÂäüÊîæÁΩÆ ${placedCount} ÂÄãÂñÆË©û`);
            }
            
            placeWord(word) {
                const directions = [
                    [0, 1],   // Ê∞¥Âπ≥ÂêëÂè≥
                    [1, 0],   // ÂûÇÁõ¥Âêë‰∏ã
                    [1, 1],   // ÊñúÂêëÂè≥‰∏ã
                    [-1, 1]   // ÊñúÂêëÂè≥‰∏ä
                ];
                
                for (let attempt = 0; attempt < 100; attempt++) {
                    const dir = directions[Math.floor(Math.random() * directions.length)];
                    const row = Math.floor(Math.random() * this.boardSize);
                    const col = Math.floor(Math.random() * this.boardSize);
                    
                    if (this.canPlaceWord(word, row, col, dir)) {
                        for (let i = 0; i < word.length; i++) {
                            const r = row + dir[0] * i;
                            const c = col + dir[1] * i;
                            this.gameBoard[r][c] = word[i];
                        }
                        return true;
                    }
                }
                return false;
            }
            
            canPlaceWord(word, row, col, dir) {
                for (let i = 0; i < word.length; i++) {
                    const r = row + dir[0] * i;
                    const c = col + dir[1] * i;
                    
                    if (r < 0 || r >= this.boardSize || c < 0 || c >= this.boardSize) return false;
                    if (this.gameBoard[r][c] !== '' && this.gameBoard[r][c] !== word[i]) return false;
                }
                return true;
            }
            
            renderBoard() {
                const grid = document.getElementById('letterGrid');
                grid.innerHTML = '';
                
                console.log('üé® Ê∏≤ÊüìÂ≠óÊØçÁ∂≤Ê†º');
                
                for (let row = 0; row < this.boardSize; row++) {
                    for (let col = 0; col < this.boardSize; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'letter-cell';
                        cell.textContent = this.gameBoard[row][col];
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.onclick = () => this.selectCell(row, col);
                        grid.appendChild(cell);
                    }
                }
                
                console.log(`‚úÖ Ê£ãÁõ§Ê∏≤ÊüìÂÆåÊàêÔºåÂÖ± ${grid.children.length} ÂÄãÂ≠óÊØçÊ†ºÂ≠ê`);
            }
            
            setupControls() {
                console.log('üéÆ Ë®≠ÁΩÆÈÅäÊà≤ÊéßÂà∂');
                
                // ÁôºÈü≥ÊåâÈàï
                document.querySelectorAll('.sound-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedSound = btn.dataset.sound;
                        
                        const soundNames = { t: '/t/ Èü≥', d: '/d/ Èü≥', id: '/…™d/ Èü≥' };
                        document.getElementById('selectedSound').textContent = soundNames[this.selectedSound];
                        
                        console.log(`üîä ÈÅ∏ÊìáÁôºÈü≥: ${this.selectedSound}`);
                    };
                });
                
                // ÊéßÂà∂ÊåâÈàï
                document.getElementById('confirmBtn').onclick = () => this.confirmWord();
                document.getElementById('clearBtn').onclick = () => this.clearSelection();
                document.getElementById('pronounceBtn').onclick = () => this.pronounceWord();
            }
            
            selectCell(row, col) {
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                
                if (cell.classList.contains('selected')) {
                    // ÂèñÊ∂àÈÅ∏Êìá
                    cell.classList.remove('selected');
                    this.selectedCells = this.selectedCells.filter(c => !(c.row === row && c.col === col));
                } else {
                    // ÈÅ∏ÊìáÊ†ºÂ≠ê
                    cell.classList.add('selected');
                    this.selectedCells.push({ row, col });
                }
                
                this.updateSelectedWord();
            }
            
            updateSelectedWord() {
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('');
                document.getElementById('selectedWord').textContent = word || 'ÁÑ°';
                
                const confirmBtn = document.getElementById('confirmBtn');
                const pronounceBtn = document.getElementById('pronounceBtn');
                
                if (word.length >= 3) {
                    confirmBtn.disabled = false;
                    pronounceBtn.disabled = false;
                } else {
                    confirmBtn.disabled = true;
                    pronounceBtn.disabled = true;
                }
            }
            
            confirmWord() {
                if (!this.selectedSound) {
                    window.gameSystem.showMessage('Ë´ãÂÖàÈÅ∏ÊìáÁôºÈü≥È°ûÂûãÔºÅ', 'warning');
                    return;
                }
                
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('');
                const wordObj = this.targetWords.find(w => w.word === word);
                
                if (wordObj && wordObj.type === this.selectedSound && !this.foundWords[wordObj.type].includes(word)) {
                    // Ê≠£Á¢∫ÔºÅ
                    this.foundWords[wordObj.type].push(word);
                    this.progress[wordObj.type]++;
                    
                    // Ê®ôË®òÊ†ºÂ≠êÁÇ∫Â∑≤ÊâæÂà∞
                    this.selectedCells.forEach(cell => {
                        const cellEl = document.querySelector(`[data-row="${cell.row}"][data-col="${cell.col}"]`);
                        cellEl.classList.add('found');
                        cellEl.classList.remove('selected');
                    });
                    
                    // Ê∑ªÂä†Âà∞Â∑≤ÊâæÂà∞ÂñÆË©ûÂàóË°®
                    const listEl = document.getElementById(`foundWords${wordObj.type.toUpperCase()}`);
                    const wordEl = document.createElement('div');
                    wordEl.className = 'word-item found';
                    wordEl.textContent = word.toLowerCase();
                    listEl.appendChild(wordEl);
                    
                    // Êõ¥Êñ∞ÈÄ≤Â∫¶
                    this.updateProgress(wordObj.type);
                    
                    window.gameSystem.showMessage(`‚úÖ Ê≠£Á¢∫ÔºÅ${word.toLowerCase()} ÊòØ /${wordObj.type}/ Èü≥`, 'success');
                    
                    console.log(`‚úÖ ÊâæÂà∞Ê≠£Á¢∫ÂñÆË©û: ${word} (${wordObj.type})`);
                    
                    // Ê™¢Êü•ÂãùÂà©Ê¢ù‰ª∂
                    if (this.progress.t >= 3 && this.progress.d >= 3 && this.progress.id >= 3) {
                        setTimeout(() => {
                            window.gameSystem.showMessage('üéâ Ê©ãÊ®ë‰øÆÂæ©ÂÆåÊàêÔºÅÈÅäÊà≤ÈÄöÈóúÔºÅ', 'success', 4000);
                            // ‰øÆÂæ©ÔºöÁ¢∫‰øùËá™ÂãïËß£Èéñ‰∏ã‰∏ÄÂÄãÈÅäÊà≤
                            window.gameSystem.completeGame('wordSearch');
                        }, 1000);
                    }
                } else if (wordObj && this.foundWords[wordObj.type].includes(word)) {
                    window.gameSystem.showMessage('ÈÄôÂÄãÂñÆË©ûÂ∑≤Á∂ìÊâæÈÅé‰∫ÜÔºÅ', 'warning');
                } else {
                    window.gameSystem.showMessage('‚ùå ÈåØË™§ÔºÅË´ãÂÜçË©¶‰∏ÄÊ¨°„ÄÇ', 'error');
                }
                
                this.clearSelection();
            }
            
            updateProgress(type) {
                const count = this.progress[type];
                const percentage = (count / 3) * 100;
                const progressBar = document.getElementById(`progress${type.toUpperCase()}`);
                const countEl = document.getElementById(`count${type.toUpperCase()}`);
                
                if (progressBar) progressBar.style.width = `${percentage}%`;
                if (countEl) countEl.textContent = `${count}/3`;
            }
            
            clearSelection() {
                document.querySelectorAll('.letter-cell.selected').forEach(cell => {
                    cell.classList.remove('selected');
                });
                this.selectedCells = [];
                this.updateSelectedWord();
            }
            
            pronounceWord() {
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('').toLowerCase();
                if (word && window.speechSynthesis) {
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            }
        }
        
        // ËêΩÂ≠óÈÅäÊà≤ÈÇèËºØ
        class FallingWordsGameLogic {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.isPlaying = false;
                this.isPaused = false;
                this.score = 0;
                this.timeLeft = 60;
                this.targetSound = 't';
                this.fallingWords = [];
                this.gameTimer = null;
                this.spawnTimer = null;
                
                this.wordDatabase = {
                    t: ['watched', 'kicked', 'helped', 'worked', 'washed'],
                    d: ['played', 'lived', 'moved', 'loved', 'opened'],
                    id: ['wanted', 'needed', 'decided', 'started', 'ended']
                };
            }
            
            init() {
                this.canvas = document.getElementById('fallingWordsCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // Ë®≠ÁΩÆÊåâÈàï
                document.getElementById('startFallingBtn').onclick = () => this.startGame();
                document.getElementById('pauseFallingBtn').onclick = () => this.togglePause();
                document.getElementById('playAgainBtn').onclick = () => this.resetGame();
                
                // ÁôºÈü≥ÈÅ∏Êìá
                document.querySelectorAll('.falling-sound-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.falling-sound-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.targetSound = btn.dataset.sound;
                        document.getElementById('fallingTarget').textContent = `/${btn.dataset.sound}/ Èü≥`;
                    };
                });
                
                // ÈªûÊìäÁï´Â∏É‰∫ã‰ª∂
                this.canvas.onclick = (e) => this.handleClick(e);
                
                // ÂàùÂßãÂåñÁ¨¨‰∏ÄÂÄãÁõÆÊ®ô
                document.querySelector('.falling-sound-btn').click();
            }
            
            startGame() {
                this.isPlaying = true;
                this.isPaused = false;
                this.score = 0;
                this.timeLeft = 60;
                this.fallingWords = [];
                
                document.getElementById('startFallingBtn').disabled = true;
                document.getElementById('pauseFallingBtn').disabled = false;
                document.getElementById('fallingGameOver').style.display = 'none';
                
                this.gameTimer = setInterval(() => this.updateGame(), 1000/60); // 60 FPS
                this.spawnTimer = setInterval(() => this.spawnWord(), 2000); // ÊØè2ÁßíÁîüÊàê‰∏ÄÂÄãÂñÆË©û
                
                console.log('‚öîÔ∏è ËêΩÂ≠óÈÅäÊà≤ÈñãÂßã');
            }
            
            updateGame() {
                if (this.isPaused) return;
                
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Êõ¥Êñ∞ÊôÇÈñì
                this.timeLeft -= 1/60;
                document.getElementById('fallingTime').textContent = Math.ceil(this.timeLeft);
                
                // Êõ¥Êñ∞ÂàÜÊï∏
                document.getElementById('fallingScore').textContent = this.score;
                
                // Êõ¥Êñ∞ËêΩÂ≠ó
                for (let i = this.fallingWords.length - 1; i >= 0; i--) {
                    const word = this.fallingWords[i];
                    word.y += word.speed;
                    
                    // Áπ™Ë£ΩÂñÆË©û
                    this.drawWord(word);
                    
                    // ÁßªÈô§Ë∂ÖÂá∫Áï´Èù¢ÁöÑÂñÆË©û
                    if (word.y > this.canvas.height) {
                        this.fallingWords.splice(i, 1);
                    }
                }
                
                // Ê™¢Êü•ÈÅäÊà≤ÁµêÊùü
                if (this.timeLeft <= 0) {
                    this.endGame();
                }
            }
            
            drawWord(word) {
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                
                // ËÉåÊôØ
                const colors = { t: '#3498db', d: '#e74c3c', id: '#2ecc71' };
                this.ctx.fillStyle = colors[word.type];
                this.ctx.fillRect(word.x - 40, word.y - 15, 80, 30);
                
                // ÊñáÂ≠ó
                this.ctx.fillStyle = 'white';
                this.ctx.fillText(word.text, word.x, word.y + 5);
            }
            
            spawnWord() {
                if (!this.isPlaying || this.isPaused) return;
                
                const types = ['t', 'd', 'id'];
                const randomType = types[Math.floor(Math.random() * types.length)];
                const words = this.wordDatabase[randomType];
                const randomWord = words[Math.floor(Math.random() * words.length)];
                
                this.fallingWords.push({
                    text: randomWord,
                    type: randomType,
                    x: Math.random() * (this.canvas.width - 100) + 50,
                    y: -30,
                    speed: 1 + Math.random() * 2
                });
            }
            
            handleClick(e) {
                if (!this.isPlaying || this.isPaused) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;
                
                for (let i = this.fallingWords.length - 1; i >= 0; i--) {
                    const word = this.fallingWords[i];
                    
                    if (clickX >= word.x - 40 && clickX <= word.x + 40 &&
                        clickY >= word.y - 15 && clickY <= word.y + 15) {
                        
                        if (word.type === this.targetSound) {
                            this.score += 10;
                            window.gameSystem.showMessage(`‚úÖ Ê≠£Á¢∫ÔºÅ+10 ÂàÜ`, 'success', 1000);
                        } else {
                            this.score -= 5;
                            window.gameSystem.showMessage(`‚ùå ÈåØË™§ÔºÅ-5 ÂàÜ`, 'error', 1000);
                        }
                        
                        this.fallingWords.splice(i, 1);
                        break;
                    }
                }
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                document.getElementById('pauseFallingBtn').textContent = this.isPaused ? '‚ñ∂Ô∏è ÁπºÁ∫å' : '‚è∏Ô∏è Êö´ÂÅú';
            }
            
            endGame() {
                this.isPlaying = false;
                clearInterval(this.gameTimer);
                clearInterval(this.spawnTimer);
                
                document.getElementById('startFallingBtn').disabled = false;
                document.getElementById('pauseFallingBtn').disabled = true;
                document.getElementById('finalScore').textContent = `ÊúÄÁµÇÂæóÂàÜ: ${this.score}`;
                document.getElementById('fallingGameOver').style.display = 'block';
                
                if (this.score >= 100) {
                    window.gameSystem.showMessage('üéâ ÈÅîÂà∞ÁõÆÊ®ôÂàÜÊï∏ÔºÅÈÅäÊà≤ÂÆåÊàêÔºÅ', 'success');
                    window.gameSystem.completeGame('fallingWords');
                }
                
                console.log('‚öîÔ∏è ËêΩÂ≠óÈÅäÊà≤ÁµêÊùüÔºåÂæóÂàÜ:', this.score);
            }
            
            resetGame() {
                this.endGame();
                this.score = 0;
                this.timeLeft = 60;
                this.fallingWords = [];
                document.getElementById('fallingGameOver').style.display = 'none';
                this.startGame();
            }
        }
        
        // ÈÅ∏ÊìáÈ°åÈÅäÊà≤ÈÇèËºØ
        class MultipleChoiceGameLogic {
            constructor() {
                this.currentQuestion = 0;
                this.totalQuestions = 10;
                this.score = 0;
                this.questions = [];
                
                this.wordDatabase = {
                    t: ['watched', 'kicked', 'helped', 'worked', 'washed', 'passed', 'crossed', 'danced'],
                    d: ['played', 'lived', 'moved', 'loved', 'opened', 'closed', 'turned', 'learned'],
                    id: ['wanted', 'needed', 'decided', 'started', 'ended', 'visited', 'created', 'painted']
                };
            }
            
            init() {
                this.generateQuestions();
                this.setupControls();
                this.showQuestion();
            }
            
            generateQuestions() {
                const allWords = [];
                Object.keys(this.wordDatabase).forEach(type => {
                    this.wordDatabase[type].forEach(word => {
                        allWords.push({ word, type });
                    });
                });
                
                // Èö®Ê©üÈÅ∏Êìá10ÂÄãÂïèÈ°å
                for (let i = 0; i < this.totalQuestions; i++) {
                    const randomIndex = Math.floor(Math.random() * allWords.length);
                    this.questions.push(allWords[randomIndex]);
                    allWords.splice(randomIndex, 1);
                }
                
                console.log('üßô‚Äç‚ôÇÔ∏è ÁîüÊàêÈÅ∏ÊìáÈ°å:', this.questions);
            }
            
            setupControls() {
                document.getElementById('mcPlayBtn').onclick = () => this.playWordSound();
                
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.onclick = () => this.selectAnswer(btn.dataset.answer);
                });
            }
            
            showQuestion() {
                if (this.currentQuestion >= this.totalQuestions) {
                    this.endGame();
                    return;
                }
                
                const question = this.questions[this.currentQuestion];
                document.getElementById('mcWord').textContent = question.word.toUpperCase();
                document.getElementById('mcProgress').textContent = `ÂïèÈ°å ${this.currentQuestion + 1} / ${this.totalQuestions}`;
                
                // ÈáçÁΩÆÈÅ∏È†ÖÊ®£Âºè
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.style.background = btn.style.background.replace('0.8', '0.2');
                    btn.disabled = false;
                });
            }
            
            playWordSound() {
                const question = this.questions[this.currentQuestion];
                if (window.speechSynthesis) {
                    const utterance = new SpeechSynthesisUtterance(question.word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            }
            
            selectAnswer(answer) {
                const question = this.questions[this.currentQuestion];
                const isCorrect = answer === question.type;
                
                // È´ò‰∫ÆÊ≠£Á¢∫Á≠îÊ°à
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.disabled = true;
                    if (btn.dataset.answer === question.type) {
                        btn.style.background = btn.style.background.replace('0.2', '0.8');
                    }
                });
                
                if (isCorrect) {
                    this.score++;
                    window.gameSystem.showMessage('‚úÖ Ê≠£Á¢∫ÔºÅ', 'success', 1500);
                } else {
                    window.gameSystem.showMessage(`‚ùå ÈåØË™§ÔºÅÊ≠£Á¢∫Á≠îÊ°àÊòØ /${question.type}/ Èü≥`, 'error', 2000);
                }
                
                document.getElementById('mcScore').innerHTML = `ÂæóÂàÜ: <span style="color: #4ecca3;">${this.score}</span> / ${this.totalQuestions}`;
                
                this.currentQuestion++;
                setTimeout(() => this.showQuestion(), 2500);
            }
            
            endGame() {
                const percentage = (this.score / this.totalQuestions) * 100;
                
                if (percentage >= 70) {
                    window.gameSystem.showMessage(`üéâ Ê∏¨È©óÂÆåÊàêÔºÅÂæóÂàÜ: ${this.score}/${this.totalQuestions} (${percentage.toFixed(0)}%)`, 'success', 4000);
                    window.gameSystem.completeGame('multipleChoice');
                } else {
                    window.gameSystem.showMessage(`üìö ÈúÄË¶ÅÊõ¥Â§öÁ∑¥ÁøíÔºÅÂæóÂàÜ: ${this.score}/${this.totalQuestions} (${percentage.toFixed(0)}%)`, 'warning', 4000);
                }
                
                console.log('üßô‚Äç‚ôÇÔ∏è ÈÅ∏ÊìáÈ°åÈÅäÊà≤ÁµêÊùüÔºåÂæóÂàÜ:', this.score);
                
                setTimeout(() => {
                    window.gameSystem.showGameMenu();
                }, 4000);
            }
        }
        
        // ÂàùÂßãÂåñÊáâÁî®Á®ãÂºè
        function initializeApp() {
            console.log('üöÄ ÂàùÂßãÂåñÊáâÁî®Á®ãÂºè');
            
            // Èö±ËóèËºâÂÖ•Áï´Èù¢
            const loading = document.getElementById('loadingScreen');
            loading.classList.add('hidden');
            
            // ÂâµÂª∫ÈÅäÊà≤Á≥ªÁµ±
            window.gameSystem = new GameSystem();
            
            // È°ØÁ§∫‰∏ªÈÅ∏ÂñÆ
            window.gameSystem.showMainMenu();
            
            // Ë®≠ÁΩÆË™ûË®Ä
            window.gameSystem.updateLanguage('zh');
            
            console.log('‚úÖ ÊáâÁî®Á®ãÂºèÂàùÂßãÂåñÊàêÂäü');
        }
        
        // DOMËºâÂÖ•ÂÆåÊàêÊôÇÈñãÂßã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìã DOMËºâÂÖ•ÂÆåÊàêÔºåÈñãÂßãÂàùÂßãÂåñ');
            
            // Êõ¥Êñ∞ËºâÂÖ•ÁãÄÊÖã
            document.getElementById('loadingStatus').textContent = 'ËºâÂÖ•‰∏≠... 100%';
            
            // Âª∂ÈÅ≤ÂàùÂßãÂåñ‰ª•È°ØÁ§∫ËºâÂÖ•ÊïàÊûú
            setTimeout(initializeApp, 1500);
        });
    </script>

</body>
</html>
