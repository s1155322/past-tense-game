<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Past Tense Pronunciation Adventure</title>
    
    <!-- ğŸš¨ FAVICON FIX - No more 404 errors! -->
    <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A4ecca+Pi4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/i4uL/4uLi/+Li4v/j4+P/5OTkav///wDi4uL/4ecca/Pi4v/z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/8/Pz//Pz8//z8/P/4ecca//i4uL/////AOLi4v/j4+P/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/j4+P/4uLi/////wDi4uL/4+Pj//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/9PT0//T09P/09PT/4+Pj/+Li4v////8A">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/games.css">
    
    <!-- Enhanced CSS for video controls and fixes -->
    <style>
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10000;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid #4ecca3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10001;
            text-align: center;
            padding: 40px;
        }
        
        .error-details {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-width: 600px;
        }
        
        .debug-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            z-index: 9999;
            max-width: 300px;
            display: none;
        }
        
        /* ğŸ¬ Enhanced Video Player Styling */
        .video-wrapper {
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        /* Enhanced video control buttons */
        .video-control-btn {
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .video-control-btn:hover {
            background: rgba(76, 204, 163, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 204, 163, 0.4);
        }
        
        /* ğŸ¯ Fix for Game 1 stuck background images */
        .game-container.word-search-active .cutscene-container {
            display: none !important;
        }
        
        /* Hide problematic background images that cause stuck screens */
        .background-img {
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        /* If images fail to load, hide them */
        .background-img[src=""] {
            display: none;
        }
    </style>
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <h2>ğŸ® è‹±èªéå»å¼ç™¼éŸ³å†’éšª</h2>
        <p>Loading Adventure...</p>
        <div id="loadingStatus">åˆå§‹åŒ–ç³»çµ±ä¸­...</div>
    </div>
    
    <!-- Error Screen -->
    <div id="errorScreen" class="error-screen">
        <h1>ğŸš¨ è¼‰å…¥éŒ¯èª¤</h1>
        <div class="error-details">
            <h3>éŠæˆ²è¼‰å…¥å¤±æ•—</h3>
            <div id="errorMessage">Unknown error occurred</div>
            <div id="errorDetails" style="margin-top: 15px; font-size: 14px; color: #ffcccc;"></div>
        </div>
        <button onclick="location.reload()" style="
            background: #3498db; color: white; border: none; padding: 15px 30px; 
            border-radius: 8px; font-size: 16px; cursor: pointer; margin: 10px;">
            ğŸ”„ é‡æ–°è¼‰å…¥
        </button>
        <button onclick="toggleDebugInfo()" style="
            background: #f39c12; color: white; border: none; padding: 15px 30px; 
            border-radius: 8px; font-size: 16px; cursor: pointer; margin: 10px;">
            ğŸ”§ é¡¯ç¤ºåµéŒ¯è³‡è¨Š
        </button>
    </div>
    
    <!-- Debug Info Panel -->
    <div id="debugInfo" class="debug-info"></div>
    
    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <div class="settings-content">
            <h2>âš™ï¸</h2>
            <h3 id="settingsTitle">éŠæˆ²è¨­ç½®</h3>
            
            <div class="setting-group">
                <label id="volumeLabel">éŸ³é‡</label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5">
            </div>
            
            <div class="setting-group">
                <label id="bgmLabel">èƒŒæ™¯éŸ³æ¨‚</label>
                <button id="bgmToggle" class="toggle-btn">ON</button>
            </div>
            
            <div class="setting-group">
                <label id="sfxLabel">éŸ³æ•ˆ</label>
                <button id="sfxToggle" class="toggle-btn">ON</button>
            </div>
            
            <div class="setting-group">
                <label id="languageLabel">èªè¨€</label>
                <div class="language-buttons">
                    <button class="lang-button active" data-lang="zh">ä¸­æ–‡</button>
                    <button class="lang-button" data-lang="en">English</button>
                </div>
            </div>
            
            <div class="setting-group">
                <label id="screenSizeLabel">è¢å¹•å¤§å°</label>
                <div class="size-buttons">
                    <button class="size-button" data-size="small">å°</button>
                    <button class="size-button active" data-size="medium">ä¸­</button>
                    <button class="size-button" data-size="large">å¤§</button>
                </div>
            </div>
            
            <button id="closeSettings" class="close-settings">Ã—</button>
        </div>
    </div>

    <!-- ğŸ¬ Story Container - ENHANCED VIDEO PLAYER -->
    <div id="storyContainer" class="story-container" style="display: none;">
        <div class="video-wrapper">
            <!-- ğŸš¨ FIXED: Added full video player controls -->
            <video id="introVideo" 
                   controls 
                   controlslist="nodownload" 
                   preload="metadata" 
                   width="100%" 
                   height="auto"
                   style="background: #000;">
                <source src="assets/video/intro.mp4" type="video/mp4">
                <p>æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ video æ¨™ç±¤ã€‚å°‡é¡¯ç¤ºå‹•ç•«ä»‹ç´¹...</p>
            </video>
            <div class="story-controls">
                <button id="skipIntro" class="video-control-btn">â­ï¸ Skip</button>
                <button id="continueStory" class="video-control-btn">â–¶ï¸ Continue</button>
            </div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div id="gameContainer" class="container" style="display: none;">
        
        <!-- Main Menu -->
        <div id="mainMenu" class="main-menu" style="display: none;">
            <h1 id="gameTitle">ğŸ­ è‹±èªéå»å¼ç™¼éŸ³å†’éšª</h1>
            <div class="menu-options">
                <button id="startGame" class="menu-btn">ğŸš€ é–‹å§‹å†’éšª</button>
                <button id="continueGame" class="menu-btn" style="display: none;">ğŸ“– ç¹¼çºŒå†’éšª</button>
                <button id="collectionsBtn" class="menu-btn">ğŸ† æ”¶è—å“</button>
                <button id="quitGame" class="menu-btn">ğŸšª é›¢é–‹éŠæˆ²</button>
            </div>
            <button id="settingsBtn" class="settings-btn">âš™ï¸</button>
        </div>

        <!-- Collections Menu -->
        <div id="collectionsMenu" class="collections-menu" style="display: none;">
            <h2 id="collectionsTitle">ğŸ† å†’éšªæ”¶è—å“</h2>
            <div class="collections-grid">
                <div class="collection-item" data-artifact="explorer">
                    <div class="artifact-icon">ğŸ‘</div>
                    <h3>æ¢éšªè€…ä¹‹çœ¼</h3>
                    <p>å®Œæˆå–®è©æ¢ç´¢å¾Œç²å¾—</p>
                </div>
                <div class="collection-item" data-artifact="timeController">
                    <div class="artifact-icon">â°</div>
                    <h3>æ™‚é–“æ§åˆ¶è€…</h3>
                    <p>å®Œæˆæ™‚é–“æŒ‘æˆ°å¾Œç²å¾—</p>
                </div>
                <div class="collection-item" data-artifact="knowledgeGem">
                    <div class="artifact-icon">ğŸ’</div>
                    <h3>çŸ¥è­˜å¯¶çŸ³</h3>
                    <p>å®ŒæˆçŸ¥è­˜è©¦ç…‰å¾Œç²å¾—</p>
                </div>
            </div>
            <button class="back-btn" id="collectionsBackBtn">ğŸ  è¿”å›å¤§å»³</button>
        </div>

        <!-- Game Menu -->
        <div id="gameMenu" class="game-menu" style="display: none;">
            <h1 id="gameMenuTitle">ğŸ® é¸æ“‡éŠæˆ²</h1>
            
            <div class="language-selector">
                <button class="lang-btn active" data-lang="zh">ä¸­æ–‡</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
            <div class="menu">
                <button class="menu-button" data-game="wordSearch">
                    <h3>ğŸ” å–®è©æœç´¢</h3>
                    <p>åœ¨ç¶²æ ¼ä¸­æ‰¾åˆ°éå»å¼å–®è©</p>
                </button>
                <button class="menu-button" data-game="fallingWords">
                    <h3>âš”ï¸ è½å­—éŠæˆ²</h3>
                    <p>ç”¨åŠæ–¬é–‹æ­£ç¢ºç™¼éŸ³çš„çŸ³å¡Š</p>
                </button>
                <button class="menu-button" data-game="multipleChoice">
                    <h3>ğŸ§™â€â™‚ï¸ é¸æ“‡é¡Œ</h3>
                    <p>è½ç™¼éŸ³é¸æ“‡æ­£ç¢ºé¡å‹</p>
                </button>
                <button class="menu-button boss-button" data-game="bossFight">
                    <h3>ğŸ‘‘ Bossæˆ°</h3>
                    <p>æ“Šæ•—ç™¼éŸ³ä¹‹ç‹ï¼</p>
                </button>
            </div>
            <div class="game-stats">
                <div class="stat">ç¸½åˆ†æ•¸: <span id="totalScore">0</span></div>
                <div class="stat">ç•¶å‰éšæ®µ: <span id="currentStage">1</span></div>
            </div>
            <button class="back-btn" id="gameMenuBackBtn">ğŸ  è¿”å›å¤§å»³</button>
        </div>

        <!-- ğŸ¯ Game 1: Word Search - FIXED to prevent stuck background images -->
        <div id="wordSearch" class="game-container" style="display: none;">
            <h2>ğŸ” å–®è©æœç´¢éŠæˆ²</h2>
            <div class="instructions">åœ¨ç¶²æ ¼ä¸­æ‰¾åˆ°éå»å¼å–®è©ï¼Œé¸æ“‡æ­£ç¢ºçš„ç™¼éŸ³é¡å‹</div>
            
            <!-- ğŸš¨ FIXED: Cutscene container with error handling for images -->
            <div class="cutscene-container" id="game1Cutscene" style="display: none;">
                <div class="cutscene-content cliff-scene">
                    <img src="assets/images/cliff-background.jpg" 
                         alt="æ‡¸å´–å ´æ™¯" 
                         class="background-img"
                         onerror="this.style.display='none';"
                         onload="console.log('âœ… Game 1 background loaded')">
                    <div class="character-sprite" id="playerSprite">
                        <img src="assets/images/player-sprite.png" 
                             alt="è§’è‰²"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="stone-bridges" id="stoneBridges"></div>
                    <div class="cutscene-text">
                        <p>ä½ ä¾†åˆ°äº†ä¸€å€‹æ‡¸å´–é‚Šï¼Œéœ€è¦ç”¨æ­£ç¢ºçš„ç™¼éŸ³çŸ¥è­˜å»ºé€ çŸ³æ©‹æ‰èƒ½é€šé...</p>
                    </div>
                </div>
            </div>
            
            <div class="sound-selection">
                <div class="sound-buttons">
                    <button class="color-mode-button" data-sound="t">/t/</button>
                    <button class="color-mode-button" data-sound="d">/d/</button>
                    <button class="color-mode-button" data-sound="id">/id/</button>
                </div>
                <div class="selected-sound">é¸æ“‡çš„ç™¼éŸ³é¡å‹: <span id="selectedSound">none</span></div>
            </div>
            
            <div class="game-board" id="wordSearchBoard"></div>
            
            <div class="word-lists">
                <div class="word-list" data-sound="t">
                    <h3>/t/ éŸ³</h3>
                    <div class="word-items" id="tWords"></div>
                </div>
                <div class="word-list" data-sound="d">
                    <h3>/d/ éŸ³</h3>
                    <div class="word-items" id="dWords"></div>
                </div>
                <div class="word-list" data-sound="id">
                    <h3>/id/ éŸ³</h3>
                    <div class="word-items" id="idWords"></div>
                </div>
            </div>
            
            <div class="game-controls">
                <div class="selected-word">é¸ä¸­çš„å–®è©: <span id="selectedWord"></span></div>
                <button id="confirmWord" class="control-btn">âœ… ç¢ºèª</button>
                <button id="clearSelection" class="control-btn">ğŸ”„ æ¸…é™¤</button>
                <button id="pronounceWord" class="control-btn">ğŸ”Š ç™¼éŸ³</button>
            </div>
            
            <button class="back-btn" id="wordSearchBackBtn">ğŸ  è¿”å›é¸å–®</button>
        </div>

        <!-- Game 2: Falling Words -->
        <div id="fallingWords" class="game-container" style="display: none;">
            <h2>âš”ï¸ è½å­—éŠæˆ²</h2>
            <div class="instructions">ä½¿ç”¨æ–¹å‘éµç§»å‹•ï¼Œç©ºç™½éµæ”»æ“Šæ­£ç¢ºç™¼éŸ³çš„å–®è©</div>
            
            <div class="cutscene-container" id="game2Cutscene">
                <div class="cutscene-content stone-rain-scene">
                    <img src="assets/images/cave-background.jpg" 
                         alt="æ´ç©´å ´æ™¯" 
                         class="background-img"
                         onerror="this.style.display='none';">
                    <div class="character-sprite" id="swordPlayer">
                        <img src="assets/images/warrior-sprite.png" 
                             alt="åŠå£«"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="falling-stones" id="fallingStones"></div>
                    <div class="cutscene-text">
                        <p>IPAéŸ³æ¨™çŸ³å¡Šå¾å¤©ç©ºæ‰è½ï¼ç”¨ä¸åŒé¡è‰²çš„åŠæ–¬é–‹å°æ‡‰çš„çŸ³å¡Šï¼</p>
                    </div>
                </div>
            </div>
            
            <div class="sound-selection">
                <div class="sound-buttons">
                    <button class="color-mode-button" data-sound="t">/t/</button>
                    <button class="color-mode-button" data-sound="d">/d/</button>
                    <button class="color-mode-button" data-sound="id">/id/</button>
                </div>
            </div>
            
            <canvas id="fallingWordsCanvas" width="800" height="600"></canvas>
            
            <div class="game-info">
                <div>åˆ†æ•¸: <span id="fallingScore">0</span></div>
                <div>ç”Ÿå‘½: <span id="fallingLives">3</span></div>
            </div>
            <button class="back-btn" id="fallingWordsBackBtn">ğŸ  è¿”å›é¸å–®</button>
        </div>

        <!-- Game 3: Multiple Choice -->
        <div id="multipleChoice" class="game-container" style="display: none;">
            <h2>ğŸ§™â€â™‚ï¸ é¸æ“‡é¡ŒéŠæˆ²</h2>
            <div class="instructions">è½ç™¼éŸ³é¸æ“‡æ­£ç¢ºçš„é¡å‹ï¼Œé€£çºŒç­”å°5é¡Œæ‰“æ•—å·«å¸«ï¼</div>
            
            <div class="cutscene-container" id="game3Cutscene">
                <div class="cutscene-content hypnosis-scene">
                    <img src="assets/images/wizard-lair.jpg" 
                         alt="å·«å¸«å·¢ç©´" 
                         class="background-img"
                         onerror="this.style.display='none';">
                    <div class="character-sprite" id="hypnotizedPlayer">
                        <img src="assets/images/player-hypnotized.png" 
                             alt="è¢«å‚¬çœ çš„è§’è‰²"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="character-sprite" id="evilWizard">
                        <img src="assets/images/wizard-sprite.png" 
                             alt="é‚ªæƒ¡å·«å¸«"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="hypnosis-effects" id="hypnosisEffects"></div>
                    <div class="cutscene-text">
                        <p>ä½ è¢«é‚ªæƒ¡å·«å¸«å‚¬çœ äº†ï¼åªæœ‰é€£çºŒç­”å°5é¡Œæ‰èƒ½æ‰“æ•—å·«å¸«è„«å›°ï¼</p>
                    </div>
                </div>
            </div>
            
            <div class="question-area">
                <div class="word-display" id="questionWord">æº–å‚™é–‹å§‹</div>
                <button id="playPronunciation" class="pronunciation-btn">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
            </div>
            
            <div class="choices">
                <button class="choice-button" data-sound="t">/t/</button>
                <button class="choice-button" data-sound="d">/d/</button>
                <button class="choice-button" data-sound="id">/id/</button>
            </div>
            
            <div class="progress-info">
                <div>é€£çºŒæ­£ç¢º: <span id="correctStreak">0</span>/5</div>
                <div>åˆ†æ•¸: <span id="multipleChoiceScore">0</span></div>
            </div>
            <button class="back-btn" id="multipleChoiceBackBtn">ğŸ  è¿”å›é¸å–®</button>
        </div>

        <!-- Game 4: Boss Fight -->
        <div id="bossFight" class="game-container" style="display: none;">
            <h2>ğŸ‘‘ Bossæˆ°</h2>
            <div class="instructions">æ“Šæ•—ç™¼éŸ³ä¹‹ç‹ï¼ç­”å°å•é¡Œæ”»æ“ŠBoss</div>
            
            <div class="cutscene-container" id="bossCutscene">
                <div class="cutscene-content boss-arena">
                    <img src="assets/images/boss-arena.jpg" 
                         alt="Bossæˆ°å ´" 
                         class="background-img"
                         onerror="this.style.display='none';">
                    <div class="character-sprite" id="bossCharacter">
                        <img src="assets/images/pronunciation-king.png" 
                             alt="ç™¼éŸ³ä¹‹ç‹"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="character-sprite" id="finalPlayer">
                        <img src="assets/images/hero-final.png" 
                             alt="æœ€çµ‚è‹±é›„"
                             onerror="this.style.display='none';">
                    </div>
                    <div class="battle-effects" id="battleEffects"></div>
                    <div class="cutscene-text">
                        <p>æœ€çµ‚æ±ºæˆ°ï¼é¢å°å¼·å¤§çš„ç™¼éŸ³ä¹‹ç‹ï¼Œé‹ç”¨ä½ å­¸åˆ°çš„æ‰€æœ‰çŸ¥è­˜å§ï¼</p>
                    </div>
                </div>
            </div>
            
            <canvas id="bossCanvas" width="800" height="600"></canvas>
            
            <div class="boss-info">
                <div>Bossè¡€é‡: <span id="bossHealth">100</span></div>
                <div>ç©å®¶è¡€é‡: <span id="playerHealth">100</span></div>
                <div>åˆ†æ•¸: <span id="bossScore">0</span></div>
            </div>
            
            <div class="question-area">
                <div class="word-display" id="bossQuestionWord">æº–å‚™æˆ°é¬¥</div>
                <button id="bossPronunciation" class="pronunciation-btn">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
            </div>
            
            <div class="choices">
                <button class="choice-button" data-sound="t">/t/</button>
                <button class="choice-button" data-sound="d">/d/</button>
                <button class="choice-button" data-sound="id">/id/</button>
            </div>
            <button class="back-btn" id="bossFightBackBtn">ğŸ  è¿”å›é¸å–®</button>
        </div>

        <!-- ğŸ¬ Ending Container - ENHANCED VIDEO PLAYER -->
        <div id="endingContainer" class="ending-container" style="display: none;">
            <div class="video-wrapper">
                <!-- ğŸš¨ FIXED: Added full video player controls -->
                <video id="endingVideo" 
                       controls 
                       controlslist="nodownload" 
                       preload="metadata" 
                       width="100%" 
                       height="auto"
                       style="background: #000;">
                    <source src="assets/video/ending.mp4" type="video/mp4">
                    <p>æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ video æ¨™ç±¤ã€‚å°‡é¡¯ç¤ºæ­å–œç•«é¢...</p>
                </video>
                <div class="ending-controls">
                    <button id="playAgain" class="video-control-btn">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                    <button id="backToMenu" class="video-control-btn">ğŸ  è¿”å›ä¸»é¸å–®</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Audio Elements -->
    <audio id="bgmAudio" loop>
        <source src="assets/audio/bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="correctSound">
        <source src="assets/audio/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound">
        <source src="assets/audio/wrong.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound">
        <source src="assets/audio/click.mp3" type="audio/mpeg">
    </audio>

    <!-- ğŸ”§ Enhanced Loading and Error Handling Script -->
    <script>
        console.log('ğŸ® Starting Enhanced Game System Load...');
        
        // Enhanced loading system
        const LoadingManager = {
            scriptsLoaded: 0,
            totalScripts: 8,
            errors: [],
            startTime: Date.now(),
            
            updateStatus(message) {
                const statusElement = document.getElementById('loadingStatus');
                if (statusElement) {
                    statusElement.textContent = message;
                }
                console.log('ğŸ“Š', message);
            },
            
            updateProgress() {
                this.scriptsLoaded++;
                const progress = Math.round((this.scriptsLoaded / this.totalScripts) * 100);
                this.updateStatus(`è¼‰å…¥ä¸­... ${progress}% (${this.scriptsLoaded}/${this.totalScripts})`);
            },
            
            scriptLoaded(scriptName) {
                this.updateProgress();
                console.log('âœ… Script loaded:', scriptName);
            },
            
            scriptError(scriptName, error) {
                this.errors.push({ script: scriptName, error: error });
                this.updateProgress();
                console.error('âŒ Script failed:', scriptName, error);
            },
            
            allScriptsLoaded() {
                const loadTime = Date.now() - this.startTime;
                console.log(`ğŸ‰ All scripts loaded in ${loadTime}ms`);
                
                if (this.errors.length > 0) {
                    this.showError('éƒ¨åˆ†è…³æœ¬è¼‰å…¥å¤±æ•—', this.errors);
                    return;
                }
                
                // Initialize game system
                this.initializeGameSystem();
            },
            
            initializeGameSystem() {
                this.updateStatus('åˆå§‹åŒ–éŠæˆ²ç³»çµ±...');
                
                setTimeout(() => {
                    try {
                        if (window.gameSystem && typeof window.gameSystem.showMainMenu === 'function') {
                            this.hideLoadingScreen();
                            console.log('ğŸ® Game System ready!');
                        } else {
                            throw new Error('GameSystem not properly initialized');
                        }
                    } catch (error) {
                        this.showError('éŠæˆ²ç³»çµ±åˆå§‹åŒ–å¤±æ•—', error);
                    }
                }, 1000);
            },
            
            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        document.getElementById('gameContainer').style.display = 'block';
                    }, 500);
                }
            },
            
            showError(title, details) {
                const errorScreen = document.getElementById('errorScreen');
                const errorMessage = document.getElementById('errorMessage');
                const errorDetails = document.getElementById('errorDetails');
                const loadingScreen = document.getElementById('loadingScreen');
                
                if (errorScreen && errorMessage) {
                    errorMessage.textContent = title;
                    
                    if (errorDetails && details) {
                        if (Array.isArray(details)) {
                            errorDetails.innerHTML = details.map(err => 
                                `<div>âŒ ${err.script}: ${err.error}</div>`
                            ).join('');
                        } else {
                            errorDetails.textContent = details.toString();
                        }
                    }
                    
                    if (loadingScreen) loadingScreen.style.display = 'none';
                    errorScreen.style.display = 'flex';
                }
            }
        };
        
        // Enhanced script loading with error handling
        function loadScript(src, name) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.async = false; // Maintain order
                
                script.onload = () => {
                    LoadingManager.scriptLoaded(name);
                    resolve();
                };
                
                script.onerror = (error) => {
                    LoadingManager.scriptError(name, `Failed to load ${src}`);
                    reject(error);
                };
                
                document.head.appendChild(script);
            });
        }
        
        // Debug info functions
        function toggleDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
            updateDebugInfo();
        }
        
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo.style.display === 'block') {
                debugInfo.innerHTML = `
                    <strong>Debug Information:</strong><br>
                    GameSystem: ${window.gameSystem ? 'âœ… Loaded' : 'âŒ Missing'}<br>
                    Scripts Loaded: ${LoadingManager.scriptsLoaded}/${LoadingManager.totalScripts}<br>
                    Errors: ${LoadingManager.errors.length}<br>
                    Load Time: ${Date.now() - LoadingManager.startTime}ms<br>
                    User Agent: ${navigator.userAgent.substring(0, 50)}...
                `;
            }
        }
        
        // Error handling
        window.addEventListener('error', (e) => {
            LoadingManager.scriptError('Runtime', e.message);
            console.error('Runtime Error:', e);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            LoadingManager.scriptError('Promise', e.reason);
            console.error('Unhandled Promise Rejection:', e);
        });
        
        // Start loading scripts in correct order
        async function loadAllScripts() {
            const scripts = [
                { src: 'js/wordDatabase.js', name: 'WordDatabase' },
                { src: 'js/soundSystem.js', name: 'SoundSystem' },
                { src: 'js/gamesystem.js', name: 'GameSystem' },
                { src: 'js/wordSearch.js', name: 'WordSearch' },
                { src: 'js/fallingword.js', name: 'FallingWords' },
                { src: 'js/multipleChoice.js', name: 'MultipleChoice' },
                { src: 'js/BossFight.js', name: 'BossFight' },
                { src: 'js/main.js', name: 'Main' }
            ];
            
            try {
                for (const script of scripts) {
                    await loadScript(script.src, script.name);
                }
                LoadingManager.allScriptsLoaded();
            } catch (error) {
                LoadingManager.showError('è…³æœ¬è¼‰å…¥å¤±æ•—', error);
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAllScripts);
        } else {
            loadAllScripts();
        }
        
        // ğŸ¬ Enhanced video and button setup
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ Setting up enhanced video players and button handlers');
            
            // Setup video players with enhanced controls
            const introVideo = document.getElementById('introVideo');
            const endingVideo = document.getElementById('endingVideo');
            
            if (introVideo) {
                introVideo.addEventListener('loadedmetadata', () => {
                    console.log('âœ… Intro video loaded with full player controls (pause, volume, seek, fullscreen)');
                });
                
                introVideo.addEventListener('error', (e) => {
                    console.log('âš ï¸ Intro video not found - will use animated story');
                });
                
                introVideo.addEventListener('ended', () => {
                    console.log('ğŸ¬ Intro video ended - auto-proceeding to game menu');
                    setTimeout(() => {
                        document.getElementById('storyContainer').style.display = 'none';
                        if (window.gameSystem) {
                            window.gameSystem.showGameMenu();
                        }
                    }, 1000);
                });
            }
            
            if (endingVideo) {
                endingVideo.addEventListener('loadedmetadata', () => {
                    console.log('âœ… Ending video loaded with full player controls (pause, volume, seek, fullscreen)');
                });
                
                endingVideo.addEventListener('error', (e) => {
                    console.log('âš ï¸ Ending video not found - will use congratulations screen');
                });
            }
            
            // Enhanced button handlers
            const setupFallbackHandlers = () => {
                // Back button handlers with IDs
                const backButtons = [
                    { id: 'collectionsBackBtn', action: () => window.gameSystem?.showMainMenu() },
                    { id: 'gameMenuBackBtn', action: () => window.gameSystem?.showMainMenu() },
                    { id: 'wordSearchBackBtn', action: () => {
                        // ğŸ¯ Fix: Hide cutscene when going back from word search
                        const cutscene = document.getElementById('game1Cutscene');
                        if (cutscene) cutscene.style.display = 'none';
                        window.gameSystem?.showGameMenu();
                    }},
                    { id: 'fallingWordsBackBtn', action: () => window.gameSystem?.showGameMenu() },
                    { id: 'multipleChoiceBackBtn', action: () => window.gameSystem?.showGameMenu() },
                    { id: 'bossFightBackBtn', action: () => window.gameSystem?.showGameMenu() }
                ];
                
                backButtons.forEach(btn => {
                    const element = document.getElementById(btn.id);
                    if (element) {
                        element.onclick = btn.action;
                        console.log(`âœ… Button handler set: ${btn.id}`);
                    }
                });
                
                // Video control handlers
                const skipIntroBtn = document.getElementById('skipIntro');
                const continueStoryBtn = document.getElementById('continueStory');
                const playAgainBtn = document.getElementById('playAgain');
                const backToMenuBtn = document.getElementById('backToMenu');
                
                if (skipIntroBtn) {
                    skipIntroBtn.onclick = () => {
                        console.log('Skip intro clicked');
                        document.getElementById('storyContainer').style.display = 'none';
                        if (window.gameSystem) {
                            window.gameSystem.showGameMenu();
                        }
                    };
                }
                
                if (continueStoryBtn) {
                    continueStoryBtn.onclick = () => {
                        console.log('Continue story clicked');
                        document.getElementById('storyContainer').style.display = 'none';
                        if (window.gameSystem) {
                            window.gameSystem.showGameMenu();
                        }
                    };
                }
                
                if (playAgainBtn) {
                    playAgainBtn.onclick = () => {
                        console.log('Play again clicked');
                        window.location.reload();
                    };
                }
                
                if (backToMenuBtn) {
                    backToMenuBtn.onclick = () => {
                        console.log('Back to menu clicked');
                        document.getElementById('endingContainer').style.display = 'none';
                        if (window.gameSystem) {
                            window.gameSystem.showMainMenu();
                        }
                    };
                }
                
                console.log('âœ… All enhanced button handlers set up successfully');
            };
            
            // Set up handlers immediately
            setupFallbackHandlers();
            
            // Set up again after scripts load
            setTimeout(setupFallbackHandlers, 2000);
        });
    </script>

</body>
</html>
