<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªéå»å¼ç™¼éŸ³å†’éšªéŠæˆ² - å®Œæ•´ç‰ˆ</title>
    
    <style>
        /* é‡ç½®æ¨£å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        /* è¼‰å…¥ç•«é¢ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        #loadingScreen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #4ecca3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* èªè¨€åˆ‡æ›æŒ‰éˆ• */
        #languageToggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        #languageToggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* ç•«é¢ç®¡ç† */
        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* ä¸»é¸å–®èƒŒæ™¯ */
        #mainMenuScreen {
            background-image: url('assets/images/all-artifacts-ready.png');
            background-size: cover;
            background-position: center;
        }
        
        /* ä¸»é¸å–® */
        .main-menu {
            background: rgba(0,0,0,0.7);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .main-menu h1 {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            text-align: center;
        }
        
        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 204, 163, 0.4);
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        /* æ•…äº‹/å½±ç‰‡ç•«é¢ */
        #storyScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            z-index: 999;
        }
        
        .video-wrapper {
            width: 100%;
            max-width: 800px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin: 20px;
        }
        
        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .video-controls {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            text-align: center;
        }
        
        .video-control-btn {
            background: linear-gradient(45deg, #4ecca3, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 204, 163, 0.6);
        }
        
        .video-control-btn.secondary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        /* çµæŸå½±ç‰‡ç•«é¢ */
        #endingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            z-index: 999;
            display: none;
        }
        
        #endingScreen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* éå ´å‹•ç•« */
        .cutscene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .cutscene.active {
            display: flex;
        }
        
        .cutscene-content {
            text-align: center;
            max-width: 800px;
            padding: 40px;
            background: rgba(0,0,0,0.8);
            border-radius: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }
        
        .cutscene-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            color: #4ecca3;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .cutscene-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: white;
        }
        
        .cutscene-character {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: characterFloat 3s ease-in-out infinite;
        }
        
        @keyframes characterFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* éŠæˆ²é¸å–® */
        #gameMenuScreen {
            background-image: url('assets/images/cave-background.jpg');
            background-size: cover;
            background-position: center;
        }
        
        .game-menu {
            background: rgba(0,0,0,0.7);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .game-menu h1 {
            font-size: 2.2em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            text-align: center;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            max-width: 600px;
        }
        
        .game-button {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .game-button:hover:not(.locked) {
            background: rgba(255,255,255,0.2);
            border-color: #4ecca3;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .game-button.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .game-button.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        
        .game-button.completed::after {
            content: 'âœ…';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        
        .game-button h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        
        .game-button p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* éŠæˆ²å®¹å™¨ */
        .game-container {
            width: 100%;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            color: white;
            padding: 20px;
            position: relative;
        }
        
        /* å­—æ¯ç¶²æ ¼ - ä¿®å¾©ç‰ˆæœ¬ */
        #letterGrid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 3px;
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            user-select: none;
            backdrop-filter: blur(10px);
        }
        
        .letter-cell {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            color: #333;
            border: 2px solid transparent;
            user-select: none;
            position: relative;
        }
        
        .letter-cell:hover {
            background: #4ecca3;
            color: white;
            transform: scale(1.1);
            border-color: #2ecc71;
        }
        
        .letter-cell.selected {
            background: #4ecca3 !important;
            color: white;
            border-color: #2ecc71;
            transform: scale(1.05);
        }
        
        /* ä¿®å¾©ï¼šå…è¨±é‡è¤‡é¸æ“‡ï¼Œä¸å†ç”¨foundé¡åˆ¥é–å®š */
        .letter-cell.part-of-word {
            background: rgba(46, 204, 113, 0.3) !important;
            border: 2px solid #27ae60;
        }
        
        .letter-cell.part-of-word.selected {
            background: #4ecca3 !important;
            color: white;
            border-color: #2ecc71;
        }
        
        /* æ‰¾åˆ°å–®è©æ™‚çš„å‹•ç•«æ•ˆæœ */
        .letter-cell.word-found {
            animation: cellFound 0.6s ease-in-out;
        }
        
        @keyframes cellFound {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); background: #2ecc71; }
            100% { transform: scale(1.05); }
        }
        
        /* éŠæˆ²2 - æˆ°å£«æ¨£å¼ */
        .game-area-2 {
            background-image: url('assets/images/cliff-background.jpg');
            background-size: cover;
            background-position: center;
        }
        
        .player-character {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background-image: url('assets/images/player-sprite.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 100;
            transition: left 0.1s ease;
        }
        
        .player-character.hypnotized {
            background-image: url('assets/images/player-hypnotized.png');
            filter: sepia(100%) hue-rotate(280deg);
        }
        
        .sword-indicator {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 101;
        }
        
        .sword-t { background-image: url('assets/images/artifact-time-controller.png'); }
        .sword-d { background-image: url('assets/images/artifact-knowledge-gem.png'); }
        .sword-id { background-image: url('assets/images/artifact-energy-eye.png'); }
        
        .falling-word {
            position: absolute;
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
        }
        
        .falling-word:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
        
        .falling-word.t-type { 
            background: linear-gradient(45deg, #3498db, #2980b9);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .falling-word.d-type { 
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        .falling-word.id-type { 
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }
        
        /* Bossæˆ°æ¨£å¼ */
        .boss-arena {
            background-image: url('assets/images/boss-arena.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        .boss-character {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 250px;
            background-image: url('assets/images/pronunciation-king.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: bossFloat 3s ease-in-out infinite;
        }
        
        @keyframes bossFloat {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-20px); }
        }
        
        .boss-health {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .boss-health-bar {
            height: 100%;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            width: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .artifact {
            position: absolute;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            animation: artifactGlow 2s ease-in-out infinite;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        @keyframes artifactGlow {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
        }
        
        .artifact:hover {
            transform: scale(1.2);
        }
        
        .artifact.t-artifact { background-image: url('assets/images/artifact-time-controller.png'); }
        .artifact.d-artifact { background-image: url('assets/images/artifact-knowledge-gem.png'); }
        .artifact.id-artifact { background-image: url('assets/images/artifact-energy-eye.png'); }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .sound-btn, .control-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            backdrop-filter: blur(10px);
        }
        
        .sound-btn:hover, .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .sound-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px currentColor;
            border: 2px solid rgba(255,255,255,0.7);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* æ‰¾åˆ°çš„å–®è© */
        .word-item {
            background: rgba(255,255,255,0.2);
            padding: 5px 8px;
            margin: 3px 0;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }
        
        .word-item.found {
            background: rgba(46, 204, 113, 0.8);
            color: white;
            animation: wordFound 0.6s ease-in-out;
        }
        
        @keyframes wordFound {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* è¨Šæ¯ç³»çµ± */
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2ecc71;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: messageSlide 0.3s ease-out;
            max-width: 90vw;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .message.error {
            background: #e74c3c;
        }
        
        .message.warning {
            background: #f39c12;
        }
        
        .message.info {
            background: #3498db;
        }
        
        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* HUDæ¨£å¼ */
        .game-hud {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 999;
        }
        
        .sword-selection {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 999;
        }
        
        .sword-btn {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sword-btn:hover {
            border-color: #4ecca3;
            transform: scale(1.1);
        }
        
        .sword-btn.active {
            border-color: #4ecca3;
            box-shadow: 0 0 15px #4ecca3;
        }
        
        .sword-btn.t-sword { background-image: url('assets/images/artifact-time-controller.png'); }
        .sword-btn.d-sword { background-image: url('assets/images/artifact-knowledge-gem.png'); }
        .sword-btn.id-sword { background-image: url('assets/images/artifact-energy-eye.png'); }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
            
            .main-menu h1, .game-menu h1 {
                font-size: 1.8em;
            }
            
            #letterGrid {
                grid-template-columns: repeat(10, 1fr);
                max-width: 350px;
            }
            
            .letter-cell {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .sword-selection {
                bottom: 10px;
                padding: 10px;
            }
            
            .sword-btn {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    
    <!-- èƒŒæ™¯éŸ³æ¨‚ -->
    <audio id="bgmAudio" loop>
        <source src="assets/audio/bgm.mp3" type="audio/mpeg">
    </audio>
    
    <!-- éŸ³æ•ˆ -->
    <audio id="clickSound" preload="auto"><source src="assets/audio/click.mp3" type="audio/mpeg"></audio>
    <audio id="correctSound" preload="auto"><source src="assets/audio/correct.mp3" type="audio/mpeg"></audio>
    <audio id="wrongSound" preload="auto"><source src="assets/audio/wrong.mp3" type="audio/mpeg"></audio>
    
    <!-- è¼‰å…¥ç•«é¢ -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <h2 id="loadingTitle">ğŸ® è‹±èªéå»å¼ç™¼éŸ³å†’éšª</h2>
        <p id="loadingStatus">æ­£åœ¨åˆå§‹åŒ–éŠæˆ²ç³»çµ±...</p>
    </div>
    
    <!-- èªè¨€åˆ‡æ›æŒ‰éˆ• -->
    <button id="languageToggle">ğŸŒ English</button>
    
    <!-- ä¸»é¸å–®ç•«é¢ -->
    <div id="mainMenuScreen" class="screen">
        <div class="main-menu">
            <h1 id="gameTitle">ğŸ­ è‹±èªéå»å¼ç™¼éŸ³å†’éšª</h1>
            <div class="menu-options">
                <button id="startGameBtn" class="menu-btn">ğŸš€ é–‹å§‹å†’éšª</button>
                <button id="instructionsBtn" class="menu-btn">ğŸ“š éŠæˆ²èªªæ˜</button>
                <button id="creditsBtn" class="menu-btn">ğŸ† è£½ä½œåœ˜éšŠ</button>
            </div>
        </div>
    </div>
    
    <!-- æ•…äº‹ä»‹ç´¹ç•«é¢ -->
    <div id="storyScreen" class="screen">
        <div class="video-wrapper">
            <!-- å¯¦éš›çš„ä»‹ç´¹å½±ç‰‡ -->
            <video id="introVideo" controls preload="metadata" muted>
                <source src="assets/video/intro.mp4" type="video/mp4">
                <p style="color: white; padding: 20px; text-align: center;">
                    ğŸ¬ æ­¡è¿ä¾†åˆ°è‹±èªéå»å¼ç™¼éŸ³å†’éšªï¼<br>
                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
                </p>
            </video>
            <div class="video-controls">
                <h3 style="color: white; margin: 0 0 15px 0;" id="introVideoTitle">ğŸ¬ éŠæˆ²ä»‹ç´¹</h3>
                <p style="color: #ccc; margin: 0 0 20px 0;" id="introVideoDesc">è§€çœ‹å®Œæ•´æ•…äº‹ä»‹ç´¹æˆ–ç›´æ¥é–‹å§‹éŠæˆ²</p>
                <button id="skipIntroBtn" class="video-control-btn secondary">â­ï¸ è·³éä»‹ç´¹</button>
                <button id="continueStoryBtn" class="video-control-btn">â–¶ï¸ é–‹å§‹éŠæˆ²</button>
            </div>
        </div>
    </div>
    
    <!-- çµæŸç•«é¢ -->
    <div id="endingScreen" class="screen">
        <div class="video-wrapper">
            <!-- çµæŸå½±ç‰‡ -->
            <video id="endingVideo" controls preload="metadata">
                <source src="assets/video/ending.mp4" type="video/mp4">
                <div style="width: 100%; height: 400px; background-image: url('assets/images/hero-final.png'); background-size: contain; background-repeat: no-repeat; background-position: center; display: flex; align-items: center; justify-content: center; color: white; text-align: center; padding: 40px;">
                    <div>
                        <h2 style="font-size: 2em; margin-bottom: 20px;">ğŸ‰ æ­å–œå®Œæˆå†’éšªï¼</h2>
                        <p style="font-size: 18px;">æ‚¨å·²æˆç‚ºçœŸæ­£çš„ç™¼éŸ³å¤§å¸«ï¼</p>
                    </div>
                </div>
            </video>
            <div class="video-controls">
                <h3 style="color: white; margin: 0 0 15px 0;" id="endingVideoTitle">ğŸ‰ å†’éšªå®Œæˆï¼</h3>
                <p style="color: #ccc; margin: 0 0 20px 0;" id="endingVideoDesc">æ‚¨å·²æˆç‚ºçœŸæ­£çš„ç™¼éŸ³å¤§å¸«ï¼</p>
                <button id="playAgainBtn" class="video-control-btn">ğŸ”„ é‡æ–°é–‹å§‹</button>
                <button id="backToMenuBtn" class="video-control-btn secondary">ğŸ  è¿”å›ä¸»é¸å–®</button>
            </div>
        </div>
    </div>
    
    <!-- éå ´å‹•ç•« -->
    <div id="cutsceneContainer" class="cutscene">
        <div class="cutscene-content">
            <div class="cutscene-character" id="cutsceneCharacter"></div>
            <h2 class="cutscene-title" id="cutsceneTitle">ç« ç¯€æ¨™é¡Œ</h2>
            <p class="cutscene-text" id="cutsceneText">æ•…äº‹å…§å®¹...</p>
            <button id="cutsceneContinue" class="video-control-btn">â–¶ï¸ ç¹¼çºŒ</button>
        </div>
    </div>
    
    <!-- éŠæˆ²é¸å–®ç•«é¢ -->
    <div id="gameMenuScreen" class="screen">
        <div class="game-menu">
            <h1 id="gameMenuTitle">ğŸ® é¸æ“‡ä½ çš„æŒ‘æˆ°</h1>
            
            <div class="game-grid">
                <div class="game-button" id="wordSearchBtn" data-game="wordSearch">
                    <h3 id="ws-title">ğŸ” æ©‹æ¨‘ä¿®å¾©</h3>
                    <p id="ws-desc">ä¿®å¾©å¤è€çš„ç™¼éŸ³æ©‹æ¨‘</p>
                </div>
                <div class="game-button locked" id="fallingWordsBtn" data-game="fallingWords">
                    <h3 id="fw-title">âš”ï¸ å²©çŸ³æ³•å¸«æˆ°</h3>
                    <p id="fw-desc">æ“Šæ•—é‚ªæƒ¡å²©çŸ³æ³•å¸«</p>
                </div>
                <div class="game-button locked" id="multipleChoiceBtn" data-game="multipleChoice">
                    <h3 id="mc-title">ğŸ§™â€â™‚ï¸ å¤¢é­˜æ³•å¸«æˆ°</h3>
                    <p id="mc-desc">å¾å‚¬çœ ä¸­é†’ä¾†æ“Šæ•—æ³•å¸«</p>
                </div>
                <div class="game-button locked" id="bossFightBtn" data-game="bossFight">
                    <h3 id="bf-title">ğŸ‘‘ æœ€çµ‚Bossæˆ°</h3>
                    <p id="bf-desc">é¢å°ç™¼éŸ³ä¹‹ç‹ï¼</p>
                </div>
            </div>
            
            <button class="back-btn" id="gameMenuBackBtn">ğŸ  è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>
    
    <!-- éŠæˆ²å®¹å™¨ -->
    <div id="gameContainer" class="screen">
        <div id="gameContent" class="game-container">
            <!-- éŠæˆ²å…§å®¹å°‡åœ¨é€™è£¡æ’å…¥ -->
        </div>
    </div>
    
    <script>
        console.log('ğŸ® é–‹å§‹éŠæˆ²åˆå§‹åŒ–...');
        
        // éŸ³æ•ˆç®¡ç†å™¨
        class AudioManager {
            constructor() {
                this.bgm = document.getElementById('bgmAudio');
                this.clickSound = document.getElementById('clickSound');
                this.correctSound = document.getElementById('correctSound');
                this.wrongSound = document.getElementById('wrongSound');
                this.isMuted = false;
                this.bgmVolume = 0.3;
                this.sfxVolume = 0.7;
                
                this.bgm.volume = this.bgmVolume;
                this.clickSound.volume = this.sfxVolume;
                this.correctSound.volume = this.sfxVolume;
                this.wrongSound.volume = this.sfxVolume;
            }
            
            playBGM() {
                if (!this.isMuted) {
                    this.bgm.currentTime = 0;
                    this.bgm.play().catch(e => console.log('BGMæ’­æ”¾è¢«é˜»æ“‹'));
                }
            }
            
            stopBGM() {
                this.bgm.pause();
            }
            
            playClick() {
                if (!this.isMuted) {
                    this.clickSound.currentTime = 0;
                    this.clickSound.play().catch(e => {});
                }
            }
            
            playCorrect() {
                if (!this.isMuted) {
                    this.correctSound.currentTime = 0;
                    this.correctSound.play().catch(e => {});
                }
            }
            
            playWrong() {
                if (!this.isMuted) {
                    this.wrongSound.currentTime = 0;
                    this.wrongSound.play().catch(e => {});
                }
            }
            
            toggleMute() {
                this.isMuted = !this.isMuted;
                if (this.isMuted) {
                    this.bgm.volume = 0;
                } else {
                    this.bgm.volume = this.bgmVolume;
                }
            }
        }
        
        // å…¨åŸŸéŠæˆ²ç‹€æ…‹
        window.gameState = {
            currentLanguage: 'zh',
            currentGame: null,
            currentScreen: 'loading',
            gameProgress: {
                wordSearch: { completed: false, unlocked: true },
                fallingWords: { completed: false, unlocked: false },
                multipleChoice: { completed: false, unlocked: false },
                bossFight: { completed: false, unlocked: false }
            },
            artifacts: { t: false, d: false, id: false },
            score: 0,
            initialized: false
        };
        
        // å…¨åŸŸéŸ³æ•ˆç®¡ç†å™¨
        window.audioManager = new AudioManager();
        
        // ç¿»è­¯ç³»çµ±
        window.translations = {
            zh: {
                // ä¸»é¸å–®
                gameTitle: "ğŸ­ è‹±èªéå»å¼ç™¼éŸ³å†’éšª",
                startGame: "ğŸš€ é–‹å§‹å†’éšª",
                instructions: "ğŸ“š éŠæˆ²èªªæ˜",
                credits: "ğŸ† è£½ä½œåœ˜éšŠ",
                languageToggle: "ğŸŒ English",
                
                // ä»‹ç´¹
                introVideoTitle: "ğŸ¬ éŠæˆ²ä»‹ç´¹",
                introVideoDesc: "è§€çœ‹å®Œæ•´æ•…äº‹ä»‹ç´¹æˆ–ç›´æ¥é–‹å§‹éŠæˆ²",
                skipIntro: "â­ï¸ è·³éä»‹ç´¹",
                startAdventure: "â–¶ï¸ é–‹å§‹éŠæˆ²",
                
                // çµæŸ
                endingVideoTitle: "ğŸ‰ å†’éšªå®Œæˆï¼",
                endingVideoDesc: "æ‚¨å·²æˆç‚ºçœŸæ­£çš„ç™¼éŸ³å¤§å¸«ï¼",
                playAgain: "ğŸ”„ é‡æ–°é–‹å§‹",
                backToMainMenu: "ğŸ  è¿”å›ä¸»é¸å–®",
                
                // éŠæˆ²é¸å–®
                gameMenuTitle: "ğŸ® é¸æ“‡ä½ çš„æŒ‘æˆ°",
                wsTitle: "ğŸ” æ©‹æ¨‘ä¿®å¾©",
                wsDesc: "ä¿®å¾©å¤è€çš„ç™¼éŸ³æ©‹æ¨‘",
                fwTitle: "âš”ï¸ å²©çŸ³æ³•å¸«æˆ°",
                fwDesc: "æ“Šæ•—é‚ªæƒ¡å²©çŸ³æ³•å¸«",
                mcTitle: "ğŸ§™â€â™‚ï¸ å¤¢é­˜æ³•å¸«æˆ°",
                mcDesc: "å¾å‚¬çœ ä¸­é†’ä¾†æ“Šæ•—æ³•å¸«",
                bfTitle: "ğŸ‘‘ æœ€çµ‚Bossæˆ°",
                bfDesc: "é¢å°ç™¼éŸ³ä¹‹ç‹ï¼",
                backToMenu: "ğŸ  è¿”å›ä¸»é¸å–®",
                
                // éŠæˆ²å…§å®¹
                bridgeRepair: "ğŸŒ‰ æ©‹æ¨‘ä¿®å¾©æŒ‘æˆ°",
                selectSound: "é¸æ“‡ç™¼éŸ³é¡å‹ï¼š",
                selectedWord: "é¸ä¸­çš„å–®è©ï¼š",
                confirm: "âœ… ç¢ºèª",
                clear: "ğŸ”„ æ¸…é™¤",
                pronounce: "ğŸ”Š ç™¼éŸ³",
                foundWords: "å·²æ‰¾åˆ°çš„å–®è©",
                
                // æˆ°é¬¥
                rockWizardBattle: "âš”ï¸ å²©çŸ³æ³•å¸«æˆ°",
                nightmareWizard: "ğŸ§™â€â™‚ï¸ å¤¢é­˜æ³•å¸«æˆ°",
                finalBoss: "ğŸ‘‘ æœ€çµ‚Bossæˆ°",
                
                // è¨Šæ¯
                correct: "âœ… æ­£ç¢ºï¼",
                wrong: "âŒ éŒ¯èª¤ï¼",
                completed: "ğŸ‰ å®Œæˆï¼",
                unlocked: "å·²è§£é–",
                
                // è¼‰å…¥
                loadingTitle: "ğŸ® è‹±èªéå»å¼ç™¼éŸ³å†’éšª",
                loadingStatus: "æ­£åœ¨åˆå§‹åŒ–éŠæˆ²ç³»çµ±...",
                
                // å…¶ä»–
                none: "ç„¡",
                pleaseSelect: "è«‹é¸æ“‡",
                sound: "éŸ³",
                
                // éŠæˆ²2ç›¸é—œ
                chooseSword: "é¸æ“‡åŠ (J/K/L):",
                currentSword: "ç•¶å‰åŠ:",
                movement: "ç§»å‹• (W/A/S/D):",
                
                // éŠæˆ²3ç›¸é—œ
                consecutiveCorrect: "é€£çºŒç­”å°:",
                totalQuestions: "å•é¡Œ"
            },
            en: {
                // ä¸»é¸å–®
                gameTitle: "ğŸ­ English Past Tense Adventure",
                startGame: "ğŸš€ Start Adventure",
                instructions: "ğŸ“š Instructions",
                credits: "ğŸ† Credits",
                languageToggle: "ğŸŒ ä¸­æ–‡",
                
                // ä»‹ç´¹
                introVideoTitle: "ğŸ¬ Game Introduction",
                introVideoDesc: "Watch the full story introduction or start playing directly",
                skipIntro: "â­ï¸ Skip Intro",
                startAdventure: "â–¶ï¸ Start Game",
                
                // çµæŸ
                endingVideoTitle: "ğŸ‰ Adventure Complete!",
                endingVideoDesc: "You have become a true pronunciation master!",
                playAgain: "ğŸ”„ Play Again",
                backToMainMenu: "ğŸ  Back to Main Menu",
                
                // éŠæˆ²é¸å–®
                gameMenuTitle: "ğŸ® Choose Your Challenge",
                wsTitle: "ğŸ” Bridge Repair",
                wsDesc: "Repair the ancient pronunciation bridge",
                fwTitle: "âš”ï¸ Rock Wizard Battle",
                fwDesc: "Defeat the evil rock wizard",
                mcTitle: "ğŸ§™â€â™‚ï¸ Nightmare Wizard",
                mcDesc: "Wake up from hypnosis and defeat the wizard",
                bfTitle: "ğŸ‘‘ Final Boss Battle",
                bfDesc: "Face the Pronunciation King!",
                backToMenu: "ğŸ  Back to Menu",
                
                // éŠæˆ²å…§å®¹
                bridgeRepair: "ğŸŒ‰ Bridge Repair Challenge",
                selectSound: "Select pronunciation type:",
                selectedWord: "Selected word:",
                confirm: "âœ… Confirm",
                clear: "ğŸ”„ Clear",
                pronounce: "ğŸ”Š Pronounce",
                foundWords: "Found words",
                
                // æˆ°é¬¥
                rockWizardBattle: "âš”ï¸ Rock Wizard Battle",
                nightmareWizard: "ğŸ§™â€â™‚ï¸ Nightmare Wizard Battle",
                finalBoss: "ğŸ‘‘ Final Boss Battle",
                
                // è¨Šæ¯
                correct: "âœ… Correct!",
                wrong: "âŒ Wrong!",
                completed: "ğŸ‰ Completed!",
                unlocked: "Unlocked",
                
                // è¼‰å…¥
                loadingTitle: "ğŸ® English Past Tense Adventure",
                loadingStatus: "Initializing game system...",
                
                // å…¶ä»–
                none: "None",
                pleaseSelect: "Please select",
                sound: "sound",
                
                // éŠæˆ²2ç›¸é—œ
                chooseSword: "Choose Sword (J/K/L):",
                currentSword: "Current Sword:",
                movement: "Movement (W/A/S/D):",
                
                // éŠæˆ²3ç›¸é—œ
                consecutiveCorrect: "Consecutive correct:",
                totalQuestions: "Question"
            }
        };
        
        // ç•«é¢ç®¡ç†å™¨
        class ScreenManager {
            constructor() {
                this.screens = ['mainMenuScreen', 'storyScreen', 'gameMenuScreen', 'gameContainer', 'endingScreen'];
                this.currentScreen = null;
            }
            
            showScreen(screenId) {
                console.log(`ğŸ“º åˆ‡æ›åˆ°ç•«é¢: ${screenId}`);
                
                // éš±è—æ‰€æœ‰ç•«é¢
                this.screens.forEach(id => {
                    const screen = document.getElementById(id);
                    if (screen) {
                        screen.classList.remove('active');
                    }
                });
                
                // éš±è—éå ´å‹•ç•«
                document.getElementById('cutsceneContainer').classList.remove('active');
                
                // é¡¯ç¤ºç›®æ¨™ç•«é¢
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    this.currentScreen = screenId;
                    window.gameState.currentScreen = screenId;
                    console.log(`âœ… ç•«é¢ ${screenId} ç¾åœ¨è™•æ–¼æ´»å‹•ç‹€æ…‹`);
                } else {
                    console.error(`âŒ æ‰¾ä¸åˆ°ç•«é¢ ${screenId}`);
                }
            }
            
            showCutscene(title, text, backgroundImage, characterImage, callback) {
                const cutscene = document.getElementById('cutsceneContainer');
                cutscene.style.backgroundImage = backgroundImage ? `url('${backgroundImage}')` : '';
                
                document.getElementById('cutsceneTitle').textContent = title;
                document.getElementById('cutsceneText').textContent = text;
                
                const characterEl = document.getElementById('cutsceneCharacter');
                if (characterImage) {
                    characterEl.style.backgroundImage = `url('${characterImage}')`;
                    characterEl.style.display = 'block';
                } else {
                    characterEl.style.display = 'none';
                }
                
                cutscene.classList.add('active');
                
                const continueBtn = document.getElementById('cutsceneContinue');
                continueBtn.onclick = () => {
                    window.audioManager.playClick();
                    cutscene.classList.remove('active');
                    if (callback) callback();
                };
            }
        }
        
        // éŠæˆ²ç³»çµ±
        class GameSystem {
            constructor() {
                this.screenManager = new ScreenManager();
                this.currentVideo = null;
                this.init();
            }
            
            init() {
                console.log('ğŸ® éŠæˆ²ç³»çµ±åˆå§‹åŒ–ä¸­');
                this.setupEventListeners();
                this.updateGameProgress();
                this.updateLanguage('zh');
                
                // å•Ÿå‹•BGM
                setTimeout(() => {
                    window.audioManager.playBGM();
                }, 1000);
            }
            
            setupEventListeners() {
                console.log('ğŸ”§ è¨­ç½®éŠæˆ²ç³»çµ±äº‹ä»¶ç›£è½å™¨');
                
                // ç‚ºæ‰€æœ‰æŒ‰éˆ•æ·»åŠ é»æ“ŠéŸ³æ•ˆ
                document.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' || e.target.classList.contains('clickable')) {
                        window.audioManager.playClick();
                    }
                });
                
                // ä¸»é¸å–®æŒ‰éˆ•
                document.getElementById('startGameBtn').onclick = () => this.showStory();
                document.getElementById('instructionsBtn').onclick = () => this.showInstructions();
                document.getElementById('creditsBtn').onclick = () => this.showCredits();
                
                // æ•…äº‹æ§åˆ¶
                document.getElementById('skipIntroBtn').onclick = () => this.skipVideo();
                document.getElementById('continueStoryBtn').onclick = () => this.continueFromVideo();
                
                // çµæŸç•«é¢æ§åˆ¶
                document.getElementById('playAgainBtn').onclick = () => this.resetGame();
                document.getElementById('backToMenuBtn').onclick = () => this.showMainMenu();
                
                // éŠæˆ²é¸å–®
                document.getElementById('gameMenuBackBtn').onclick = () => this.showMainMenu();
                
                // éŠæˆ²æŒ‰éˆ•
                document.getElementById('wordSearchBtn').onclick = () => this.startGame('wordSearch');
                document.getElementById('fallingWordsBtn').onclick = () => this.startGame('fallingWords');
                document.getElementById('multipleChoiceBtn').onclick = () => this.startGame('multipleChoice');
                document.getElementById('bossFightBtn').onclick = () => this.startGame('bossFight');
                
                // èªè¨€åˆ‡æ›
                document.getElementById('languageToggle').onclick = () => this.toggleLanguage();
                
                // å½±ç‰‡äº‹ä»¶
                this.currentVideo = document.getElementById('introVideo');
                if (this.currentVideo) {
                    this.currentVideo.onended = () => {
                        console.log('ğŸ¬ ä»‹ç´¹å½±ç‰‡æ’­æ”¾å®Œç•¢');
                        setTimeout(() => this.continueFromVideo(), 2000);
                    };
                }
                
                const endingVideo = document.getElementById('endingVideo');
                if (endingVideo) {
                    endingVideo.onended = () => {
                        console.log('ğŸ‰ çµæŸå½±ç‰‡æ’­æ”¾å®Œç•¢');
                    };
                }
            }
            
            showMainMenu() {
                console.log('ğŸ“‹ é¡¯ç¤ºä¸»é¸å–®');
                this.stopAllVideos();
                this.screenManager.showScreen('mainMenuScreen');
                window.audioManager.playBGM();
            }
            
            showStory() {
                console.log('ğŸ“– é¡¯ç¤ºæ•…äº‹ä»‹ç´¹');
                this.screenManager.showScreen('storyScreen');
                // è‡ªå‹•æ’­æ”¾ä»‹ç´¹å½±ç‰‡
                setTimeout(() => {
                    if (this.currentVideo) {
                        this.currentVideo.currentTime = 0;
                        this.currentVideo.play().catch(e => {
                            console.log('å½±ç‰‡è‡ªå‹•æ’­æ”¾è¢«é˜»æ“‹ï¼š', e);
                        });
                    }
                }, 500);
            }
            
            showEnding() {
                console.log('ğŸ‰ é¡¯ç¤ºçµæŸç•«é¢');
                this.screenManager.showScreen('endingScreen');
                // è‡ªå‹•æ’­æ”¾çµæŸå½±ç‰‡
                setTimeout(() => {
                    const endingVideo = document.getElementById('endingVideo');
                    if (endingVideo) {
                        endingVideo.currentTime = 0;
                        endingVideo.play().catch(e => {
                            console.log('çµæŸå½±ç‰‡è‡ªå‹•æ’­æ”¾è¢«é˜»æ“‹ï¼š', e);
                        });
                    }
                }, 500);
            }
            
            stopAllVideos() {
                const videos = ['introVideo', 'endingVideo'];
                videos.forEach(videoId => {
                    const video = document.getElementById(videoId);
                    if (video) {
                        video.pause();
                        video.currentTime = 0;
                    }
                });
                console.log('ğŸ›‘ æ‰€æœ‰å½±ç‰‡å·²åœæ­¢');
            }
            
            skipVideo() {
                console.log('â­ï¸ è·³éä»‹ç´¹å½±ç‰‡');
                this.stopAllVideos();
                this.showGameMenu();
            }
            
            continueFromVideo() {
                console.log('â–¶ï¸ å¾å½±ç‰‡ç¹¼çºŒ');
                this.stopAllVideos();
                this.showGameMenu();
            }
            
            resetGame() {
                console.log('ğŸ”„ é‡ç½®éŠæˆ²');
                window.gameState = {
                    currentLanguage: window.gameState.currentLanguage,
                    currentGame: null,
                    currentScreen: 'loading',
                    gameProgress: {
                        wordSearch: { completed: false, unlocked: true },
                        fallingWords: { completed: false, unlocked: false },
                        multipleChoice: { completed: false, unlocked: false },
                        bossFight: { completed: false, unlocked: false }
                    },
                    artifacts: { t: false, d: false, id: false },
                    score: 0,
                    initialized: true
                };
                this.updateGameProgress();
                this.showMainMenu();
            }
            
            showGameMenu() {
                console.log('ğŸ® é¡¯ç¤ºéŠæˆ²é¸å–®');
                this.screenManager.showScreen('gameMenuScreen');
                this.updateGameProgress();
            }
            
            updateGameProgress() {
                console.log('ğŸ“Š æ›´æ–°éŠæˆ²é€²åº¦');
                
                const games = ['wordSearch', 'fallingWords', 'multipleChoice', 'bossFight'];
                games.forEach(gameId => {
                    const button = document.getElementById(gameId + 'Btn');
                    if (button) {
                        const progress = window.gameState.gameProgress[gameId];
                        
                        // ç§»é™¤æ‰€æœ‰ç‹€æ…‹é¡åˆ¥
                        button.classList.remove('locked', 'completed');
                        
                        if (progress.completed) {
                            button.classList.add('completed');
                        } else if (!progress.unlocked) {
                            button.classList.add('locked');
                        }
                    }
                });
            }
            
            startGame(gameId) {
                const progress = window.gameState.gameProgress[gameId];
                
                if (!progress.unlocked) {
                    const message = window.gameState.currentLanguage === 'zh' ? 'è«‹å…ˆå®Œæˆå‰é¢çš„éŠæˆ²æ‰èƒ½è§£é–ï¼' : 'Please complete previous games to unlock!';
                    this.showMessage(message, 'warning');
                    return;
                }
                
                console.log(`ğŸš€ é–‹å§‹éŠæˆ²: ${gameId}`);
                window.gameState.currentGame = gameId;
                
                // é¡¯ç¤ºéå ´å‹•ç•«
                this.showGameCutscene(gameId, () => {
                    // é¡¯ç¤ºéŠæˆ²å®¹å™¨
                    this.screenManager.showScreen('gameContainer');
                    
                    // è¼‰å…¥éŠæˆ²å…§å®¹
                    this.loadGameContent(gameId);
                });
            }
            
            showGameCutscene(gameId, callback) {
                let title, text, backgroundImage, characterImage;
                
                if (window.gameState.currentLanguage === 'zh') {
                    switch(gameId) {
                        case 'wordSearch':
                            title = 'ğŸŒ‰ ç¬¬ä¸€ç« ï¼šæ–·æ©‹ä¿®å¾©';
                            text = 'å¤è€çš„ç™¼éŸ³æ©‹æ¨‘è¢«é‚ªæƒ¡æ³•å¸«ç ´å£äº†ï¼ä½ å¿…é ˆæ‰¾åˆ°æ­£ç¢ºçš„éå»å¼å–®è©ä¸¦æŒ‰ç™¼éŸ³åˆ†é¡ï¼Œæ‰èƒ½ä¿®å¾©æ©‹æ¨‘ç¹¼çºŒå‰é€²ã€‚';
                            backgroundImage = 'assets/images/cliff-background.jpg';
                            characterImage = 'assets/images/player-sprite.png';
                            break;
                        case 'fallingWords':
                            title = 'âš”ï¸ ç¬¬äºŒç« ï¼šå²©çŸ³æ³•å¸«æˆ°';
                            text = 'é‚ªæƒ¡çš„å²©çŸ³æ³•å¸«ç”¨é­”æ³•çŸ³å¡Šæ”»æ“Šä½ ï¼ä½¿ç”¨ä½ çš„åŠåˆ‡é–‹å¸¶æœ‰æ­£ç¢ºç™¼éŸ³çš„çŸ³å¡Šï¼Œæ“Šæ•—æ³•å¸«ç²å¾—ç™¼éŸ³ç¥å™¨ã€‚';
                            backgroundImage = 'assets/images/cliff-background.jpg';
                            characterImage = 'assets/images/warrior-sprite.png';
                            break;
                        case 'multipleChoice':
                            title = 'ğŸ§™â€â™‚ï¸ ç¬¬ä¸‰ç« ï¼šå¤¢é­˜æ³•å¸«æˆ°';
                            text = 'å¤¢é­˜æ³•å¸«ç”¨å‚¬çœ è¡“è¿·æƒ‘äº†ä½ çš„å¿ƒæ™ºï¼ä½ å¿…é ˆé€£çºŒç­”å°5é¡Œæ‰èƒ½é†’ä¾†ä¸¦æ“Šæ•—æ³•å¸«ï¼Œå¥ªå–æœ€å¾Œçš„ç¥å™¨ã€‚';
                            backgroundImage = 'assets/images/cave-background.jpg';
                            characterImage = 'assets/images/player-hypnotized.png';
                            break;
                        case 'bossFight':
                            title = 'ğŸ‘‘ æœ€çµ‚ç« ï¼šç™¼éŸ³ä¹‹ç‹';
                            text = 'ä½ å·²ç¶“æ”¶é›†é½Šæ‰€æœ‰ä¸‰å€‹ç™¼éŸ³ç¥å™¨ï¼ç¾åœ¨é¢å°æœ€çµ‚Boss - ç™¼éŸ³ä¹‹ç‹ã€‚é‹ç”¨ä½ æŒæ¡çš„æ‰€æœ‰ç™¼éŸ³çŸ¥è­˜æ“Šæ•—ä»–ï¼Œæˆç‚ºçœŸæ­£çš„ç™¼éŸ³å¤§å¸«ï¼';
                            backgroundImage = 'assets/images/boss-arena.jpg';
                            characterImage = 'assets/images/pronunciation-king.png';
                            break;
                    }
                } else {
                    switch(gameId) {
                        case 'wordSearch':
                            title = 'ğŸŒ‰ Chapter 1: Bridge Repair';
                            text = 'The ancient pronunciation bridge has been destroyed by evil wizards! You must find the correct past tense words and classify them by pronunciation to repair the bridge and continue forward.';
                            backgroundImage = 'assets/images/cliff-background.jpg';
                            characterImage = 'assets/images/player-sprite.png';
                            break;
                        case 'fallingWords':
                            title = 'âš”ï¸ Chapter 2: Rock Wizard Battle';
                            text = 'The evil rock wizard attacks you with magical stone blocks! Use your sword to slice through blocks with the correct pronunciation, defeat the wizard and obtain the pronunciation artifact.';
                            backgroundImage = 'assets/images/cliff-background.jpg';
                            characterImage = 'assets/images/warrior-sprite.png';
                            break;
                        case 'multipleChoice':
                            title = 'ğŸ§™â€â™‚ï¸ Chapter 3: Nightmare Wizard Battle';
                            text = 'The nightmare wizard has hypnotized your mind! You must answer 5 questions correctly in a row to wake up, defeat the wizard and seize the final artifact.';
                            backgroundImage = 'assets/images/cave-background.jpg';
                            characterImage = 'assets/images/player-hypnotized.png';
                            break;
                        case 'bossFight':
                            title = 'ğŸ‘‘ Final Chapter: Pronunciation King';
                            text = 'You have collected all three pronunciation artifacts! Now face the final boss - the Pronunciation King. Use all your pronunciation knowledge to defeat him and become a true pronunciation master!';
                            backgroundImage = 'assets/images/boss-arena.jpg';
                            characterImage = 'assets/images/pronunciation-king.png';
                            break;
                    }
                }
                
                this.screenManager.showCutscene(title, text, backgroundImage, characterImage, callback);
            }
            
            loadGameContent(gameId) {
                const gameContent = document.getElementById('gameContent');
                
                if (gameId === 'wordSearch') {
                    this.loadWordSearchGame(gameContent);
                } else if (gameId === 'fallingWords') {
                    this.loadFallingWordsGame(gameContent);
                } else if (gameId === 'multipleChoice') {
                    this.loadMultipleChoiceGame(gameContent);
                } else if (gameId === 'bossFight') {
                    this.loadBossFightGame(gameContent);
                }
            }
            
            loadWordSearchGame(container) {
                console.log('ğŸ” è¼‰å…¥å–®è©æœç´¢éŠæˆ²');
                const t = window.translations[window.gameState.currentLanguage];
                
                container.style.backgroundImage = 'url("assets/images/cliff-background.jpg")';
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px);">
                        <h1 style="text-align: center; font-size: 2.5em; margin-bottom: 20px;">${t.bridgeRepair}</h1>
                        
                        <!-- é€²åº¦é¡¯ç¤º -->
                        <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                            <div style="text-align: center; min-width: 100px;">
                                <div style="color: #3498db; font-weight: bold; margin-bottom: 5px;">/t/ ${t.sound}</div>
                                <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                    <div id="progressT" style="width: 0%; height: 100%; background: #3498db; border-radius: 6px; transition: width 0.5s;"></div>
                                </div>
                                <div id="countT" style="font-size: 12px; margin-top: 5px;">0/3</div>
                            </div>
                            <div style="text-align: center; min-width: 100px;">
                                <div style="color: #e74c3c; font-weight: bold; margin-bottom: 5px;">/d/ ${t.sound}</div>
                                <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                    <div id="progressD" style="width: 0%; height: 100%; background: #e74c3c; border-radius: 6px; transition: width 0.5s;"></div>
                                </div>
                                <div id="countD" style="font-size: 12px; margin-top: 5px;">0/3</div>
                            </div>
                            <div style="text-align: center; min-width: 100px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">/Éªd/ ${t.sound}</div>
                                <div style="width: 80px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 0 auto; overflow: hidden;">
                                    <div id="progressID" style="width: 0%; height: 100%; background: #2ecc71; border-radius: 6px; transition: width 0.5s;"></div>
                                </div>
                                <div id="countID" style="font-size: 12px; margin-top: 5px;">0/3</div>
                            </div>
                        </div>
                        
                        <!-- ç™¼éŸ³é¸æ“‡ -->
                        <div style="text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="margin-bottom: 15px; font-size: 16px; font-weight: bold;">${t.selectSound}</div>
                            <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                                <button class="sound-btn" data-sound="t" style="background: #3498db;">ğŸ”µ /t/ ${t.sound}</button>
                                <button class="sound-btn" data-sound="d" style="background: #e74c3c;">ğŸ”´ /d/ ${t.sound}</button>
                                <button class="sound-btn" data-sound="id" style="background: #2ecc71;">ğŸŸ¢ /Éªd/ ${t.sound}</button>
                            </div>
                            <div style="margin-top: 10px; font-size: 14px;">
                                ${window.gameState.currentLanguage === 'zh' ? 'ç•¶å‰é¸æ“‡:' : 'Selected:'} <span id="selectedSound" style="color: #fbbf24; font-weight: bold;">${t.pleaseSelect}</span>
                            </div>
                        </div>
                        
                        <!-- å­—æ¯ç¶²æ ¼ -->
                        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                            <div id="letterGrid"></div>
                        </div>
                        
                        <!-- æ§åˆ¶å€åŸŸ -->
                        <div style="text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="margin-bottom: 15px; font-size: 16px;">
                                ${t.selectedWord} <span id="selectedWord" style="color: #fbbf24; font-weight: bold; font-size: 18px;">${t.none}</span>
                            </div>
                            <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                                <button id="confirmBtn" class="control-btn" style="background: #4ecca3;" disabled>${t.confirm}</button>
                                <button id="clearBtn" class="control-btn" style="background: #f39c12;">${t.clear}</button>
                                <button id="pronounceBtn" class="control-btn" style="background: #9b59b6;" disabled>${t.pronounce}</button>
                                <button onclick="window.gameSystem.showGameMenu()" class="control-btn" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);">${t.backToMenu}</button>
                            </div>
                        </div>
                        
                        <!-- å·²æ‰¾åˆ°çš„å–®è© -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 600px; margin: 0 auto;">
                            <div style="background: rgba(52, 152, 219, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #3498db; backdrop-filter: blur(10px);">
                                <h4 style="color: #3498db; margin: 0 0 10px 0; text-align: center;">ğŸ”µ /t/ ${t.foundWords}</h4>
                                <div id="foundWordsT" style="min-height: 60px;"></div>
                            </div>
                            <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #e74c3c; backdrop-filter: blur(10px);">
                                <h4 style="color: #e74c3c; margin: 0 0 10px 0; text-align: center;">ğŸ”´ /d/ ${t.foundWords}</h4>
                                <div id="foundWordsD" style="min-height: 60px;"></div>
                            </div>
                            <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 10px; border: 2px solid #2ecc71; backdrop-filter: blur(10px);">
                                <h4 style="color: #2ecc71; margin: 0 0 10px 0; text-align: center;">ğŸŸ¢ /Éªd/ ${t.foundWords}</h4>
                                <div id="foundWordsID" style="min-height: 60px;"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.setupWordSearchGame();
            }
            
            loadFallingWordsGame(container) {
                console.log('âš”ï¸ è¼‰å…¥å²©çŸ³æ³•å¸«æˆ°');
                const t = window.translations[window.gameState.currentLanguage];
                
                container.className = 'game-container game-area-2';
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; position: relative; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px);">
                        <h1 style="text-align: center; font-size: 2.5em; margin-bottom: 20px;">${t.rockWizardBattle}</h1>
                        
                        <!-- éŠæˆ²HUD -->
                        <div class="game-hud">
                            <div style="display: flex; gap: 20px; align-items: center;">
                                <div style="text-align: center;">
                                    <div style="color: #4ecca3; font-size: 16px; font-weight: bold;">${window.gameState.currentLanguage === 'zh' ? 'å¾—åˆ†' : 'Score'}</div>
                                    <div id="fallingScore" style="font-size: 24px;">0</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #f39c12; font-size: 16px; font-weight: bold;">${window.gameState.currentLanguage === 'zh' ? 'æ™‚é–“' : 'Time'}</div>
                                    <div id="fallingTime" style="font-size: 24px;">90</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #e74c3c; font-size: 16px; font-weight: bold;">${window.gameState.currentLanguage === 'zh' ? 'ç”Ÿå‘½' : 'Lives'}</div>
                                    <div id="fallingLives" style="font-size: 24px;">â¤ï¸â¤ï¸â¤ï¸</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åŠé¸æ“‡HUD -->
                        <div class="sword-selection">
                            <div style="text-align: center; margin-bottom: 10px; font-size: 14px; font-weight: bold;">
                                ${t.chooseSword}
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <div class="sword-btn t-sword active" data-sword="t" data-key="j"></div>
                                <div class="sword-btn d-sword" data-sword="d" data-key="k"></div>
                                <div class="sword-btn id-sword" data-sword="id" data-key="l"></div>
                            </div>
                            <div style="text-align: center; margin-top: 5px; font-size: 12px; opacity: 0.8;">
                                J - /t/    K - /d/    L - /Éªd/
                            </div>
                        </div>
                        
                        <!-- éŠæˆ²å€åŸŸ -->
                        <div id="gameArea" style="position: relative; height: 500px; background: rgba(0,0,0,0.3); border-radius: 15px; margin: 50px auto; max-width: 600px; overflow: hidden; backdrop-filter: blur(10px);">
                            <!-- ç©å®¶è§’è‰² -->
                            <div class="player-character" id="player">
                                <div class="sword-indicator sword-t" id="swordIndicator"></div>
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶èªªæ˜ -->
                        <div style="text-align: center; margin: 20px 0; font-size: 14px; color: rgba(255,255,255,0.8); background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            ${window.gameState.currentLanguage === 'zh' ? 'WASDç§»å‹•ç©å®¶ï¼ŒJKLåˆ‡æ›åŠé¡å‹ï¼Œé»æ“Šå–®è©æ”»æ“Š' : 'WASD to move player, JKL to switch sword types, click words to attack'}
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰éˆ• -->
                        <div style="text-align: center; margin-top: 20px;">
                            <button id="startFallingBtn" style="background: #4ecca3; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 5px;">â–¶ï¸ ${window.gameState.currentLanguage === 'zh' ? 'é–‹å§‹æˆ°é¬¥' : 'Start Battle'}</button>
                            <button id="pauseFallingBtn" style="background: #f39c12; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 5px;" disabled>â¸ï¸ ${window.gameState.currentLanguage === 'zh' ? 'æš«åœ' : 'Pause'}</button>
                            <button onclick="window.gameSystem.showGameMenu()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 5px;">${t.backToMenu}</button>
                        </div>
                    </div>
                `;
                
                this.setupFallingWordsGame();
            }
            
            loadMultipleChoiceGame(container) {
                console.log('ğŸ§™â€â™‚ï¸ è¼‰å…¥å¤¢é­˜æ³•å¸«æˆ°');
                const t = window.translations[window.gameState.currentLanguage];
                
                container.style.backgroundImage = 'url("assets/images/cave-background.jpg")';
                
                container.innerHTML = `
                    <div style="min-height: 100vh; color: white; padding: 20px; text-align: center; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px;">${t.nightmareWizard}</h1>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; max-width: 600px; margin: 0 auto; backdrop-filter: blur(10px);">
                            <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 20px;">
                                <div style="text-align: center;">
                                    <div style="color: #4ecca3; font-size: 18px; font-weight: bold;">${t.consecutiveCorrect}</div>
                                    <div id="mcStreak" style="font-size: 32px; color: #4ecca3;">0</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #f39c12; font-size: 18px; font-weight: bold;">${t.totalQuestions}</div>
                                    <div id="mcCurrent" style="font-size: 32px; color: #f39c12;">1</div>
                                </div>
                            </div>
                            
                            <div id="mcWord" style="font-size: 48px; margin: 30px 0; color: #4ecca3; font-weight: bold;">PLAYED</div>
                            
                            <button id="mcPlayBtn" style="
                                background: #9b59b6; color: white; border: none; padding: 15px 30px; 
                                border-radius: 10px; font-size: 18px; margin-bottom: 30px; cursor: pointer;">
                                ğŸ”Š ${window.gameState.currentLanguage === 'zh' ? 'æ’­æ”¾ç™¼éŸ³' : 'Play Pronunciation'}
                            </button>
                            
                            <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                                <button class="mc-option" data-answer="t" style="
                                    background: rgba(52, 152, 219, 0.2); border: 2px solid #3498db; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    ğŸ”µ /t/ ${t.sound} ${window.gameState.currentLanguage === 'zh' ? '(å¦‚: watched, kicked)' : '(e.g., watched, kicked)'}
                                </button>
                                <button class="mc-option" data-answer="d" style="
                                    background: rgba(231, 76, 60, 0.2); border: 2px solid #e74c3c; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    ğŸ”´ /d/ ${t.sound} ${window.gameState.currentLanguage === 'zh' ? '(å¦‚: played, lived)' : '(e.g., played, lived)'}
                                </button>
                                <button class="mc-option" data-answer="id" style="
                                    background: rgba(46, 204, 113, 0.2); border: 2px solid #2ecc71; color: white; 
                                    padding: 20px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: all 0.3s;">
                                    ğŸŸ¢ /Éªd/ ${t.sound} ${window.gameState.currentLanguage === 'zh' ? '(å¦‚: wanted, needed)' : '(e.g., wanted, needed)'}
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button onclick="window.gameSystem.showGameMenu()" style="
                                background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); 
                                padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                                ${t.backToMenu}
                            </button>
                        </div>
                    </div>
                `;
                
                this.setupMultipleChoiceGame();
            }
            
            loadBossFightGame(container) {
                console.log('ğŸ‘‘ è¼‰å…¥æœ€çµ‚Bossæˆ°');
                const t = window.translations[window.gameState.currentLanguage];
                
                container.className = 'game-container boss-arena';
                
                container.innerHTML = `
                    <div style="padding: 20px; text-align: center; background: rgba(0,0,0,0.3); min-height: 100vh;">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px; color: #fbbf24;">${t.finalBoss}</h1>
                        
                        <!-- Bossè§’è‰² -->
                        <div class="boss-character" id="bossCharacter"></div>
                        
                        <!-- Bossè¡€é‡ -->
                        <div class="boss-health">
                            <div class="boss-health-bar" id="bossHealthBar"></div>
                        </div>
                        
                        <!-- ç¥å™¨é¡¯ç¤º -->
                        <div style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px;">
                            <div class="artifact t-artifact" id="tArtifact" style="display: ${window.gameState.artifacts.t ? 'flex' : 'none'};"></div>
                            <div class="artifact d-artifact" id="dArtifact" style="display: ${window.gameState.artifacts.d ? 'flex' : 'none'};"></div>
                            <div class="artifact id-artifact" id="idArtifact" style="display: ${window.gameState.artifacts.id ? 'flex' : 'none'};"></div>
                        </div>
                        
                        <!-- æˆ°é¬¥ç‹€æ…‹ -->
                        <div style="position: absolute; bottom: 200px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px; min-width: 400px; backdrop-filter: blur(10px);">
                            <div id="bossPhase" style="font-size: 24px; font-weight: bold; margin-bottom: 15px; color: #fbbf24;">${window.gameState.currentLanguage === 'zh' ? 'ç¬¬ä¸€éšæ®µ' : 'Phase 1'}</div>
                            <div id="bossChallenge" style="font-size: 18px; margin-bottom: 20px;">
                                ${window.gameState.currentLanguage === 'zh' ? 'åœ¨30ç§’å…§æ‰¾åˆ°5å€‹/t/éŸ³å–®è©ï¼' : 'Find 5 /t/ sound words in 30 seconds!'}
                            </div>
                            <div style="display: flex; justify-content: space-around; margin-bottom: 15px;">
                                <div style="text-align: center;">
                                    <div style="color: #4ecca3; font-size: 18px; font-weight: bold;">${window.gameState.currentLanguage === 'zh' ? 'é€²åº¦' : 'Progress'}</div>
                                    <div id="bossProgress" style="font-size: 24px;">0/5</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #f39c12; font-size: 18px; font-weight: bold;">${window.gameState.currentLanguage === 'zh' ? 'æ™‚é–“' : 'Time'}</div>
                                    <div id="bossTimer" style="font-size: 24px;">30</div>
                                </div>
                            </div>
                            <button id="startBossBtn" style="background: linear-gradient(45deg, #4ecca3, #2ecc71); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                                âš”ï¸ ${window.gameState.currentLanguage === 'zh' ? 'é–‹å§‹æœ€çµ‚æˆ°' : 'Start Final Battle'}
                            </button>
                        </div>
                        
                        <!-- Bossæˆ°é¬¥å€åŸŸ -->
                        <div id="bossGameArea" style="position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 500px; height: 100px; display: none;">
                            <!-- å‹•æ…‹ç”Ÿæˆçš„æˆ°é¬¥å…ƒç´  -->
                        </div>
                        
                        <div style="position: absolute; bottom: 20px; right: 20px;">
                            <button onclick="window.gameSystem.showGameMenu()" style="
                                background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); 
                                padding: 12px 24px; border-radius: 8px; cursor: pointer;">
                                ${t.backToMenu}
                            </button>
                        </div>
                    </div>
                `;
                
                this.setupBossFightGame();
            }
            
            setupWordSearchGame() {
                const wordSearchGame = new WordSearchGameLogic();
                wordSearchGame.startGame();
            }
            
            setupFallingWordsGame() {
                const fallingGame = new FallingWordsGameLogic();
                fallingGame.init();
            }
            
            setupMultipleChoiceGame() {
                const mcGame = new MultipleChoiceGameLogic();
                mcGame.init();
            }
            
            setupBossFightGame() {
                const bossGame = new BossFightGameLogic();
                bossGame.init();
            }
            
            completeGame(gameId) {
                console.log(`âœ… éŠæˆ²å®Œæˆ: ${gameId}`);
                window.gameState.gameProgress[gameId].completed = true;
                window.audioManager.playCorrect();
                
                // çµ¦äºˆç¥å™¨
                if (gameId === 'wordSearch') {
                    window.gameState.artifacts.t = true;
                } else if (gameId === 'fallingWords') {
                    window.gameState.artifacts.d = true;
                } else if (gameId === 'multipleChoice') {
                    window.gameState.artifacts.id = true;
                }
                
                // è§£é–ä¸‹ä¸€å€‹éŠæˆ²
                const gameOrder = ['wordSearch', 'fallingWords', 'multipleChoice', 'bossFight'];
                const currentIndex = gameOrder.indexOf(gameId);
                if (currentIndex >= 0 && currentIndex < gameOrder.length - 1) {
                    const nextGame = gameOrder[currentIndex + 1];
                    window.gameState.gameProgress[nextGame].unlocked = true;
                    console.log(`ğŸ”“ å·²è§£é–: ${nextGame}`);
                    
                    this.showMessage(`ğŸ‰ ${window.gameState.currentLanguage === 'zh' ? 'å®Œæˆï¼å·²è§£é–' : 'Completed! Unlocked'}: ${nextGame}!`, 'success', 4000);
                } else if (gameId === 'bossFight') {
                    // Bossæˆ°å®Œæˆï¼Œé¡¯ç¤ºçµæŸå½±ç‰‡
                    setTimeout(() => {
                        this.showEnding();
                    }, 3000);
                    return;
                }
                
                setTimeout(() => {
                    this.showGameMenu();
                }, 3000);
            }
            
            showInstructions() {
                const message = window.gameState.currentLanguage === 'zh' ? 
                    'æ‰¾åˆ°éå»å¼å–®è©ä¸¦æ ¹æ“šç™¼éŸ³åˆ†é¡ï¼š/t/ã€/d/ æˆ– /Éªd/ï¼' :
                    'Find past tense words and classify by pronunciation: /t/, /d/, or /Éªd/!';
                this.showMessage(message, 'info', 5000);
            }
            
            showCredits() {
                const message = window.gameState.currentLanguage === 'zh' ? 
                    'ç”¨ â¤ï¸ ç‚ºè‹±èªå­¸ç¿’å†’éšªè€Œè£½ä½œï¼' :
                    'Made with â¤ï¸ for English learning adventure!';
                this.showMessage(message, 'info', 3000);
            }
            
            toggleLanguage() {
                const newLang = window.gameState.currentLanguage === 'zh' ? 'en' : 'zh';
                this.updateLanguage(newLang);
            }
            
            updateLanguage(lang) {
                window.gameState.currentLanguage = lang;
                const t = window.translations[lang];
                
                console.log(`ğŸŒ èªè¨€åˆ‡æ›åˆ°: ${lang}`);
                
                // æ›´æ–°æ‰€æœ‰UIå…ƒç´ 
                document.getElementById('loadingTitle').textContent = t.loadingTitle;
                document.getElementById('gameTitle').textContent = t.gameTitle;
                document.getElementById('startGameBtn').textContent = t.startGame;
                document.getElementById('instructionsBtn').textContent = t.instructions;
                document.getElementById('creditsBtn').textContent = t.credits;
                document.getElementById('languageToggle').textContent = t.languageToggle;
                
                document.getElementById('introVideoTitle').textContent = t.introVideoTitle;
                document.getElementById('introVideoDesc').textContent = t.introVideoDesc;
                document.getElementById('skipIntroBtn').textContent = t.skipIntro;
                document.getElementById('continueStoryBtn').textContent = t.startAdventure;
                
                document.getElementById('endingVideoTitle').textContent = t.endingVideoTitle;
                document.getElementById('endingVideoDesc').textContent = t.endingVideoDesc;
                document.getElementById('playAgainBtn').textContent = t.playAgain;
                document.getElementById('backToMenuBtn').textContent = t.backToMainMenu;
                
                document.getElementById('gameMenuTitle').textContent = t.gameMenuTitle;
                document.getElementById('ws-title').textContent = t.wsTitle;
                document.getElementById('ws-desc').textContent = t.wsDesc;
                document.getElementById('fw-title').textContent = t.fwTitle;
                document.getElementById('fw-desc').textContent = t.fwDesc;
                document.getElementById('mc-title').textContent = t.mcTitle;
                document.getElementById('mc-desc').textContent = t.mcDesc;
                document.getElementById('bf-title').textContent = t.bfTitle;
                document.getElementById('bf-desc').textContent = t.bfDesc;
                document.getElementById('gameMenuBackBtn').textContent = t.backToMenu;
            }
            
            showMessage(text, type = 'success', duration = 3000) {
                const existing = document.querySelector('.message');
                if (existing) existing.remove();
                
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                document.body.appendChild(message);
                
                // æ’­æ”¾å°æ‡‰éŸ³æ•ˆ
                if (type === 'success') {
                    window.audioManager.playCorrect();
                } else if (type === 'error') {
                    window.audioManager.playWrong();
                } else {
                    window.audioManager.playClick();
                }
                
                setTimeout(() => {
                    if (message.parentNode) {
                        message.style.opacity = '0';
                        setTimeout(() => {
                            if (message.parentNode) message.parentNode.removeChild(message);
                        }, 300);
                    }
                }, duration);
            }
        }
        
        // å–®è©æœç´¢éŠæˆ²é‚è¼¯ï¼ˆä¿®å¾©ï¼šå…è¨±é‡è¤‡é¸æ“‡å­—æ¯ï¼‰
        class WordSearchGameLogic {
            constructor() {
                this.selectedSound = null;
                this.selectedCells = [];
                this.foundWords = { t: [], d: [], id: [] };
                this.progress = { t: 0, d: 0, id: 0 };
                this.boardSize = 12;
                this.gameBoard = [];
                this.isSelecting = false;
                this.startCell = null;
                
                this.wordDatabase = {
                    t: ['WATCHED', 'KICKED', 'HELPED', 'WORKED', 'WASHED', 'PASSED', 'CROSSED', 'DANCED'],
                    d: ['PLAYED', 'LIVED', 'MOVED', 'LOVED', 'OPENED', 'CLOSED', 'TURNED', 'LEARNED'],
                    id: ['WANTED', 'NEEDED', 'DECIDED', 'STARTED', 'ENDED', 'VISITED', 'CREATED', 'PAINTED']
                };
                
                this.targetWords = [];
                this.foundWordPositions = []; // è¨˜éŒ„å·²æ‰¾åˆ°å–®è©çš„ä½ç½®
            }
            
            startGame() {
                console.log('ğŸ® é–‹å§‹å–®è©æœç´¢éŠæˆ²é‚è¼¯');
                this.generateBoard();
                this.renderBoard();
                this.setupControls();
            }
            
            generateBoard() {
                this.gameBoard = Array(this.boardSize).fill().map(() => Array(this.boardSize).fill(''));
                
                Object.keys(this.wordDatabase).forEach(type => {
                    this.wordDatabase[type].slice(0, 4).forEach(word => {
                        this.targetWords.push({ word, type });
                    });
                });
                
                let placedCount = 0;
                this.targetWords.forEach(wordObj => {
                    if (this.placeWord(wordObj.word)) {
                        placedCount++;
                    }
                });
                
                for (let row = 0; row < this.boardSize; row++) {
                    for (let col = 0; col < this.boardSize; col++) {
                        if (this.gameBoard[row][col] === '') {
                            this.gameBoard[row][col] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                        }
                    }
                }
                
                console.log(`âœ… æ£‹ç›¤ç”Ÿæˆå®Œæˆï¼ŒæˆåŠŸæ”¾ç½® ${placedCount} å€‹å–®è©`);
            }
            
            placeWord(word) {
                // åƒ…ä½¿ç”¨4å€‹æ–¹å‘ï¼šå·¦å³ä¸Šä¸‹
                const directions = [
                    [0, 1],   // æ°´å¹³å‘å³
                    [0, -1],  // æ°´å¹³å‘å·¦
                    [1, 0],   // å‚ç›´å‘ä¸‹
                    [-1, 0]   // å‚ç›´å‘ä¸Š
                ];
                
                for (let attempt = 0; attempt < 100; attempt++) {
                    const dir = directions[Math.floor(Math.random() * directions.length)];
                    const row = Math.floor(Math.random() * this.boardSize);
                    const col = Math.floor(Math.random() * this.boardSize);
                    
                    if (this.canPlaceWord(word, row, col, dir)) {
                        for (let i = 0; i < word.length; i++) {
                            const r = row + dir[0] * i;
                            const c = col + dir[1] * i;
                            this.gameBoard[r][c] = word[i];
                        }
                        return true;
                    }
                }
                return false;
            }
            
            canPlaceWord(word, row, col, dir) {
                for (let i = 0; i < word.length; i++) {
                    const r = row + dir[0] * i;
                    const c = col + dir[1] * i;
                    
                    if (r < 0 || r >= this.boardSize || c < 0 || c >= this.boardSize) return false;
                    if (this.gameBoard[r][c] !== '' && this.gameBoard[r][c] !== word[i]) return false;
                }
                return true;
            }
            
            renderBoard() {
                const grid = document.getElementById('letterGrid');
                grid.innerHTML = '';
                
                for (let row = 0; row < this.boardSize; row++) {
                    for (let col = 0; col < this.boardSize; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'letter-cell';
                        cell.textContent = this.gameBoard[row][col];
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        
                        // æ”¹é€²çš„æ‹–æ‹½é¸æ“‡
                        cell.addEventListener('mousedown', (e) => this.startSelection(row, col, e));
                        cell.addEventListener('mouseenter', (e) => this.continueSelection(row, col, e));
                        cell.addEventListener('mouseup', (e) => this.endSelection(row, col, e));
                        
                        grid.appendChild(cell);
                    }
                }
                
                // æ·»åŠ å…¨åŸŸäº‹ä»¶ç›£è½
                document.addEventListener('mouseup', () => this.endSelection());
                
                console.log(`âœ… æ£‹ç›¤æ¸²æŸ“å®Œæˆ`);
            }
            
            startSelection(row, col, e) {
                e.preventDefault();
                this.isSelecting = true;
                this.startCell = { row, col };
                this.clearSelection();
                this.selectCell(row, col);
                window.audioManager.playClick();
            }
            
            continueSelection(row, col, e) {
                if (!this.isSelecting) return;
                
                // é¸æ“‡å¾èµ·å§‹é»åˆ°ç•¶å‰é»çš„ç›´ç·šï¼ˆåƒ…æ°´å¹³æˆ–å‚ç›´ï¼‰
                this.clearSelection();
                this.selectLine(this.startCell, { row, col });
            }
            
            endSelection(row, col, e) {
                this.isSelecting = false;
            }
            
            selectLine(start, end) {
                const dx = end.col - start.col;
                const dy = end.row - start.row;
                
                // åƒ…å…è¨±æ°´å¹³æˆ–å‚ç›´é¸æ“‡
                if (Math.abs(dx) > 0 && Math.abs(dy) > 0) {
                    // å¦‚æœæ˜¯æ–œç·šï¼Œé¸æ“‡ä¸»è¦æ–¹å‘
                    if (Math.abs(dx) > Math.abs(dy)) {
                        end.row = start.row; // æ°´å¹³
                    } else {
                        end.col = start.col; // å‚ç›´
                    }
                }
                
                const distance = Math.max(Math.abs(end.col - start.col), Math.abs(end.row - start.row));
                
                if (distance === 0) {
                    this.selectCell(start.row, start.col);
                    return;
                }
                
                const stepX = end.col === start.col ? 0 : (end.col - start.col) / distance;
                const stepY = end.row === start.row ? 0 : (end.row - start.row) / distance;
                
                for (let i = 0; i <= distance; i++) {
                    const row = start.row + Math.round(stepY * i);
                    const col = start.col + Math.round(stepX * i);
                    
                    if (row >= 0 && row < this.boardSize && col >= 0 && col < this.boardSize) {
                        this.selectCell(row, col);
                    }
                }
            }
            
            selectCell(row, col) {
                // ä¿®å¾©ï¼šå…è¨±é¸æ“‡ä»»ä½•å­—æ¯ï¼Œç„¡è«–æ˜¯å¦å·²ç¶“æ˜¯æŸå€‹å–®è©çš„ä¸€éƒ¨åˆ†
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('selected');
                    this.selectedCells.push({ row, col });
                }
                this.updateSelectedWord();
            }
            
            setupControls() {
                document.querySelectorAll('.sound-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedSound = btn.dataset.sound;
                        
                        const t = window.translations[window.gameState.currentLanguage];
                        const soundNames = { 
                            t: `/t/ ${t.sound}`, 
                            d: `/d/ ${t.sound}`, 
                            id: `/Éªd/ ${t.sound}` 
                        };
                        document.getElementById('selectedSound').textContent = soundNames[this.selectedSound];
                        window.audioManager.playClick();
                    };
                });
                
                document.getElementById('confirmBtn').onclick = () => this.confirmWord();
                document.getElementById('clearBtn').onclick = () => this.clearSelection();
                document.getElementById('pronounceBtn').onclick = () => this.pronounceWord();
            }
            
            updateSelectedWord() {
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('');
                const t = window.translations[window.gameState.currentLanguage];
                document.getElementById('selectedWord').textContent = word || t.none;
                
                const confirmBtn = document.getElementById('confirmBtn');
                const pronounceBtn = document.getElementById('pronounceBtn');
                
                if (word.length >= 3) {
                    confirmBtn.disabled = false;
                    pronounceBtn.disabled = false;
                } else {
                    confirmBtn.disabled = true;
                    pronounceBtn.disabled = true;
                }
            }
            
            confirmWord() {
                if (!this.selectedSound) {
                    const message = window.gameState.currentLanguage === 'zh' ? 'è«‹å…ˆé¸æ“‡ç™¼éŸ³é¡å‹ï¼' : 'Please select a pronunciation type first!';
                    window.gameSystem.showMessage(message, 'warning');
                    return;
                }
                
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('');
                const wordObj = this.targetWords.find(w => w.word === word);
                const t = window.translations[window.gameState.currentLanguage];
                
                if (wordObj && wordObj.type === this.selectedSound && !this.foundWords[wordObj.type].includes(word)) {
                    this.foundWords[wordObj.type].push(word);
                    this.progress[wordObj.type]++;
                    
                    // è¨˜éŒ„æ‰¾åˆ°çš„å–®è©ä½ç½®
                    this.foundWordPositions.push({
                        word: word,
                        cells: [...this.selectedCells]
                    });
                    
                    // æ·»åŠ å–®è©æ‰¾åˆ°çš„å‹•ç•«æ•ˆæœ
                    this.selectedCells.forEach(cell => {
                        const cellEl = document.querySelector(`[data-row="${cell.row}"][data-col="${cell.col}"]`);
                        cellEl.classList.add('word-found');
                        cellEl.classList.remove('selected');
                        // çµ¦å·²æ‰¾åˆ°çš„å–®è©åŠ ä¸Šç‰¹æ®Šæ¨£å¼ï¼Œä½†ä»ç„¶å¯ä»¥é¸æ“‡
                        cellEl.classList.add('part-of-word');
                    });
                    
                    const listEl = document.getElementById(`foundWords${wordObj.type.toUpperCase()}`);
                    const wordEl = document.createElement('div');
                    wordEl.className = 'word-item found';
                    wordEl.textContent = word.toLowerCase();
                    listEl.appendChild(wordEl);
                    
                    this.updateProgress(wordObj.type);
                    
                    const message = `${t.correct} ${word.toLowerCase()} ${window.gameState.currentLanguage === 'zh' ? 'æ˜¯' : 'is'} /${wordObj.type}/ ${t.sound}`;
                    window.gameSystem.showMessage(message, 'success');
                    
                    if (this.progress.t >= 3 && this.progress.d >= 3 && this.progress.id >= 3) {
                        setTimeout(() => {
                            const winMessage = window.gameState.currentLanguage === 'zh' ? 'ğŸ‰ æ©‹æ¨‘ä¿®å¾©å®Œæˆï¼éŠæˆ²é€šé—œï¼' : 'ğŸ‰ Bridge repaired! Game completed!';
                            window.gameSystem.showMessage(winMessage, 'success', 4000);
                            window.gameSystem.completeGame('wordSearch');
                        }, 1000);
                    }
                } else if (wordObj && this.foundWords[wordObj.type].includes(word)) {
                    const message = window.gameState.currentLanguage === 'zh' ? 'é€™å€‹å–®è©å·²ç¶“æ‰¾éäº†ï¼' : 'This word has already been found!';
                    window.gameSystem.showMessage(message, 'warning');
                } else {
                    const message = window.gameState.currentLanguage === 'zh' ? `${t.wrong} è«‹å†è©¦ä¸€æ¬¡ã€‚` : `${t.wrong} Please try again.`;
                    window.gameSystem.showMessage(message, 'error');
                }
                
                this.clearSelection();
            }
            
            updateProgress(type) {
                const count = this.progress[type];
                const percentage = (count / 3) * 100;
                const progressBar = document.getElementById(`progress${type.toUpperCase()}`);
                const countEl = document.getElementById(`count${type.toUpperCase()}`);
                
                if (progressBar) progressBar.style.width = `${percentage}%`;
                if (countEl) countEl.textContent = `${count}/3`;
            }
            
            clearSelection() {
                document.querySelectorAll('.letter-cell.selected').forEach(cell => {
                    cell.classList.remove('selected');
                });
                this.selectedCells = [];
                this.updateSelectedWord();
            }
            
            pronounceWord() {
                const word = this.selectedCells.map(cell => this.gameBoard[cell.row][cell.col]).join('').toLowerCase();
                if (word && window.speechSynthesis) {
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            }
        }
        
        // è½å­—éŠæˆ²é‚è¼¯ï¼ˆæ”¹é€²çš„WASD + JKLç‰ˆæœ¬ï¼‰
        class FallingWordsGameLogic {
            constructor() {
                this.isPlaying = false;
                this.isPaused = false;
                this.score = 0;
                this.lives = 3;
                this.timeLeft = 90;
                this.currentSword = 't';
                this.fallingWords = [];
                this.gameTimer = null;
                this.spawnTimer = null;
                this.gameArea = null;
                this.player = null;
                this.playerX = 270; // ç©å®¶Xä½ç½®
                
                this.wordDatabase = {
                    t: ['watched', 'kicked', 'helped', 'worked', 'washed', 'passed', 'crossed', 'danced'],
                    d: ['played', 'lived', 'moved', 'loved', 'opened', 'closed', 'turned', 'learned'],
                    id: ['wanted', 'needed', 'decided', 'started', 'ended', 'visited', 'created', 'painted']
                };
            }
            
            init() {
                this.gameArea = document.getElementById('gameArea');
                this.player = document.getElementById('player');
                
                document.getElementById('startFallingBtn').onclick = () => this.startGame();
                document.getElementById('pauseFallingBtn').onclick = () => this.togglePause();
                
                // åŠé¸æ“‡æŒ‰éˆ•
                document.querySelectorAll('.sword-btn').forEach(btn => {
                    btn.onclick = () => this.selectSword(btn.dataset.sword);
                });
                
                // éµç›¤æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    if (!this.isPlaying || this.isPaused) return;
                    
                    const key = e.key.toLowerCase();
                    
                    // WASDç§»å‹•
                    if (key === 'w') {
                        // Wéµå‘ä¸Šæ”»æ“Šï¼ˆæ”»æ“Šä¸Šæ–¹çš„å–®è©ï¼‰
                        this.attackDirection('up');
                    } else if (key === 'a') {
                        this.movePlayer(-40);
                    } else if (key === 's') {
                        // Séµå‘ä¸‹æ”»æ“Šï¼ˆæ”»æ“Šä¸‹æ–¹çš„å–®è©ï¼‰
                        this.attackDirection('down');
                    } else if (key === 'd') {
                        this.movePlayer(40);
                    }
                    // JKLåŠé¸æ“‡
                    else if (key === 'j') {
                        this.selectSword('t');
                    } else if (key === 'k') {
                        this.selectSword('d');
                    } else if (key === 'l') {
                        this.selectSword('id');
                    }
                    
                    e.preventDefault();
                });
                
                // é»æ“Šæ§åˆ¶
                this.gameArea.onclick = (e) => {
                    if (!this.isPlaying || this.isPaused) return;
                    
                    const rect = this.gameArea.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    
                    // ç§»å‹•ç©å®¶åˆ°é»æ“Šä½ç½®
                    this.playerX = Math.max(40, Math.min(560, clickX));
                    this.player.style.left = this.playerX + 'px';
                    
                    // è‡ªå‹•æ”»æ“Š
                    this.attackNearbyWords();
                };
                
                // åˆå§‹åŒ–åŠé¸æ“‡
                this.selectSword('t');
            }
            
            selectSword(swordType) {
                this.currentSword = swordType;
                
                // æ›´æ–°æŒ‰éˆ•æ¨£å¼
                document.querySelectorAll('.sword-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.sword-btn.${swordType}-sword`).classList.add('active');
                
                // æ›´æ–°åŠæŒ‡ç¤ºå™¨
                const indicator = document.getElementById('swordIndicator');
                indicator.className = `sword-indicator sword-${swordType}`;
                
                window.audioManager.playClick();
            }
            
            movePlayer(direction) {
                this.playerX = Math.max(40, Math.min(560, this.playerX + direction));
                this.player.style.left = this.playerX + 'px';
            }
            
            startGame() {
                this.isPlaying = true;
                this.isPaused = false;
                this.score = 0;
                this.lives = 3;
                this.timeLeft = 90;
                this.fallingWords = [];
                this.playerX = 270;
                this.player.style.left = this.playerX + 'px';
                
                document.getElementById('startFallingBtn').disabled = true;
                document.getElementById('pauseFallingBtn').disabled = false;
                
                this.gameTimer = setInterval(() => this.updateGame(), 1000/60);
                this.spawnTimer = setInterval(() => this.spawnWord(), 1200); // æ›´å¿«çš„ç”Ÿæˆé€Ÿåº¦
                
                console.log('âš”ï¸ å²©çŸ³æ³•å¸«æˆ°é–‹å§‹');
            }
            
            updateGame() {
                if (this.isPaused) return;
                
                this.timeLeft -= 1/60;
                
                document.getElementById('fallingTime').textContent = Math.ceil(this.timeLeft);
                document.getElementById('fallingScore').textContent = this.score;
                
                // æ›´æ–°ç”Ÿå‘½é¡¯ç¤º
                let livesText = '';
                for (let i = 0; i < this.lives; i++) {
                    livesText += 'â¤ï¸';
                }
                document.getElementById('fallingLives').textContent = livesText;
                
                // æ›´æ–°è½å­—
                for (let i = this.fallingWords.length - 1; i >= 0; i--) {
                    const word = this.fallingWords[i];
                    const currentTop = parseInt(word.element.style.top) || 0;
                    word.element.style.top = (currentTop + word.speed) + 'px';
                    
                    // æª¢æŸ¥æ˜¯å¦åˆ°é”åº•éƒ¨
                    if (currentTop > 450) {
                        this.lives--;
                        word.element.remove();
                        this.fallingWords.splice(i, 1);
                        
                        if (this.lives <= 0) {
                            this.endGame();
                            return;
                        }
                    }
                }
                
                if (this.timeLeft <= 0) {
                    this.endGame();
                }
                
                // æª¢æŸ¥å‹åˆ©æ¢ä»¶
                if (this.score >= 200) {
                    this.winGame();
                }
            }
            
            spawnWord() {
                if (!this.isPlaying || this.isPaused) return;
                
                const types = ['t', 'd', 'id'];
                const randomType = types[Math.floor(Math.random() * types.length)];
                const words = this.wordDatabase[randomType];
                const randomWord = words[Math.floor(Math.random() * words.length)];
                
                const wordElement = document.createElement('div');
                wordElement.className = `falling-word ${randomType}-type`;
                wordElement.textContent = randomWord;
                wordElement.style.left = Math.random() * 500 + 'px';
                wordElement.style.top = '-50px';
                wordElement.style.position = 'absolute';
                
                const wordData = {
                    element: wordElement,
                    text: randomWord,
                    type: randomType,
                    speed: 1.5 + Math.random() * 2
                };
                
                wordElement.onclick = () => this.hitWord(wordData);
                
                this.gameArea.appendChild(wordElement);
                this.fallingWords.push(wordData);
            }
            
            attackDirection(direction) {
                const playerRect = this.player.getBoundingClientRect();
                const gameAreaRect = this.gameArea.getBoundingClientRect();
                
                this.fallingWords.forEach((word, index) => {
                    const wordRect = word.element.getBoundingClientRect();
                    
                    // è¨ˆç®—ç›¸å°ä½ç½®
                    const wordX = wordRect.left - gameAreaRect.left;
                    const wordY = wordRect.top - gameAreaRect.top;
                    const playerGameX = playerRect.left - gameAreaRect.left;
                    const playerGameY = playerRect.top - gameAreaRect.top;
                    
                    let shouldAttack = false;
                    
                    if (direction === 'up' && wordY < playerGameY && Math.abs(wordX - playerGameX) < 60) {
                        shouldAttack = true;
                    } else if (direction === 'down' && wordY > playerGameY && Math.abs(wordX - playerGameX) < 60) {
                        shouldAttack = true;
                    }
                    
                    if (shouldAttack) {
                        this.hitWord(word, index);
                    }
                });
            }
            
            attackNearbyWords() {
                const playerRect = this.player.getBoundingClientRect();
                const gameAreaRect = this.gameArea.getBoundingClientRect();
                
                this.fallingWords.forEach((word, index) => {
                    const wordRect = word.element.getBoundingClientRect();
                    
                    if (Math.abs(wordRect.left - playerRect.left) < 80 && 
                        Math.abs(wordRect.top - playerRect.top) < 80) {
                        this.hitWord(word, index);
                    }
                });
            }
            
            hitWord(wordData, index = -1) {
                if (index === -1) {
                    index = this.fallingWords.indexOf(wordData);
                }
                
                if (wordData.type === this.currentSword) {
                    this.score += 20;
                    const message = window.gameState.currentLanguage === 'zh' ? 'æ­£ç¢ºï¼ +20!' : 'Correct! +20!';
                    window.gameSystem.showMessage(message, 'success', 1000);
                } else {
                    this.score = Math.max(0, this.score - 10);
                    const message = window.gameState.currentLanguage === 'zh' ? 'éŒ¯èª¤ï¼ -10!' : 'Wrong! -10!';
                    window.gameSystem.showMessage(message, 'error', 1000);
                }
                
                // å‰µå»ºçˆ†ç‚¸æ•ˆæœ
                const explosion = document.createElement('div');
                explosion.textContent = 'ğŸ’¥';
                explosion.style.position = 'absolute';
                explosion.style.left = wordData.element.style.left;
                explosion.style.top = wordData.element.style.top;
                explosion.style.fontSize = '30px';
                explosion.style.zIndex = '1000';
                explosion.style.animation = 'fadeOut 1s ease-out forwards';
                explosion.style.pointerEvents = 'none';
                
                this.gameArea.appendChild(explosion);
                setTimeout(() => explosion.remove(), 1000);
                
                wordData.element.remove();
                if (index >= 0) {
                    this.fallingWords.splice(index, 1);
                }
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                const pauseText = window.gameState.currentLanguage === 'zh' ? 
                    (this.isPaused ? 'â–¶ï¸ ç¹¼çºŒ' : 'â¸ï¸ æš«åœ') :
                    (this.isPaused ? 'â–¶ï¸ Continue' : 'â¸ï¸ Pause');
                document.getElementById('pauseFallingBtn').textContent = pauseText;
            }
            
            endGame() {
                this.isPlaying = false;
                clearInterval(this.gameTimer);
                clearInterval(this.spawnTimer);
                
                document.getElementById('startFallingBtn').disabled = false;
                document.getElementById('pauseFallingBtn').disabled = true;
                
                if (this.score >= 200) {
                    this.winGame();
                } else {
                    const message = window.gameState.currentLanguage === 'zh' ? 
                        `éŠæˆ²çµæŸï¼å¾—åˆ†: ${this.score}` : 
                        `Game Over! Score: ${this.score}`;
                    window.gameSystem.showMessage(message, 'info');
                }
            }
            
            winGame() {
                const message = window.gameState.currentLanguage === 'zh' ? 
                    'ğŸ‰ æ“Šæ•—å²©çŸ³æ³•å¸«ï¼ç¥å™¨ç²å¾—ï¼' : 
                    'ğŸ‰ Rock wizard defeated! Artifact obtained!';
                window.gameSystem.showMessage(message, 'success');
                window.gameState.artifacts.d = true;
                window.gameSystem.completeGame('fallingWords');
            }
        }
        
        // é¸æ“‡é¡ŒéŠæˆ²é‚è¼¯ï¼ˆä¿®æ­£ç‰ˆï¼š5é€£å°å³å‹åˆ©ï¼‰
        class MultipleChoiceGameLogic {
            constructor() {
                this.currentQuestion = 0;
                this.consecutiveCorrect = 0;
                this.questions = [];
                
                this.wordDatabase = {
                    t: ['watched', 'kicked', 'helped', 'worked', 'washed', 'passed', 'crossed', 'danced', 'jumped', 'walked'],
                    d: ['played', 'lived', 'moved', 'loved', 'opened', 'closed', 'turned', 'learned', 'called', 'saved'],
                    id: ['wanted', 'needed', 'decided', 'started', 'ended', 'visited', 'created', 'painted', 'invited', 'selected']
                };
            }
            
            init() {
                this.generateQuestions();
                this.setupControls();
                this.showQuestion();
            }
            
            generateQuestions() {
                const allWords = [];
                Object.keys(this.wordDatabase).forEach(type => {
                    this.wordDatabase[type].forEach(word => {
                        allWords.push({ word, type });
                    });
                });
                
                // ç”Ÿæˆè¶³å¤Ÿçš„å•é¡Œ
                for (let i = 0; i < 20; i++) {
                    const randomIndex = Math.floor(Math.random() * allWords.length);
                    this.questions.push(allWords[randomIndex]);
                    allWords.splice(randomIndex, 1);
                }
            }
            
            setupControls() {
                document.getElementById('mcPlayBtn').onclick = () => this.playWordSound();
                
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.onclick = () => this.selectAnswer(btn.dataset.answer);
                });
            }
            
            showQuestion() {
                if (this.consecutiveCorrect >= 5) {
                    this.winGame();
                    return;
                }
                
                if (this.currentQuestion >= this.questions.length) {
                    // å¦‚æœå•é¡Œç”¨å®Œä½†é‚„æ²’é”åˆ°5é€£å°ï¼Œé‡æ–°ç”Ÿæˆ
                    this.generateQuestions();
                    this.currentQuestion = 0;
                }
                
                const question = this.questions[this.currentQuestion];
                
                document.getElementById('mcWord').textContent = question.word.toUpperCase();
                document.getElementById('mcCurrent').textContent = this.currentQuestion + 1;
                document.getElementById('mcStreak').textContent = this.consecutiveCorrect;
                
                // é‡ç½®é¸é …æ¨£å¼
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.style.background = btn.style.background.replace('0.8', '0.2');
                    btn.disabled = false;
                });
                
                // æ·»åŠ å‚¬çœ æ•ˆæœï¼ˆç›´åˆ°é€£å°5æ¬¡ï¼‰
                if (this.consecutiveCorrect < 5) {
                    document.querySelector('.game-container').style.filter = 'sepia(100%) hue-rotate(280deg)';
                    
                    // æ›´æ–°è§’è‰²å¤–è§€
                    const playerSprites = document.querySelectorAll('.player-character');
                    playerSprites.forEach(sprite => {
                        sprite.classList.add('hypnotized');
                    });
                }
            }
            
            playWordSound() {
                const question = this.questions[this.currentQuestion];
                if (window.speechSynthesis) {
                    const utterance = new SpeechSynthesisUtterance(question.word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            }
            
            selectAnswer(answer) {
                const question = this.questions[this.currentQuestion];
                const isCorrect = answer === question.type;
                
                document.querySelectorAll('.mc-option').forEach(btn => {
                    btn.disabled = true;
                    if (btn.dataset.answer === question.type) {
                        btn.style.background = btn.style.background.replace('0.2', '0.8');
                    }
                });
                
                if (isCorrect) {
                    this.consecutiveCorrect++;
                    const message = window.gameState.currentLanguage === 'zh' ? 'æ­£ç¢ºï¼' : 'Correct!';
                    window.gameSystem.showMessage(message, 'success', 1500);
                    
                    // æª¢æŸ¥æ˜¯å¦å‹åˆ©
                    if (this.consecutiveCorrect >= 5) {
                        setTimeout(() => this.winGame(), 1500);
                        return;
                    }
                } else {
                    this.consecutiveCorrect = 0; // é‡ç½®é€£å°è¨ˆæ•¸
                    const correctAnswer = window.gameState.currentLanguage === 'zh' ? 
                        `éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ /${question.type}/ éŸ³` : 
                        `Wrong! Correct answer is /${question.type}/ sound`;
                    window.gameSystem.showMessage(correctAnswer, 'error', 2000);
                }
                
                this.currentQuestion++;
                setTimeout(() => this.showQuestion(), 2500);
            }
            
            winGame() {
                // è§£é™¤å‚¬çœ æ•ˆæœ
                document.querySelector('.game-container').style.filter = 'none';
                
                // æ¢å¾©è§’è‰²å¤–è§€
                const playerSprites = document.querySelectorAll('.player-character');
                playerSprites.forEach(sprite => {
                    sprite.classList.remove('hypnotized');
                });
                
                const victoryMessage = window.gameState.currentLanguage === 'zh' ? 
                    'ğŸ‰ é€£çºŒç­”å°5é¡Œï¼æ“Šæ•—å¤¢é­˜æ³•å¸«ï¼æœ€å¾Œçš„ç¥å™¨ç²å¾—ï¼' : 
                    'ğŸ‰ 5 consecutive correct! Nightmare wizard defeated! Final artifact obtained!';
                window.gameSystem.showMessage(victoryMessage, 'success', 4000);
                
                window.gameState.artifacts.id = true;
                window.gameSystem.completeGame('multipleChoice');
            }
        }
        
        // Bossæˆ°éŠæˆ²é‚è¼¯ï¼ˆä¿®æ­£ç‰ˆï¼šç¢ºä¿è¶³å¤ çš„æ­£ç¢ºç­”æ¡ˆï¼‰
        class BossFightGameLogic {
            constructor() {
                this.bossHealth = 100;
                this.phase = 1;
                this.isActive = false;
                this.challenges = [
                    { type: 't', count: 5, time: 30 },
                    { type: 'd', count: 5, time: 25 },
                    { type: 'id', count: 5, time: 20 }
                ];
                this.currentChallenge = 0;
                this.progress = 0;
                this.timeLeft = 0;
                this.gameTimer = null;
                
                // ç¢ºä¿æ¯ç¨®é¡å‹æœ‰è¶³å¤ çš„å–®è©
                this.wordDatabase = {
                    t: ['watched', 'kicked', 'helped', 'worked', 'washed', 'passed', 'crossed', 'danced', 'jumped', 'walked', 'talked', 'asked', 'looked', 'cooked', 'booked'],
                    d: ['played', 'lived', 'moved', 'loved', 'opened', 'closed', 'turned', 'learned', 'called', 'saved', 'tried', 'died', 'cried', 'fried', 'dried'],
                    id: ['wanted', 'needed', 'decided', 'started', 'ended', 'visited', 'created', 'painted', 'invited', 'selected', 'collected', 'connected', 'protected', 'directed', 'elected']
                };
            }
            
            init() {
                document.getElementById('startBossBtn').onclick = () => this.startBattle();
                this.updateArtifacts();
            }
            
            updateArtifacts() {
                document.getElementById('tArtifact').style.display = window.gameState.artifacts.t ? 'flex' : 'none';
                document.getElementById('dArtifact').style.display = window.gameState.artifacts.d ? 'flex' : 'none';
                document.getElementById('idArtifact').style.display = window.gameState.artifacts.id ? 'flex' : 'none';
            }
            
            startBattle() {
                const artifactCount = Object.values(window.gameState.artifacts).filter(Boolean).length;
                
                if (artifactCount < 3) {
                    const artifactMessage = window.gameState.currentLanguage === 'zh' ? 
                        'ä½ éœ€è¦æ”¶é›†é½Šæ‰€æœ‰ä¸‰å€‹ç¥å™¨æ‰èƒ½æŒ‘æˆ°Bossï¼' : 
                        'You need to collect all three artifacts to challenge the Boss!';
                    window.gameSystem.showMessage(artifactMessage, 'warning');
                    return;
                }
                
                this.isActive = true;
                this.currentChallenge = 0;
                this.startPhase();
            }
            
            startPhase() {
                const challenge = this.challenges[this.currentChallenge];
                
                this.progress = 0;
                this.timeLeft = challenge.time;
                
                const phaseText = window.gameState.currentLanguage === 'zh' ? 
                    `ç¬¬${this.currentChallenge + 1}éšæ®µ` : 
                    `Phase ${this.currentChallenge + 1}`;
                document.getElementById('bossPhase').textContent = phaseText;
                
                const challengeText = window.gameState.currentLanguage === 'zh' ? 
                    `åœ¨${challenge.time}ç§’å…§æ‰¾åˆ°${challenge.count}å€‹/${challenge.type}/éŸ³å–®è©ï¼` :
                    `Find ${challenge.count} /${challenge.type}/ sound words in ${challenge.time} seconds!`;
                document.getElementById('bossChallenge').textContent = challengeText;
                
                this.updateUI();
                this.startChallenge();
            }
            
            startChallenge() {
                const challenge = this.challenges[this.currentChallenge];
                
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.updateUI();
                    
                    if (this.timeLeft <= 0) {
                        this.failPhase();
                    }
                }, 1000);
                
                this.generateChallengeElements(challenge);
            }
            
            generateChallengeElements(challenge) {
                const gameArea = document.getElementById('bossGameArea');
                gameArea.style.display = 'block';
                gameArea.innerHTML = '';
                
                // ç¢ºä¿ç”Ÿæˆè¶³å¤ çš„ç›®æ¨™é¡å‹å–®è©
                const targetWords = this.wordDatabase[challenge.type].slice(0, challenge.count);
                const otherWords = [];
                
                // æ·»åŠ å…¶ä»–é¡å‹çš„å–®è©ä½œç‚ºå¹²æ“¾
                Object.keys(this.wordDatabase).forEach(type => {
                    if (type !== challenge.type) {
                        otherWords.push(...this.wordDatabase[type].slice(0, 3));
                    }
                });
                
                // æ··åˆæ‰€æœ‰å–®è©
                const allWords = [
                    ...targetWords.map(word => ({ word, type: challenge.type })),
                    ...otherWords.map(word => ({ word, type: this.getWordType(word) }))
                ];
                
                // éš¨æ©Ÿæ’åˆ—
                for (let i = allWords.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allWords[i], allWords[j]] = [allWords[j], allWords[i]];
                }
                
                // å‰µå»ºå–®è©å…ƒç´ 
                allWords.forEach((wordData, index) => {
                    const wordEl = document.createElement('div');
                    wordEl.textContent = wordData.word;
                    wordEl.className = `boss-word ${wordData.type}-word`;
                    wordEl.style.cssText = `
                        position: absolute;
                        left: ${(index % 5) * 95 + 10}px;
                        top: ${Math.floor(index / 5) * 35 + 10}px;
                        padding: 8px 12px;
                        border-radius: 6px;
                        color: white;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.2s;
                        font-size: 14px;
                        background: ${this.getWordColor(wordData.type)};
                        border: 2px solid transparent;
                    `;
                    
                    wordEl.onmouseover = () => {
                        wordEl.style.transform = 'scale(1.1)';
                        wordEl.style.borderColor = 'white';
                    };
                    
                    wordEl.onmouseout = () => {
                        wordEl.style.transform = 'scale(1)';
                        wordEl.style.borderColor = 'transparent';
                    };
                    
                    wordEl.onclick = () => this.clickWord(wordData, wordEl);
                    gameArea.appendChild(wordEl);
                });
                
                console.log(`ç”ŸæˆBossæŒ‘æˆ°: ${challenge.type}éŸ³, ç›®æ¨™${challenge.count}å€‹, å¯¦éš›ç”Ÿæˆ${targetWords.length}å€‹`);
            }
            
            getWordType(word) {
                // æ ¹æ“šå–®è©åˆ¤æ–·é¡å‹
                if (this.wordDatabase.t.includes(word)) return 't';
                if (this.wordDatabase.d.includes(word)) return 'd';
                if (this.wordDatabase.id.includes(word)) return 'id';
                return 't'; // é»˜èª
            }
            
            getWordColor(type) {
                switch(type) {
                    case 't': return '#3498db';
                    case 'd': return '#e74c3c';
                    case 'id': return '#2ecc71';
                    default: return '#95a5a6';
                }
            }
            
            clickWord(wordData, element) {
                const challenge = this.challenges[this.currentChallenge];
                
                if (wordData.type === challenge.type) {
                    this.progress++;
                    element.style.background = '#2ecc71';
                    element.style.transform = 'scale(0)';
                    element.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        if (element.parentNode) element.remove();
                    }, 300);
                    
                    if (this.progress >= challenge.count) {
                        this.completePhase();
                    }
                } else {
                    // éŒ¯èª¤å›é¥‹
                    element.style.background = '#e74c3c';
                    element.style.animation = 'shake 0.5s ease-in-out';
                    
                    setTimeout(() => {
                        element.style.background = this.getWordColor(wordData.type);
                        element.style.animation = 'none';
                    }, 500);
                }
                
                this.updateUI();
            }
            
            completePhase() {
                clearInterval(this.gameTimer);
                
                this.bossHealth -= 30;
                this.updateBossHealth();
                
                if (this.currentChallenge >= 2) {
                    this.winBoss();
                } else {
                    this.currentChallenge++;
                    const phaseCompleteMessage = window.gameState.currentLanguage === 'zh' ? 
                        'éšæ®µå®Œæˆï¼' : 'Phase completed!';
                    window.gameSystem.showMessage(phaseCompleteMessage, 'success', 2000);
                    setTimeout(() => this.startPhase(), 2000);
                }
            }
            
            failPhase() {
                clearInterval(this.gameTimer);
                const timeUpMessage = window.gameState.currentLanguage === 'zh' ? 
                    'æ™‚é–“åˆ°ï¼å†è©¦ä¸€æ¬¡ï¼' : 'Time up! Try again!';
                window.gameSystem.showMessage(timeUpMessage, 'error', 2000);
                setTimeout(() => {
                    document.getElementById('bossGameArea').style.display = 'none';
                    this.isActive = false;
                }, 2000);
            }
            
            winBoss() {
                this.bossHealth = 0;
                this.updateBossHealth();
                
                // å‹åˆ©å‹•ç•«
                document.getElementById('bossCharacter').style.animation = 'bossDefeat 2s ease-out forwards';
                
                const victoryMessage = window.gameState.currentLanguage === 'zh' ? 
                    'ğŸ† æ­å–œï¼ä½ æˆç‚ºäº†çœŸæ­£çš„ç™¼éŸ³å¤§å¸«ï¼' : 
                    'ğŸ† Congratulations! You are now a true pronunciation master!';
                window.gameSystem.showMessage(victoryMessage, 'success', 5000);
                
                window.gameSystem.completeGame('bossFight');
            }
            
            updateUI() {
                const challenge = this.challenges[this.currentChallenge];
                document.getElementById('bossProgress').textContent = `${this.progress}/${challenge.count}`;
                document.getElementById('bossTimer').textContent = this.timeLeft;
            }
            
            updateBossHealth() {
                document.getElementById('bossHealthBar').style.width = `${this.bossHealth}%`;
            }
        }
        
        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initializeApp() {
            console.log('ğŸš€ åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼');
            
            const loading = document.getElementById('loadingScreen');
            loading.classList.add('hidden');
            
            window.gameSystem = new GameSystem();
            window.gameSystem.showMainMenu();
            
            console.log('âœ… æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–æˆåŠŸ');
        }
        
        // DOMè¼‰å…¥å®Œæˆæ™‚é–‹å§‹
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“‹ DOMè¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–');
            setTimeout(initializeApp, 1500);
        });
        
        // æ·»åŠ è‡ªå®šç¾©CSSå‹•ç•«
        const additionalCSS = `
            @keyframes fadeOut {
                0% { opacity: 1; transform: scale(1); }
                100% { opacity: 0; transform: scale(0.5); }
            }
            
            @keyframes bossDefeat {
                0% { transform: translateX(-50%) rotate(0deg); }
                100% { transform: translateX(-50%) rotate(360deg) scale(0.5); opacity: 0; }
            }
            
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);
    </script>

</body>
</html>
